window.geo_object=window.geo_object||{ajax_url:apppCore.ajaxurl},function(a,b,c,d){function e(){return a.setInterval(function(){AppGeolocation.geoLocate_user()},6e4)}function f(){return a.setInterval(function(){AppGeolocation.get.getCurrentPosition(AppGeolocation.onSuccessGeoPost,AppGeolocation.onErrorGeo),console.log("geo")},15e3)}a.AppGeolocation={};var g=!1;AppGeolocation.ajaxloaded=!1,AppGeolocation.get=navigator.geolocation;var h,i,j=!1;null!==b.getElementById("appp_longitude")&&(j=!0),AppGeolocation.geoLocate_post=function(){(j||g!==!0)&&(AppGeolocation.get.getCurrentPosition(AppGeolocation.onSuccessGeoPost,AppGeolocation.onErrorGeo),i=f(),g=!0,AppGeolocation.ajaxloaded=!1)},AppGeolocation.onSuccessGeoPost=function(a){if(null!==b.getElementById("appp_longitude")&&a){AppGeolocation.position=a,apppresser.log("onSuccessGeoPost position",a);for(var d=null,e=["longitude","latitude","altitude","accuracy","altitudeAccuracy","heading","speed","timestamp"],f=e.length-1;f>=0;)d=b.getElementById("appp_"+e[f].toLowerCase()),d&&("timestamp"==e[f]?d.value=a.timestamp:d.value=a.coords[e[f]]),f--;var g=c("#appp_map_preview_img");if(a&&g.length){var h=geo_object.gmap_api?"&key="+geo_object.gmap_api:"";g.attr("src","http://maps.googleapis.com/maps/api/staticmap?zoom=17&size=600x300&maptype=roadmap&markers=color:red%7Ccolor:red%7Clabel:%7C"+a.coords.latitude+","+a.coords.longitude+"&sensor=false"+h)}}},AppGeolocation.onErrorGeo=function(a){"function"==typeof apppCore.log&&apppCore.log("code: "+a.code+"\nmessage: "+a.message+"\n")},AppGeolocation.geoLocate_user=function(){navigator.geolocation.getCurrentPosition(AppGeolocation.onSuccessGeoUser,AppGeolocation.onErrorGeo)},AppGeolocation.onSuccessGeoUser=function(a){if(j||g!==!0){var b=geo_object.ajax_url,d=apppCore.ReadCookie("Appp_Geolocation");(b||d)&&c.ajax({type:"POST",dataType:"json",url:b,data:{action:"appp_geo_user",longitude:a.coords.longitude,latitude:a.coords.latitude},success:function(a){apppresser.log("onSuccessGeoUser response",a),console.log(a.data)},error:function(){console.log("geo location error")}})}},AppGeolocation.init=function(){b.getElementById("appp_longitude")&&(j=!0,null!==b.getElementById("app-geolocation-geolocate-post-trigger")&&AppGeolocation.geoLocate_post(),null!==b.getElementById("app-geolocation-geolocate-user-trigger")&&(AppGeolocation.geoLocate_user(),h=e()),("undefined"==typeof apppCore.ver||1==apppCore.ver)&&jQuery(".onclick-appgeo-getloc").on("click",openCheckinModal))},c(b).ready(AppGeolocation.init).bind("load_ajax_content_done",function(){a.clearInterval(h),a.clearInterval(i),AppGeolocation.ajaxloaded=!0,AppGeolocation.init()})}(window,document,jQuery);