(function($,document,window){var
defaults={html:false,photo:false,iframe:false,inline:false,transition:"elastic",speed:300,fadeOut:300,width:false,initialWidth:"600",innerWidth:false,maxWidth:false,height:false,initialHeight:"450",innerHeight:false,maxHeight:false,scalePhotos:true,scrolling:true,href:false,title:false,rel:false,opacity:0.9,preloading:true,className:false,overlayClose:true,escKey:true,arrowKey:true,top:false,bottom:false,left:false,right:false,fixed:false,data:undefined,closeButton:true,fastIframe:true,open:false,reposition:true,loop:true,slideshow:false,slideshowAuto:true,slideshowSpeed:2500,slideshowStart:"start slideshow",slideshowStop:"stop slideshow",photoRegex:/\.(gif|png|jp(e|g|eg)|bmp|ico|webp)((#|\?).*)?$/i,retinaImage:false,retinaUrl:false,retinaSuffix:'@2x.$1',current:"image {current} of {total}",previous:"previous",next:"next",close:"close",xhrError:"This content failed to load.",imgError:"This image failed to load.",returnFocus:true,trapFocus:true,onOpen:false,onLoad:false,onComplete:false,onCleanup:false,onClosed:false},buddybox='buddybox',prefix='cbox',boxElement=prefix+'Element',event_open=prefix+'_open',event_load=prefix+'_load',event_complete=prefix+'_complete',event_cleanup=prefix+'_cleanup',event_closed=prefix+'_closed',event_purge=prefix+'_purge',$overlay,$box,$wrap,$content,$topBorder,$leftBorder,$rightBorder,$bottomBorder,$related,$window,$loaded,$loadingBay,$loadingOverlay,$title,$current,$slideshow,$next,$prev,$close,$groupControls,$events=$('<a/>'),settings,interfaceHeight,interfaceWidth,loadedHeight,loadedWidth,element,index,photo,open,active,closing,loadingTimer,publicMethod,div="div",className,requests=0,previousCSS={},init;function $tag(tag,id,css){var element=document.createElement(tag);if(id){element.id=prefix+id;}
if(css){element.style.cssText=css;}
return $(element);}
function winheight(){return window.innerHeight?window.innerHeight:$(window).height();}
function getIndex(increment){var
max=$related.length,newIndex=(index+increment)%max;return(newIndex<0)?max+newIndex:newIndex;}
function setSize(size,dimension){return Math.round((/%/.test(size)?((dimension==='x'?$window.width():winheight())/100):1)*parseInt(size,10));}
function isImage(settings,url){return settings.photo||settings.photoRegex.test(url);}
function retinaUrl(settings,url){return settings.retinaUrl&&window.devicePixelRatio>1?url.replace(settings.photoRegex,settings.retinaSuffix):url;}
function trapFocus(e){if('contains'in $box[0]&&!$box[0].contains(e.target)){e.stopPropagation();$box.focus();}}
function makeSettings(){var i,data=$.data(element,buddybox);if(data==null){settings=$.extend({},defaults);if(console&&console.log){console.log('Error: cboxElement missing settings object');}}else{settings=$.extend({},data);}
for(i in settings){if($.isFunction(settings[i])&&i.slice(0,2)!=='on'){settings[i]=settings[i].call(element);}}
settings.rel=settings.rel||element.rel||$(element).data('rel')||'nofollow';settings.href=settings.href||$(element).attr('href');settings.title=settings.title||element.title;if(typeof settings.href==="string"){settings.href=$.trim(settings.href);}}
function trigger(event,callback){$(document).trigger(event);$events.triggerHandler(event);if($.isFunction(callback)){callback.call(element);}}
var slideshow=(function(){var active,className=prefix+"Slideshow_",click="click."+prefix,timeOut;function clear(){clearTimeout(timeOut);}
function set(){if(settings.loop||$related[index+1]){clear();timeOut=setTimeout(publicMethod.next,settings.slideshowSpeed);}}
function start(){$slideshow.html(settings.slideshowStop).unbind(click).one(click,stop);$events.bind(event_complete,set).bind(event_load,clear);$box.removeClass(className+"off").addClass(className+"on");}
function stop(){clear();$events.unbind(event_complete,set).unbind(event_load,clear);$slideshow.html(settings.slideshowStart).unbind(click).one(click,function(){publicMethod.next();start();});$box.removeClass(className+"on").addClass(className+"off");}
function reset(){active=false;$slideshow.hide();clear();$events.unbind(event_complete,set).unbind(event_load,clear);$box.removeClass(className+"off "+className+"on");}
return function(){if(active){if(!settings.slideshow){$events.unbind(event_cleanup,reset);reset();}}else{if(settings.slideshow&&$related[1]){active=true;$events.one(event_cleanup,reset);if(settings.slideshowAuto){start();}else{stop();}
$slideshow.show();}}};}());function launch(target){if(!closing){element=target;makeSettings();$related=$(element);index=0;if(settings.rel!=='nofollow'){$related=$('.'+boxElement).filter(function(){var data=$.data(this,buddybox),relRelated;if(data){relRelated=$(this).data('rel')||data.rel||this.rel;}
return(relRelated===settings.rel);});index=$related.index(element);if(index===-1){$related=$related.add(element);index=$related.length-1;}}
$overlay.css({opacity:parseFloat(settings.opacity),cursor:settings.overlayClose?"pointer":"auto",visibility:'visible'}).show();if(className){$box.add($overlay).removeClass(className);}
if(settings.className){$box.add($overlay).addClass(settings.className);}
className=settings.className;if(settings.closeButton){$close.html(settings.close).appendTo($content);}else{$close.appendTo('<div/>');}
if(!open){open=active=true;$box.css({visibility:'hidden',display:'block'});$loaded=$tag(div,'LoadedContent','width:0; height:0; overflow:hidden');$content.css({width:'',height:''}).append($loaded);interfaceHeight=$topBorder.height()+$bottomBorder.height()+$content.outerHeight(true)-$content.height();interfaceWidth=$leftBorder.width()+$rightBorder.width()+$content.outerWidth(true)-$content.width();loadedHeight=$loaded.outerHeight(true);loadedWidth=$loaded.outerWidth(true);settings.w=setSize(settings.initialWidth,'x');settings.h=setSize(settings.initialHeight,'y');$loaded.css({width:'',height:settings.h});publicMethod.position();trigger(event_open,settings.onOpen);$groupControls.add($title).hide();$box.focus();if(settings.trapFocus){if(document.addEventListener){document.addEventListener('focus',trapFocus,true);$events.one(event_closed,function(){document.removeEventListener('focus',trapFocus,true);});}}
if(settings.returnFocus){$events.one(event_closed,function(){$(element).focus();});}}
load();}}
function appendHTML(){if(!$box&&document.body){init=false;$window=$(window);$box=$tag(div).attr({id:buddybox,'class':$.support.opacity===false?prefix+'IE':'',role:'dialog',tabindex:'-1'}).hide();$overlay=$tag(div,"Overlay").hide();$loadingOverlay=$([$tag(div,"LoadingOverlay")[0],$tag(div,"LoadingGraphic")[0]]);$wrap=$tag(div,"Wrapper");$content=$tag(div,"Content").append($title=$tag(div,"Title"),$current=$tag(div,"Current"),$prev=$('<button type="button"/>').attr({id:prefix+'Previous'}),$next=$('<button type="button"/>').attr({id:prefix+'Next'}),$slideshow=$tag('button',"Slideshow"),$loadingOverlay);$close=$('<button type="button"/>').attr({id:prefix+'Close'});$wrap.append($tag(div).append($tag(div,"TopLeft"),$topBorder=$tag(div,"TopCenter"),$tag(div,"TopRight")),$tag(div,false,'clear:left').append($leftBorder=$tag(div,"MiddleLeft"),$content,$rightBorder=$tag(div,"MiddleRight")),$tag(div,false,'clear:left').append($tag(div,"BottomLeft"),$bottomBorder=$tag(div,"BottomCenter"),$tag(div,"BottomRight"))).find('div div').css({'float':'left'});$loadingBay=$tag(div,false,'position:absolute; width:9999px; visibility:hidden; display:none; max-width:none;');$groupControls=$next.add($prev).add($current).add($slideshow);$(document.body).append($overlay,$box.append($wrap,$loadingBay));}}
function addBindings(){function clickHandler(e){if(!(e.which>1||e.shiftKey||e.altKey||e.metaKey||e.ctrlKey)){e.preventDefault();launch(this);}}
if($box){if(!init){init=true;$next.click(function(){publicMethod.next();});$prev.click(function(){publicMethod.prev();});$close.click(function(){publicMethod.close();});$overlay.click(function(){if(settings.overlayClose){publicMethod.close();}});$(document).bind('keydown.'+prefix,function(e){var key=e.keyCode;if(open&&settings.escKey&&key===27){e.preventDefault();publicMethod.close();}
if(open&&settings.arrowKey&&$related[1]&&!e.altKey){if(key===37){e.preventDefault();$prev.click();}else if(key===39){e.preventDefault();$next.click();}}});if($.isFunction($.fn.on)){$(document).on('click.'+prefix,'.'+boxElement,clickHandler);}else{$('.'+boxElement).live('click.'+prefix,clickHandler);}}
return true;}
return false;}
if($.buddybox){return;}
$(appendHTML);publicMethod=$.fn[buddybox]=$[buddybox]=function(options,callback){var $this=this;options=options||{};appendHTML();if(addBindings()){if($.isFunction($this)){$this=$('<a/>');options.open=true;}else if(!$this[0]){return $this;}
if(callback){options.onComplete=callback;}
$this.each(function(){$.data(this,buddybox,$.extend({},$.data(this,buddybox)||defaults,options));}).addClass(boxElement);if(($.isFunction(options.open)&&options.open.call($this))||options.open){launch($this[0]);}}
return $this;};publicMethod.position=function(speed,loadedCallback){var
css,top=0,left=0,offset=$box.offset(),scrollTop,scrollLeft;$window.unbind('resize.'+prefix);$box.css({top:-9e4,left:-9e4});scrollTop=$window.scrollTop();scrollLeft=$window.scrollLeft();if(settings.fixed){offset.top-=scrollTop;offset.left-=scrollLeft;$box.css({position:'fixed'});}else{top=scrollTop;left=scrollLeft;$box.css({position:'absolute'});}
if(settings.right!==false){left+=Math.max($window.width()-settings.w-loadedWidth-interfaceWidth-setSize(settings.right,'x'),0);}else if(settings.left!==false){left+=setSize(settings.left,'x');}else{left+=Math.round(Math.max($window.width()-settings.w-loadedWidth-interfaceWidth,0)/2);}
if(settings.bottom!==false){top+=Math.max(winheight()-settings.h-loadedHeight-interfaceHeight-setSize(settings.bottom,'y'),0);}else if(settings.top!==false){top+=setSize(settings.top,'y');}else{top+=Math.round(Math.max(winheight()-settings.h-loadedHeight-interfaceHeight,0)/2);}
$box.css({top:offset.top,left:offset.left,visibility:'visible'});$wrap[0].style.width=$wrap[0].style.height="9999px";function modalDimensions(){$topBorder[0].style.width=$bottomBorder[0].style.width=$content[0].style.width=(parseInt($box[0].style.width,10)-interfaceWidth)+'px';$content[0].style.height=$leftBorder[0].style.height=$rightBorder[0].style.height=(parseInt($box[0].style.height,10)-interfaceHeight)+'px';}
css={width:settings.w+loadedWidth+interfaceWidth,height:settings.h+loadedHeight+interfaceHeight,top:top,left:left};if(speed){var tempSpeed=0;$.each(css,function(i){if(css[i]!==previousCSS[i]){tempSpeed=speed;return;}});speed=tempSpeed;}
previousCSS=css;if(!speed){$box.css(css);}
$box.dequeue().animate(css,{duration:speed||0,complete:function(){modalDimensions();active=false;$wrap[0].style.width=(settings.w+loadedWidth+interfaceWidth)+"px";$wrap[0].style.height=(settings.h+loadedHeight+interfaceHeight)+"px";if(settings.reposition){setTimeout(function(){$window.bind('resize.'+prefix,publicMethod.position);},1);}
if(loadedCallback){loadedCallback();}},step:modalDimensions});};publicMethod.resize=function(options){var scrolltop;if(open){options=options||{};if(options.width){settings.w=setSize(options.width,'x')-loadedWidth-interfaceWidth;}
if(options.innerWidth){settings.w=setSize(options.innerWidth,'x');}
$loaded.css({width:settings.w});if(options.height){settings.h=setSize(options.height,'y')-loadedHeight-interfaceHeight;}
if(options.innerHeight){settings.h=setSize(options.innerHeight,'y');}
if(!options.innerHeight&&!options.height){scrolltop=$loaded.scrollTop();$loaded.css({height:"auto"});settings.h=$loaded.height();}
$loaded.css({height:settings.h});if(scrolltop){$loaded.scrollTop(scrolltop);}
publicMethod.position(settings.transition==="none"?0:settings.speed);}};publicMethod.prep=function(object){if(!open){return;}
var callback,speed=settings.transition==="none"?0:settings.speed;$loaded.empty().remove();$loaded=$tag(div,'LoadedContent').append(object);function getWidth(){settings.w=settings.w||$loaded.width();settings.w=settings.mw&&settings.mw<settings.w?settings.mw:settings.w;return settings.w;}
function getHeight(){settings.h=settings.h||$loaded.height();settings.h=settings.mh&&settings.mh<settings.h?settings.mh:settings.h;return settings.h;}
$loaded.hide().appendTo($loadingBay.show()).css({width:getWidth(),overflow:settings.scrolling?'auto':'hidden'}).css({height:getHeight()}).prependTo($content);$loadingBay.hide();$(photo).css({'float':'none'});callback=function(){var total=$related.length,iframe,frameBorder='frameBorder',allowTransparency='allowTransparency',complete;if(!open){return;}
function removeFilter(){if($.support.opacity===false){$box[0].style.removeAttribute('filter');}}
complete=function(){clearTimeout(loadingTimer);$loadingOverlay.hide();trigger(event_complete,settings.onComplete);};$title.html(settings.title).add($loaded).show();if(total>1){if(typeof settings.current==="string"){$current.html(settings.current.replace('{current}',index+1).replace('{total}',total)).show();}
$next[(settings.loop||index<total-1)?"show":"hide"]().html(settings.next);$prev[(settings.loop||index)?"show":"hide"]().html(settings.previous);slideshow();if(settings.preloading){$.each([getIndex(-1),getIndex(1)],function(){var src,img,i=$related[this],data=$.data(i,buddybox);if(data&&data.href){src=data.href;if($.isFunction(src)){src=src.call(i);}}else{src=$(i).attr('href');}
if(src&&isImage(data,src)){src=retinaUrl(data,src);img=document.createElement('img');img.src=src;}});}}else{$groupControls.hide();}
if(settings.iframe){iframe=$tag('iframe')[0];if(frameBorder in iframe){iframe[frameBorder]=0;}
if(allowTransparency in iframe){iframe[allowTransparency]="true";}
if(!settings.scrolling){iframe.scrolling="no";}
$(iframe).attr({src:settings.href,name:(new Date()).getTime(),'class':prefix+'Iframe',allowFullScreen:true,webkitAllowFullScreen:true,mozallowfullscreen:true}).one('load',complete).appendTo($loaded);$events.one(event_purge,function(){iframe.src="//about:blank";});if(settings.fastIframe){$(iframe).trigger('load');}}else{complete();}
if(settings.transition==='fade'){$box.fadeTo(speed,1,removeFilter);}else{removeFilter();}};if(settings.transition==='fade'){$box.fadeTo(speed,0,function(){publicMethod.position(0,callback);});}else{publicMethod.position(speed,callback);}};function load(){var href,setResize,prep=publicMethod.prep,$inline,request=++requests;active=true;photo=false;element=$related[index];makeSettings();trigger(event_purge);trigger(event_load,settings.onLoad);settings.h=settings.height?setSize(settings.height,'y')-loadedHeight-interfaceHeight:settings.innerHeight&&setSize(settings.innerHeight,'y');settings.w=settings.width?setSize(settings.width,'x')-loadedWidth-interfaceWidth:settings.innerWidth&&setSize(settings.innerWidth,'x');settings.mw=settings.w;settings.mh=settings.h;if(settings.maxWidth){settings.mw=setSize(settings.maxWidth,'x')-loadedWidth-interfaceWidth;settings.mw=settings.w&&settings.w<settings.mw?settings.w:settings.mw;}
if(settings.maxHeight){settings.mh=setSize(settings.maxHeight,'y')-loadedHeight-interfaceHeight;settings.mh=settings.h&&settings.h<settings.mh?settings.h:settings.mh;}
href=settings.href;loadingTimer=setTimeout(function(){$loadingOverlay.show();},100);if(settings.inline){$inline=$tag(div).hide().insertBefore($(href)[0]);$events.one(event_purge,function(){$inline.replaceWith($loaded.children());});prep($(href));}else if(settings.iframe){prep(" ");}else if(settings.html){prep(settings.html);}else if(isImage(settings,href)){href=retinaUrl(settings,href);photo=document.createElement('img');$(photo).addClass(prefix+'Photo').bind('error',function(){settings.title=false;prep($tag(div,'Error').html(settings.imgError));}).one('load',function(){var percent;if(request!==requests){return;}
$.each(['alt','longdesc','aria-describedby'],function(i,val){var attr=$(element).attr(val)||$(element).attr('data-'+val);if(attr){photo.setAttribute(val,attr);}});if(settings.retinaImage&&window.devicePixelRatio>1){photo.height=photo.height/window.devicePixelRatio;photo.width=photo.width/window.devicePixelRatio;}
if(settings.scalePhotos){setResize=function(){photo.height-=photo.height*percent;photo.width-=photo.width*percent;};if(settings.mw&&photo.width>settings.mw){percent=(photo.width-settings.mw)/photo.width;setResize();}
if(settings.mh&&photo.height>settings.mh){percent=(photo.height-settings.mh)/photo.height;setResize();}}
if(settings.h){photo.style.marginTop=Math.max(settings.mh-photo.height,0)/2+'px';}
if($related[1]&&(settings.loop||$related[index+1])){photo.style.cursor='pointer';photo.onclick=function(){publicMethod.next();};}
photo.style.width=photo.width+'px';photo.style.height=photo.height+'px';setTimeout(function(){prep(photo);},1);});setTimeout(function(){photo.src=href;},1);}else if(href){$loadingBay.load(href,settings.data,function(data,status){if(request===requests){prep(status==='error'?$tag(div,'Error').html(settings.xhrError):$(this).contents());}});}}
publicMethod.next=function(){if(!active&&$related[1]&&(settings.loop||$related[index+1])){index=getIndex(1);launch($related[index]);}};publicMethod.prev=function(){if(!active&&$related[1]&&(settings.loop||index)){index=getIndex(-1);launch($related[index]);}};publicMethod.close=function(){if(open&&!closing){closing=true;open=false;trigger(event_cleanup,settings.onCleanup);$window.unbind('.'+prefix);$overlay.fadeTo(settings.fadeOut||0,0);$box.stop().fadeTo(settings.fadeOut||0,0,function(){$box.add($overlay).css({'opacity':1,cursor:'auto'}).hide();trigger(event_purge);$loaded.empty().remove();setTimeout(function(){closing=false;trigger(event_closed,settings.onClosed);},1);});}};publicMethod.remove=function(){if(!$box){return;}
$box.stop();$.buddybox.close();$box.stop().remove();$overlay.remove();closing=false;$box=null;$('.'+boxElement).removeData(buddybox).removeClass(boxElement);$(document).unbind('click.'+prefix);};publicMethod.element=function(){return $(element);};publicMethod.settings=defaults;}(jQuery,document,window));;jQuery(document).ready(function(jQuery){jQuery('.activity').ajaxStop(function(){setTimeout("buddystreamLoadBuddyBox();",1500);});buddystreamLoadBuddyBox();jQuery(".buddystream_share_button.mylocation").click(function(){navigator.geolocation.getCurrentPosition(buddystreamUseLocation);jQuery(".buddystream_location_type").html('location');});jQuery(".buddystream_share_button.foursquare").click(function(){navigator.geolocation.getCurrentPosition(buddystreamUseLocation);jQuery(".buddystream_location_type").html('foursquare');});jQuery(".buddystream_location_button.cancel").click(function(){jQuery(".buddystream_show_location").hide();jQuery(".buddystream_location_button").hide();});jQuery(".buddystream_location_button.use").click(function(){jQuery(".buddystream_show_location").hide();jQuery(".buddystream_location_button").hide();if(jQuery(".buddystream_location_type").html()=="location"){location_addTag();}
if(jQuery(".buddystream_location_type").html()=="foursquare"){foursquare_addTag();}});});function buddystreamUseLocation(position){var icon=buddystream_url+'/images/marker.png';var bsLat=position.coords.latitude;var bsLong=position.coords.longitude;var locName="";var latlng=new google.maps.LatLng(bsLat,bsLong);geocoder=new google.maps.Geocoder();geocoder.geocode({'latLng':latlng},function(results,status){if(status==google.maps.GeocoderStatus.OK){if(results[0]){locName=results[0].address_components[2].long_name;buddystreamSetLocationCookie(bsLat+"#"+bsLong+"#"+locName);var mapUrl='http://maps.googleapis.com/maps/api/staticmap?center='+bsLat+','+bsLong+'&zoom=13&size=540x150&sensor=false&markers=icon%3A'+icon+'%7C'+bsLat+','+bsLong+'&format=png32';var mapImg='<img src="'+mapUrl+'">';jQuery(".buddystream_location_map").html(mapImg);jQuery(".buddystream_show_location").show();jQuery(".buddystream_location_button").show();}}});}
function buddystreamSetLocationCookie(value)
{var exdate=new Date();exdate.setDate(exdate.getDate()+1);document.cookie="buddystream_location="+value+"; expires="+exdate+"; path=/";}
function buddystreamLoadBuddyBox(){if(jQuery.fn.buddybox){jQuery(".bs_lightbox").buddybox();jQuery(".bs_lightbox[href*='http://www.youtube.com/embed/']").buddybox({iframe:true,innerWidth:625,innerHeight:444});jQuery(".bs_lightbox[href*='http://player.vimeo.com/']").buddybox({iframe:true,innerWidth:625,innerHeight:444});}}
jQuery(document).ready(function(jQuery){jQuery('.buddystream_share_button.linkedin').hover(function(){buddystreamShowHoverBox('.buddystream_share_button.linkedin');},function(){buddystreamHideHoverBox();});jQuery('.buddystream_share_button.facebook').hover(function(){buddystreamShowHoverBox('.buddystream_share_button.facebook');},function(){buddystreamHideHoverBox();});jQuery('.buddystream_share_button.facebookpage').hover(function(){buddystreamShowHoverBox('.buddystream_share_button.facebookpage');},function(){buddystreamHideHoverBox();});jQuery('.buddystream_share_button.twitter').hover(function(){buddystreamShowHoverBox('.buddystream_share_button.twitter');},function(){buddystreamHideHoverBox();});jQuery('.buddystream_share_button.tumblr').hover(function(){buddystreamShowHoverBox('.buddystream_share_button.tumblr');},function(){buddystreamHideHoverBox();});jQuery('.buddystream_share_button.foursquare').hover(function(){buddystreamShowHoverBox('.buddystream_share_button.foursquare');},function(){buddystreamHideHoverBox();});jQuery('.buddystream_share_button.mylocation').hover(function(){buddystreamShowHoverBox('.buddystream_share_button.mylocation');},function(){buddystreamHideHoverBox();});});function buddystreamShowHoverBox(className){var button=jQuery(''+className+'');var position=button.position();var buttonHeight=button.height()+5;var helpText=button.attr('id');jQuery('.buddystream_hoverbox').css('left',position.left);jQuery('.buddystream_hoverbox').css('top',position.top+buttonHeight);jQuery('.buddystream_hoverbox').html(helpText);jQuery('.buddystream_hoverbox').show();}
function buddystreamHideHoverBox(){jQuery('.buddystream_hoverbox').hide();jQuery('.buddystream_hoverbox').html('');}
function location_addTag(){if(jQuery('#whats-new').length){var field='#whats-new';}
else if(jQuery('#topic_title').length){var field='#topic_title';}
else if(jQuery('#reply_text').length){var field='#reply_text';}
var content;content=jQuery(field).val();content=content.replace('#location ','');content='#location '+content;jQuery(field).val(content);}
function foursquare_addTag(){if(jQuery('#whats-new').length){var field='#whats-new';}
else if(jQuery('#topic_title').length){var field='#topic_title';}
else if(jQuery('#reply_text').length){var field='#reply_text';}
var content;content=jQuery(field).val();content=content.replace('#foursquare ','');content='#foursquare '+content;jQuery(field).val(content);}
function facebook_addTag(){if(jQuery('#whats-new').length){var field='#whats-new';}
else if(jQuery('#topic_title').length){var field='#topic_title';}
else if(jQuery('#reply_text').length){var field='#reply_text';}
var content;content=jQuery(field).val();content=content.replace('#facebook ','');content='#facebook '+content;jQuery(field).val(content);}
function facebookpage_addTag(){if(jQuery('#whats-new').length){var field='#whats-new';}
else if(jQuery('#topic_title').length){var field='#topic_title';}
else if(jQuery('#reply_text').length){var field='#reply_text';}
var content;content=jQuery(field).val();content=content.replace('#facebookpage ','');content='#facebookpage '+content;jQuery(field).val(content);}
function linkedin_addTag(){if(jQuery('#whats-new').length){var field='#whats-new';}
else if(jQuery('#topic_title').length){var field='#topic_title';}
else if(jQuery('#reply_text').length){var field='#reply_text';}
var content;content=jQuery(field).val();content=content.replace('#linkedin ','');content='#linkedin '+content;jQuery(field).val(content);jQuery('.linkedin_share_counterbox').show();linkedin_counter(field);}
jQuery(document).ready(function(){if(jQuery('#whats-new').length){var field='#whats-new';}
else if(jQuery('#topic_title').length){var field='#topic_title';}
else if(jQuery('#reply_text').length){var field='#reply_text';}
jQuery(field).keyup(function(){linkedin_counter(field);});});function linkedin_counter(field){var text;text=jQuery(field).val();var networksArray=buddystreamNetworks.split(',');jQuery.each(networksArray,function(key,value){text=text.replace(value+' ','');});var textlength=parseInt(text.length);var patt1=/#linkedin/gi;if(jQuery(field).val().match(patt1)){jQuery('.linkedin_share_counterbox').show();var counterlength=700-textlength;var htmltext=counterlength;if(counterlength<100){htmltext='0'+htmltext;}
if(counterlength<10){htmltext='0'+htmltext;}
if(counterlength<1){htmltext='000';}
jQuery('.linkedin_share_counter').html(htmltext);if(textlength>700){var position=jQuery('#whats-new-submit').position();jQuery('.buddystream_hoverbox').css('left',position.left);jQuery('.buddystream_hoverbox').css('top',position.top+38);jQuery('.buddystream_hoverbox').css('background','red');jQuery('.buddystream_hoverbox').html('You reached the maximum allowed characters for linkedin, your message will be cutoff.');jQuery('.buddystream_hoverbox').show();jQuery('.linkedin_share_counter').addClass('linkedin_share_counter_red');}else{jQuery('.linkedin_share_counter').removeClass('linkedin_share_counter_red');jQuery('.buddystream_hoverbox').hide();}}else{jQuery('.linkedin_share_counter').removeClass('linkedin_share_counter_red');jQuery('.linkedin_share_counter').html('700');jQuery('.linkedin_share_counterbox').hide();jQuery('.buddystream_hoverbox').hide();}}
function tumblr_addTag(){if(jQuery('#whats-new').length){var field='#whats-new';}
else if(jQuery('#topic_title').length){var field='#topic_title';}
else if(jQuery('#reply_text').length){var field='#reply_text';}
var content;content=jQuery(field).val();content=content.replace('#tumblr ','');content='#tumblr '+content;jQuery(field).val(content);}
jQuery(document).ready(function(){if(jQuery('#whats-new').length){var field='#whats-new';}
else if(jQuery('#topic_title').length){var field='#topic_title';}
else if(jQuery('#reply_text').length){var field='#reply_text';}});function twitter_addTag(){if(jQuery('#whats-new').length){var field='#whats-new';}
else if(jQuery('#topic_title').length){var field='#topic_title';}
else if(jQuery('#reply_text').length){var field='#reply_text';}
var content;content=jQuery(field).val();content=content.replace('#twitter ','');content='#twitter '+content;jQuery(field).val(content);twitter_counter(field);jQuery('.twitter_share_counterbox').show();}
jQuery(document).ready(function(){if(jQuery('#whats-new').length){var field='#whats-new';}
else if(jQuery('#topic_title').length){var field='#topic_title';}
else if(jQuery('#reply_text').length){var field='#reply_text';}
jQuery(field).keyup(function(){twitter_counter(field);});});function twitter_counter(field){var text;text=jQuery(field).val();var networksArray=buddystreamNetworks.split(',');jQuery.each(networksArray,function(key,value){text=text.replace(value+' ','');});var textlength=parseInt(text.length);var patt1=/#twitter/gi;if(jQuery(field).val().match(patt1)){jQuery('.twitter_share_counterbox').show();var counterlength=141-textlength;var htmltext=counterlength;if(counterlength<100){htmltext='0'+htmltext;}
if(counterlength<10){htmltext='0'+htmltext;}
if(counterlength<1){htmltext='000';}
jQuery('.twitter_share_counter').html(htmltext);if(textlength>141){var position=jQuery('#whats-new-submit').position();jQuery('.buddystream_hoverbox').css('left',position.left);jQuery('.buddystream_hoverbox').css('top',position.top+38);jQuery('.buddystream_hoverbox').css('background','red');jQuery('.buddystream_hoverbox').html('You reached the maximum allowed characters for Twitter, your message will be cutoff.');jQuery('.buddystream_hoverbox').show();jQuery('.twitter_share_counter').addClass('twitter_share_counter_red');}else{jQuery('.twitter_share_counter').removeClass('twitter_share_counter_red');jQuery('.buddystream_hoverbox').hide();}}else{jQuery('.twitter_share_counter').removeClass('twitter_share_counter_red');jQuery('.twitter_share_counter').html('140');jQuery('.twitter_share_counterbox').hide();jQuery('.buddystream_hoverbox').hide();}}
;/* ------------------------------------------------------------------------
	Class: prettyPhoto
	Use: Lightbox clone for jQuery
	Author: Stephane Caron (http://www.no-margin-for-errors.com)
	Version: 3.1.6
------------------------------------------------------------------------- */
!function(a){function b(){var a=location.href;return hashtag=-1!==a.indexOf("#prettyPhoto")?decodeURI(a.substring(a.indexOf("#prettyPhoto")+1,a.length)):!1,hashtag&&(hashtag=hashtag.replace(/<|>/g,"")),hashtag}function c(){"undefined"!=typeof theRel&&(location.hash=theRel+"/"+rel_index+"/")}function d(){-1!==location.href.indexOf("#prettyPhoto")&&(location.hash="prettyPhoto")}function e(a,b){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c="[\\?&]"+a+"=([^&#]*)",d=new RegExp(c),e=d.exec(b);return null==e?"":e[1]}a.prettyPhoto={version:"3.1.6"},a.fn.prettyPhoto=function(f){function r(){a(".pp_loaderIcon").hide(),projectedTop=scroll_pos.scrollTop+(o/2-i.containerHeight/2),projectedTop<0&&(projectedTop=0),$ppt.fadeTo(settings.animation_speed,1),$pp_pic_holder.find(".pp_content").animate({height:i.contentHeight,width:i.contentWidth},settings.animation_speed),$pp_pic_holder.animate({top:projectedTop,left:p/2-i.containerWidth/2<0?0:p/2-i.containerWidth/2,width:i.containerWidth},settings.animation_speed,function(){$pp_pic_holder.find(".pp_hoverContainer,#fullResImage").height(i.height).width(i.width),$pp_pic_holder.find(".pp_fade").fadeIn(settings.animation_speed),isSet&&"image"==w(pp_images[set_position])?$pp_pic_holder.find(".pp_hoverContainer").show():$pp_pic_holder.find(".pp_hoverContainer").hide(),settings.allow_expand&&(i.resized?a("a.pp_expand,a.pp_contract").show():a("a.pp_expand").hide()),!settings.autoplay_slideshow||q||j||a.prettyPhoto.startSlideshow(),settings.changepicturecallback(),j=!0}),A(),f.ajaxcallback()}function s(b){$pp_pic_holder.find("#pp_full_res object,#pp_full_res embed").css("visibility","hidden"),$pp_pic_holder.find(".pp_fade").fadeOut(settings.animation_speed,function(){a(".pp_loaderIcon").show(),b()})}function t(b){b>1?a(".pp_nav").show():a(".pp_nav").hide()}function u(a,b){if(resized=!1,v(a,b),imageWidth=a,imageHeight=b,(n>p||m>o)&&doresize&&settings.allow_resize&&!h){for(resized=!0,fitting=!1;!fitting;)n>p?(imageWidth=p-200,imageHeight=b/a*imageWidth):m>o?(imageHeight=o-200,imageWidth=a/b*imageHeight):fitting=!0,m=imageHeight,n=imageWidth;(n>p||m>o)&&u(n,m),v(imageWidth,imageHeight)}return{width:Math.floor(imageWidth),height:Math.floor(imageHeight),containerHeight:Math.floor(m),containerWidth:Math.floor(n)+2*settings.horizontal_padding,contentHeight:Math.floor(k),contentWidth:Math.floor(l),resized:resized}}function v(b,c){b=parseFloat(b),c=parseFloat(c),$pp_details=$pp_pic_holder.find(".pp_details"),$pp_details.width(b),detailsHeight=parseFloat($pp_details.css("marginTop"))+parseFloat($pp_details.css("marginBottom")),$pp_details=$pp_details.clone().addClass(settings.theme).width(b).appendTo(a("body")).css({position:"absolute",top:-1e4}),detailsHeight+=$pp_details.height(),detailsHeight=detailsHeight<=34?36:detailsHeight,$pp_details.remove(),$pp_title=$pp_pic_holder.find(".ppt"),$pp_title.width(b),titleHeight=parseFloat($pp_title.css("marginTop"))+parseFloat($pp_title.css("marginBottom")),$pp_title=$pp_title.clone().appendTo(a("body")).css({position:"absolute",top:-1e4}),titleHeight+=$pp_title.height(),$pp_title.remove(),k=c+detailsHeight,l=b,m=k+titleHeight+$pp_pic_holder.find(".pp_top").height()+$pp_pic_holder.find(".pp_bottom").height(),n=b}function w(a){return a.match(/youtube\.com\/watch/i)||a.match(/youtu\.be/i)?"youtube":a.match(/vimeo\.com/i)?"vimeo":a.match(/\b.mov\b/i)?"quicktime":a.match(/\b.swf\b/i)?"flash":a.match(/\biframe=true\b/i)?"iframe":a.match(/\bajax=true\b/i)?"ajax":a.match(/\bcustom=true\b/i)?"custom":"#"==a.substr(0,1)?"inline":"image"}function x(){if(doresize&&"undefined"!=typeof $pp_pic_holder){if(scroll_pos=y(),contentHeight=$pp_pic_holder.height(),contentwidth=$pp_pic_holder.width(),projectedTop=o/2+scroll_pos.scrollTop-contentHeight/2,projectedTop<0&&(projectedTop=0),contentHeight>o)return;$pp_pic_holder.css({top:projectedTop,left:p/2+scroll_pos.scrollLeft-contentwidth/2})}}function y(){return self.pageYOffset?{scrollTop:self.pageYOffset,scrollLeft:self.pageXOffset}:document.documentElement&&document.documentElement.scrollTop?{scrollTop:document.documentElement.scrollTop,scrollLeft:document.documentElement.scrollLeft}:document.body?{scrollTop:document.body.scrollTop,scrollLeft:document.body.scrollLeft}:void 0}function z(){o=a(window).height(),p=a(window).width(),"undefined"!=typeof $pp_overlay&&$pp_overlay.height(a(document).height()).width(p)}function A(){isSet&&settings.overlay_gallery&&"image"==w(pp_images[set_position])?(itemWidth=57,navWidth="facebook"==settings.theme||"pp_default"==settings.theme?50:30,itemsPerPage=Math.floor((i.containerWidth-100-navWidth)/itemWidth),itemsPerPage=itemsPerPage<pp_images.length?itemsPerPage:pp_images.length,totalPage=Math.ceil(pp_images.length/itemsPerPage)-1,0==totalPage?(navWidth=0,$pp_gallery.find(".pp_arrow_next,.pp_arrow_previous").hide()):$pp_gallery.find(".pp_arrow_next,.pp_arrow_previous").show(),galleryWidth=itemsPerPage*itemWidth,fullGalleryWidth=pp_images.length*itemWidth,$pp_gallery.css("margin-left",-(galleryWidth/2+navWidth/2)).find("div:first").width(galleryWidth+5).find("ul").width(fullGalleryWidth).find("li.selected").removeClass("selected"),goToPage=Math.floor(set_position/itemsPerPage)<totalPage?Math.floor(set_position/itemsPerPage):totalPage,a.prettyPhoto.changeGalleryPage(goToPage),$pp_gallery_li.filter(":eq("+set_position+")").addClass("selected")):$pp_pic_holder.find(".pp_content").unbind("mouseenter mouseleave")}function B(){if(settings.social_tools&&(facebook_like_link=settings.social_tools.replace("{location_href}",encodeURIComponent(location.href))),settings.markup=settings.markup.replace("{pp_social}",""),a("body").append(settings.markup),$pp_pic_holder=a(".pp_pic_holder"),$ppt=a(".ppt"),$pp_overlay=a("div.pp_overlay"),isSet&&settings.overlay_gallery){currentGalleryPage=0,toInject="";for(var c=0;c<pp_images.length;c++)pp_images[c].match(/\b(jpg|jpeg|png|gif)\b/gi)?(classname="",img_src=pp_images[c]):(classname="default",img_src=""),toInject+="<li class='"+classname+"'><a href='#'><img src='"+img_src+"' width='50' alt='' /></a></li>";toInject=settings.gallery_markup.replace(/{gallery}/g,toInject),$pp_pic_holder.find("#pp_full_res").after(toInject),$pp_gallery=a(".pp_pic_holder .pp_gallery"),$pp_gallery_li=$pp_gallery.find("li"),$pp_gallery.find(".pp_arrow_next").click(function(){return a.prettyPhoto.changeGalleryPage("next"),a.prettyPhoto.stopSlideshow(),!1}),$pp_gallery.find(".pp_arrow_previous").click(function(){return a.prettyPhoto.changeGalleryPage("previous"),a.prettyPhoto.stopSlideshow(),!1}),$pp_pic_holder.find(".pp_content").hover(function(){$pp_pic_holder.find(".pp_gallery:not(.disabled)").fadeIn()},function(){$pp_pic_holder.find(".pp_gallery:not(.disabled)").fadeOut()}),itemWidth=57,$pp_gallery_li.each(function(b){a(this).find("a").click(function(){return a.prettyPhoto.changePage(b),a.prettyPhoto.stopSlideshow(),!1})})}settings.slideshow&&($pp_pic_holder.find(".pp_nav").prepend('<a href="#" class="pp_play">Play</a>'),$pp_pic_holder.find(".pp_nav .pp_play").click(function(){return a.prettyPhoto.startSlideshow(),!1})),$pp_pic_holder.attr("class","pp_pic_holder "+settings.theme),$pp_overlay.css({opacity:0,height:a(document).height(),width:a(window).width()}).bind("click",function(){settings.modal||a.prettyPhoto.close()}),a("a.pp_close").bind("click",function(){return a.prettyPhoto.close(),!1}),settings.allow_expand&&a("a.pp_expand").bind("click",function(){return a(this).hasClass("pp_expand")?(a(this).removeClass("pp_expand").addClass("pp_contract"),doresize=!1):(a(this).removeClass("pp_contract").addClass("pp_expand"),doresize=!0),s(function(){a.prettyPhoto.open()}),!1}),$pp_pic_holder.find(".pp_previous, .pp_nav .pp_arrow_previous").bind("click",function(){return a.prettyPhoto.changePage("previous"),a.prettyPhoto.stopSlideshow(),!1}),$pp_pic_holder.find(".pp_next, .pp_nav .pp_arrow_next").bind("click",function(){return a.prettyPhoto.changePage("next"),a.prettyPhoto.stopSlideshow(),!1}),x()}f=jQuery.extend({hook:"rel",animation_speed:"fast",ajaxcallback:function(){},slideshow:5e3,autoplay_slideshow:!1,opacity:.8,show_title:!0,allow_resize:!0,allow_expand:!0,default_width:500,default_height:344,counter_separator_label:"/",theme:"pp_default",horizontal_padding:20,hideflash:!1,wmode:"opaque",autoplay:!0,modal:!1,deeplinking:!0,overlay_gallery:!0,overlay_gallery_max:30,keyboard_shortcuts:!0,changepicturecallback:function(){},callback:function(){},ie6_fallback:!0,markup:'<div class="pp_pic_holder"> 						<div class="ppt">&nbsp;</div> 						<div class="pp_top"> 							<div class="pp_left"></div> 							<div class="pp_middle"></div> 							<div class="pp_right"></div> 						</div> 						<div class="pp_content_container"> 							<div class="pp_left"> 							<div class="pp_right"> 								<div class="pp_content"> 									<div class="pp_loaderIcon"></div> 									<div class="pp_fade"> 										<a href="#" class="pp_expand" title="Expand the image">Expand</a> 										<div class="pp_hoverContainer"> 											<a class="pp_next" href="#">next</a> 											<a class="pp_previous" href="#">previous</a> 										</div> 										<div id="pp_full_res"></div> 										<div class="pp_details"> 											<div class="pp_nav"> 												<a href="#" class="pp_arrow_previous">Previous</a> 												<p class="currentTextHolder">0/0</p> 												<a href="#" class="pp_arrow_next">Next</a> 											</div> 											<p class="pp_description"></p> 											<div class="pp_social">{pp_social}</div> 											<a class="pp_close" href="#">Close</a> 										</div> 									</div> 								</div> 							</div> 							</div> 						</div> 						<div class="pp_bottom"> 							<div class="pp_left"></div> 							<div class="pp_middle"></div> 							<div class="pp_right"></div> 						</div> 					</div> 					<div class="pp_overlay"></div>',gallery_markup:'<div class="pp_gallery"> 								<a href="#" class="pp_arrow_previous">Previous</a> 								<div> 									<ul> 										{gallery} 									</ul> 								</div> 								<a href="#" class="pp_arrow_next">Next</a> 							</div>',image_markup:'<img id="fullResImage" src="{path}" />',flash_markup:'<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="{width}" height="{height}"><param name="wmode" value="{wmode}" /><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="movie" value="{path}" /><embed src="{path}" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="{width}" height="{height}" wmode="{wmode}"></embed></object>',quicktime_markup:'<object classid="clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B" codebase="http://www.apple.com/qtactivex/qtplugin.cab" height="{height}" width="{width}"><param name="src" value="{path}"><param name="autoplay" value="{autoplay}"><param name="type" value="video/quicktime"><embed src="{path}" height="{height}" width="{width}" autoplay="{autoplay}" type="video/quicktime" pluginspage="http://www.apple.com/quicktime/download/"></embed></object>',iframe_markup:'<iframe src ="{path}" width="{width}" height="{height}" frameborder="no"></iframe>',inline_markup:'<div class="pp_inline">{content}</div>',custom_markup:"",social_tools:'<div class="twitter"><a href="http://twitter.com/share" class="twitter-share-button" data-count="none">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script></div><div class="facebook"><iframe src="//www.facebook.com/plugins/like.php?locale=en_US&href={location_href}&amp;layout=button_count&amp;show_faces=true&amp;width=500&amp;action=like&amp;font&amp;colorscheme=light&amp;height=23" scrolling="no" frameborder="0" style="border:none; overflow:hidden; width:500px; height:23px;" allowTransparency="true"></iframe></div>'},f);var i,j,k,l,m,n,q,g=this,h=!1,o=a(window).height(),p=a(window).width();return doresize=!0,scroll_pos=y(),a(window).unbind("resize.prettyphoto").bind("resize.prettyphoto",function(){x(),z()}),f.keyboard_shortcuts&&a(document).unbind("keydown.prettyphoto").bind("keydown.prettyphoto",function(b){if("undefined"!=typeof $pp_pic_holder&&$pp_pic_holder.is(":visible"))switch(b.keyCode){case 37:a.prettyPhoto.changePage("previous"),b.preventDefault();break;case 39:a.prettyPhoto.changePage("next"),b.preventDefault();break;case 27:settings.modal||a.prettyPhoto.close(),b.preventDefault()}}),a.prettyPhoto.initialize=function(){return settings=f,"pp_default"==settings.theme&&(settings.horizontal_padding=16),theRel=a(this).attr(settings.hook),galleryRegExp=/\[(?:.*)\]/,isSet=galleryRegExp.exec(theRel)?!0:!1,pp_images=isSet?jQuery.map(g,function(b){return-1!=a(b).attr(settings.hook).indexOf(theRel)?a(b).attr("href"):void 0}):a.makeArray(a(this).attr("href")),pp_titles=isSet?jQuery.map(g,function(b){return-1!=a(b).attr(settings.hook).indexOf(theRel)?a(b).find("img").attr("alt")?a(b).find("img").attr("alt"):"":void 0}):a.makeArray(a(this).find("img").attr("alt")),pp_descriptions=isSet?jQuery.map(g,function(b){return-1!=a(b).attr(settings.hook).indexOf(theRel)?a(b).attr("title")?a(b).attr("title"):"":void 0}):a.makeArray(a(this).attr("title")),pp_images.length>settings.overlay_gallery_max&&(settings.overlay_gallery=!1),set_position=jQuery.inArray(a(this).attr("href"),pp_images),rel_index=isSet?set_position:a("a["+settings.hook+"^='"+theRel+"']").index(a(this)),B(this),settings.allow_resize&&a(window).bind("scroll.prettyphoto",function(){x()}),a.prettyPhoto.open(),!1},a.prettyPhoto.open=function(b){return"undefined"==typeof settings&&(settings=f,pp_images=a.makeArray(arguments[0]),pp_titles=a.makeArray(arguments[1]?arguments[1]:""),pp_descriptions=a.makeArray(arguments[2]?arguments[2]:""),isSet=pp_images.length>1?!0:!1,set_position=arguments[3]?arguments[3]:0,B(b.target)),settings.hideflash&&a("object,embed,iframe[src*=youtube],iframe[src*=vimeo]").css("visibility","hidden"),t(a(pp_images).size()),a(".pp_loaderIcon").show(),settings.deeplinking&&c(),settings.social_tools&&(facebook_like_link=settings.social_tools.replace("{location_href}",encodeURIComponent(location.href)),$pp_pic_holder.find(".pp_social").html(facebook_like_link)),$ppt.is(":hidden")&&$ppt.css("opacity",0).show(),$pp_overlay.show().fadeTo(settings.animation_speed,settings.opacity),$pp_pic_holder.find(".currentTextHolder").text(set_position+1+settings.counter_separator_label+a(pp_images).size()),"undefined"!=typeof pp_descriptions[set_position]&&""!=pp_descriptions[set_position]?$pp_pic_holder.find(".pp_description").show().html(unescape(pp_descriptions[set_position])):$pp_pic_holder.find(".pp_description").hide(),movie_width=parseFloat(e("width",pp_images[set_position]))?e("width",pp_images[set_position]):settings.default_width.toString(),movie_height=parseFloat(e("height",pp_images[set_position]))?e("height",pp_images[set_position]):settings.default_height.toString(),h=!1,-1!=movie_height.indexOf("%")&&(movie_height=parseFloat(a(window).height()*parseFloat(movie_height)/100-150),h=!0),-1!=movie_width.indexOf("%")&&(movie_width=parseFloat(a(window).width()*parseFloat(movie_width)/100-150),h=!0),$pp_pic_holder.fadeIn(function(){switch($ppt.html(settings.show_title&&""!=pp_titles[set_position]&&"undefined"!=typeof pp_titles[set_position]?unescape(pp_titles[set_position]):"&nbsp;"),imgPreloader="",skipInjection=!1,w(pp_images[set_position])){case"image":imgPreloader=new Image,nextImage=new Image,isSet&&set_position<a(pp_images).size()-1&&(nextImage.src=pp_images[set_position+1]),prevImage=new Image,isSet&&pp_images[set_position-1]&&(prevImage.src=pp_images[set_position-1]),$pp_pic_holder.find("#pp_full_res")[0].innerHTML=settings.image_markup.replace(/{path}/g,pp_images[set_position]),imgPreloader.onload=function(){i=u(imgPreloader.width,imgPreloader.height),r()},imgPreloader.onerror=function(){alert("Image cannot be loaded. Make sure the path is correct and image exist."),a.prettyPhoto.close()},imgPreloader.src=pp_images[set_position];break;case"youtube":i=u(movie_width,movie_height),movie_id=e("v",pp_images[set_position]),""==movie_id&&(movie_id=pp_images[set_position].split("youtu.be/"),movie_id=movie_id[1],movie_id.indexOf("?")>0&&(movie_id=movie_id.substr(0,movie_id.indexOf("?"))),movie_id.indexOf("&")>0&&(movie_id=movie_id.substr(0,movie_id.indexOf("&")))),movie="https://www.youtube.com/embed/"+movie_id,movie+=e("rel",pp_images[set_position])?"?rel="+e("rel",pp_images[set_position]):"?rel=1",settings.autoplay&&(movie+="&autoplay=1"),toInject=settings.iframe_markup.replace(/{width}/g,i.width).replace(/{height}/g,i.height).replace(/{wmode}/g,settings.wmode).replace(/{path}/g,movie);break;case"vimeo":i=u(movie_width,movie_height),movie_id=pp_images[set_position];var b=/http(s?):\/\/(www\.)?vimeo.com\/(\d+)/,c=movie_id.match(b);movie="https://player.vimeo.com/video/"+c[3]+"?title=0&amp;byline=0&amp;portrait=0",settings.autoplay&&(movie+="&autoplay=1;"),vimeo_width=i.width+"/embed/?moog_width="+i.width,toInject=settings.iframe_markup.replace(/{width}/g,vimeo_width).replace(/{height}/g,i.height).replace(/{path}/g,movie);break;case"quicktime":i=u(movie_width,movie_height),i.height+=15,i.contentHeight+=15,i.containerHeight+=15,toInject=settings.quicktime_markup.replace(/{width}/g,i.width).replace(/{height}/g,i.height).replace(/{wmode}/g,settings.wmode).replace(/{path}/g,pp_images[set_position]).replace(/{autoplay}/g,settings.autoplay);break;case"flash":i=u(movie_width,movie_height),flash_vars=pp_images[set_position],flash_vars=flash_vars.substring(pp_images[set_position].indexOf("flashvars")+10,pp_images[set_position].length),filename=pp_images[set_position],filename=filename.substring(0,filename.indexOf("?")),toInject=settings.flash_markup.replace(/{width}/g,i.width).replace(/{height}/g,i.height).replace(/{wmode}/g,settings.wmode).replace(/{path}/g,filename+"?"+flash_vars);break;case"iframe":i=u(movie_width,movie_height),frame_url=pp_images[set_position],frame_url=frame_url.substr(0,frame_url.indexOf("iframe")-1),toInject=settings.iframe_markup.replace(/{width}/g,i.width).replace(/{height}/g,i.height).replace(/{path}/g,frame_url);break;case"ajax":doresize=!1,i=u(movie_width,movie_height),doresize=!0,skipInjection=!0,a.get(pp_images[set_position],function(a){toInject=settings.inline_markup.replace(/{content}/g,a),$pp_pic_holder.find("#pp_full_res")[0].innerHTML=toInject,r()});break;case"custom":i=u(movie_width,movie_height),toInject=settings.custom_markup;break;case"inline":myClone=a(pp_images[set_position]).clone().append('<br clear="all" />').css({width:settings.default_width}).wrapInner('<div id="pp_full_res"><div class="pp_inline"></div></div>').appendTo(a("body")).show(),doresize=!1,i=u(a(myClone).width(),a(myClone).height()),doresize=!0,a(myClone).remove(),toInject=settings.inline_markup.replace(/{content}/g,a(pp_images[set_position]).html())}imgPreloader||skipInjection||($pp_pic_holder.find("#pp_full_res")[0].innerHTML=toInject,r())}),!1},a.prettyPhoto.changePage=function(b){currentGalleryPage=0,"previous"==b?(set_position--,set_position<0&&(set_position=a(pp_images).size()-1)):"next"==b?(set_position++,set_position>a(pp_images).size()-1&&(set_position=0)):set_position=b,rel_index=set_position,doresize||(doresize=!0),settings.allow_expand&&a(".pp_contract").removeClass("pp_contract").addClass("pp_expand"),s(function(){a.prettyPhoto.open()})},a.prettyPhoto.changeGalleryPage=function(a){"next"==a?(currentGalleryPage++,currentGalleryPage>totalPage&&(currentGalleryPage=0)):"previous"==a?(currentGalleryPage--,currentGalleryPage<0&&(currentGalleryPage=totalPage)):currentGalleryPage=a,slide_speed="next"==a||"previous"==a?settings.animation_speed:0,slide_to=currentGalleryPage*itemsPerPage*itemWidth,$pp_gallery.find("ul").animate({left:-slide_to},slide_speed)},a.prettyPhoto.startSlideshow=function(){"undefined"==typeof q?($pp_pic_holder.find(".pp_play").unbind("click").removeClass("pp_play").addClass("pp_pause").click(function(){return a.prettyPhoto.stopSlideshow(),!1}),q=setInterval(a.prettyPhoto.startSlideshow,settings.slideshow)):a.prettyPhoto.changePage("next")},a.prettyPhoto.stopSlideshow=function(){$pp_pic_holder.find(".pp_pause").unbind("click").removeClass("pp_pause").addClass("pp_play").click(function(){return a.prettyPhoto.startSlideshow(),!1}),clearInterval(q),q=void 0},a.prettyPhoto.close=function(){$pp_overlay.is(":animated")||(a.prettyPhoto.stopSlideshow(),$pp_pic_holder.stop().find("object,embed").css("visibility","hidden"),a("div.pp_pic_holder,div.ppt,.pp_fade").fadeOut(settings.animation_speed,function(){a(this).remove()}),$pp_overlay.fadeOut(settings.animation_speed,function(){settings.hideflash&&a("object,embed,iframe[src*=youtube],iframe[src*=vimeo]").css("visibility","visible"),a(this).remove(),a(window).unbind("scroll.prettyphoto"),d(),settings.callback(),doresize=!0,j=!1,delete settings}))},!pp_alreadyInitialized&&b()&&(pp_alreadyInitialized=!0,hashIndex=b(),hashRel=hashIndex,hashIndex=hashIndex.substring(hashIndex.indexOf("/")+1,hashIndex.length-1),hashRel=hashRel.substring(0,hashRel.indexOf("/")),setTimeout(function(){a("a["+f.hook+"^='"+hashRel+"']:eq("+hashIndex+")").trigger("click")},50)),this.unbind("click.prettyphoto").bind("click.prettyphoto",a.prettyPhoto.initialize)}}(jQuery);var pp_alreadyInitialized=!1;
;jQuery(document).ready(function($){$("a[rel^="+vlpp_vars.prettyPhoto_rel+"]").prettyPhoto({hook:"rel",animation_speed:vlpp_vars.animation_speed,ajaxcallback:function(){},slideshow:(vlpp_vars.slideshow=="false")?false:vlpp_vars.slideshow,autoplay_slideshow:(vlpp_vars.autoplay_slideshow=="true")?true:false,opacity:vlpp_vars.opacity,show_title:(vlpp_vars.show_title=="true")?true:false,allow_resize:(vlpp_vars.allow_resize=="true")?true:false,allow_expand:(vlpp_vars.allow_expand=="true")?true:false,default_width:vlpp_vars.default_width,default_height:vlpp_vars.default_height,counter_separator_label:vlpp_vars.counter_separator_label,theme:vlpp_vars.theme,horizontal_padding:vlpp_vars.horizontal_padding,hideflash:(vlpp_vars.hideflash=="true")?true:false,wmode:vlpp_vars.wmode,autoplay:(vlpp_vars.autoplay=="true")?true:false,modal:(vlpp_vars.modal=="true")?true:false,deeplinking:(vlpp_vars.deeplinking=="true")?true:false,overlay_gallery:(vlpp_vars.overlay_gallery=="true")?true:false,overlay_gallery_max:vlpp_vars.overlay_gallery_max,keyboard_shortcuts:(vlpp_vars.keyboard_shortcuts=="true")?true:false,changepicturecallback:function(){},callback:function(){},ie6_fallback:(vlpp_vars.ie6_fallback=="true")?true:false,markup:'<div class="pp_pic_holder"> \
                                        <div class="ppt">&nbsp;</div> \
                                        <div class="pp_top"> \
                                                <div class="pp_left"></div> \
                                                <div class="pp_middle"></div> \
                                                <div class="pp_right"></div> \
                                        </div> \
                                        <div class="pp_content_container"> \
                                                <div class="pp_left"> \
                                                <div class="pp_right"> \
                                                        <div class="pp_content"> \
                                                                <div class="pp_loaderIcon"></div> \
                                                                <div class="pp_fade"> \
                                                                        <a href="#" class="pp_expand" title="Expand the image">Expand</a> \
                                                                        <div class="pp_hoverContainer"> \
                                                                                <a class="pp_next" href="#">next</a> \
                                                                                <a class="pp_previous" href="#">previous</a> \
                                                                        </div> \
                                                                        <div id="pp_full_res"></div> \
                                                                        <div class="pp_details"> \
                                                                                <div class="pp_nav"> \
                                                                                        <a href="#" class="pp_arrow_previous">Previous</a> \
                                                                                        <p class="currentTextHolder">0/0</p> \
                                                                                        <a href="#" class="pp_arrow_next">Next</a> \
                                                                                </div> \
                                                                                <p class="pp_description"></p> \
                                                                                {pp_social} \
                                                                                <a class="pp_close" href="#">Close</a> \
                                                                        </div> \
                                                                </div> \
                                                        </div> \
                                                </div> \
                                                </div> \
                                        </div> \
                                        <div class="pp_bottom"> \
                                                <div class="pp_left"></div> \
                                                <div class="pp_middle"></div> \
                                                <div class="pp_right"></div> \
                                        </div> \
                                </div> \
                                <div class="pp_overlay"></div>',gallery_markup:'<div class="pp_gallery"> \
                                                        <a href="#" class="pp_arrow_previous">Previous</a> \
                                                        <div> \
                                                                <ul> \
                                                                        {gallery} \
                                                                </ul> \
                                                        </div> \
                                                        <a href="#" class="pp_arrow_next">Next</a> \
                                                </div>',image_markup:'<img id="fullResImage" src="{path}" />',flash_markup:'<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="{width}" height="{height}"><param name="wmode" value="{wmode}" /><param name="allowfullscreen" value="true" /><param name="allowscriptaccess" value="always" /><param name="movie" value="{path}" /><embed src="{path}" type="application/x-shockwave-flash" allowfullscreen="true" allowscriptaccess="always" width="{width}" height="{height}" wmode="{wmode}"></embed></object>',quicktime_markup:'<object classid="clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B" codebase="http://www.apple.com/qtactivex/qtplugin.cab" height="{height}" width="{width}"><param name="src" value="{path}"><param name="autoplay" value="{autoplay}"><param name="type" value="video/quicktime"><embed src="{path}" height="{height}" width="{width}" autoplay="{autoplay}" type="video/quicktime" pluginspage="http://www.apple.com/quicktime/download/"></embed></object>',iframe_markup:'<iframe src ="{path}" width="{width}" height="{height}" frameborder="no" allowfullscreen></iframe>',inline_markup:'<div class="pp_inline">{content}</div>',custom_markup:'',social_tools:false});});;jQuery(document).ready(function($){$('.prorevs-report-review').click(function(event){event.preventDefault();var thisObj=$(this);$('.prorevs-report-form[data-id="'+thisObj.attr('data-id')+'"]').fadeIn();});var reportIsSending=false;$('.prorevs-report-send').click(function(event){event.preventDefault();if(reportIsSending)
return;reportIsSending=true;var form=$(this).parent();var id=form.attr('data-id');var loadingImg=$('<img src="'+proRevs.loadingImg+'">');form.append(loadingImg);$.ajax({type:'POST',url:proRevs.ajaxurl,data:{action:'report-review',nonce:proRevs.nonce,id:id,reason:$('#prorevs-reason-'+id).val()},success:function(data){if(typeof data=="string"){if(data==""){form.fadeOut();alert('Report is sent. Thanks for your time.');return;}else{alert(data);}}else{alert('Can\'t process the request. Unknown error.');}},dataType:'json'}).always(function(){loadingImg.remove();reportIsSending=false;});});$('.prorevs-report-cancel').click(function(event){event.preventDefault();$(this).parent().fadeOut();});});
;jQuery(document).ready(function(){jQuery("a.confirm").click(function(){return!!confirm(BP_Confirm.are_you_sure)})});
;(function(exports,undefined){"use strict";var modules={};function require(ids,callback){var module,defs=[];for(var i=0;i<ids.length;++i){module=modules[ids[i]]||resolve(ids[i]);if(!module){throw'module definition dependecy not found: '+ids[i];}
defs.push(module);}
callback.apply(null,defs);}
function define(id,dependencies,definition){if(typeof id!=='string'){throw'invalid module definition, module id must be defined and be a string';}
if(dependencies===undefined){throw'invalid module definition, dependencies must be specified';}
if(definition===undefined){throw'invalid module definition, definition function must be specified';}
require(dependencies,function(){modules[id]=definition.apply(null,arguments);});}
function defined(id){return!!modules[id];}
function resolve(id){var target=exports;var fragments=id.split(/[.\/]/);for(var fi=0;fi<fragments.length;++fi){if(!target[fragments[fi]]){return;}
target=target[fragments[fi]];}
return target;}
function expose(ids){for(var i=0;i<ids.length;i++){var target=exports;var id=ids[i];var fragments=id.split(/[.\/]/);for(var fi=0;fi<fragments.length-1;++fi){if(target[fragments[fi]]===undefined){target[fragments[fi]]={};}
target=target[fragments[fi]];}
target[fragments[fragments.length-1]]=modules[id];}}
define('moxie/core/utils/Basic',[],function(){var typeOf=function(o){var undef;if(o===undef){return'undefined';}else if(o===null){return'null';}else if(o.nodeType){return'node';}
return({}).toString.call(o).match(/\s([a-z|A-Z]+)/)[1].toLowerCase();};var extend=function(target){var undef;each(arguments,function(arg,i){if(i>0){each(arg,function(value,key){if(value!==undef){if(typeOf(target[key])===typeOf(value)&&!!~inArray(typeOf(value),['array','object'])){extend(target[key],value);}else{target[key]=value;}}});}});return target;};var each=function(obj,callback){var length,key,i,undef;if(obj){try{length=obj.length;}catch(ex){length=undef;}
if(length===undef){for(key in obj){if(obj.hasOwnProperty(key)){if(callback(obj[key],key)===false){return;}}}}else{for(i=0;i<length;i++){if(callback(obj[i],i)===false){return;}}}}};var isEmptyObj=function(obj){var prop;if(!obj||typeOf(obj)!=='object'){return true;}
for(prop in obj){return false;}
return true;};var inSeries=function(queue,cb){var i=0,length=queue.length;if(typeOf(cb)!=='function'){cb=function(){};}
if(!queue||!queue.length){cb();}
function callNext(i){if(typeOf(queue[i])==='function'){queue[i](function(error){++i<length&&!error?callNext(i):cb(error);});}}
callNext(i);};var inParallel=function(queue,cb){var count=0,num=queue.length,cbArgs=new Array(num);each(queue,function(fn,i){fn(function(error){if(error){return cb(error);}
var args=[].slice.call(arguments);args.shift();cbArgs[i]=args;count++;if(count===num){cbArgs.unshift(null);cb.apply(this,cbArgs);}});});};var inArray=function(needle,array){if(array){if(Array.prototype.indexOf){return Array.prototype.indexOf.call(array,needle);}
for(var i=0,length=array.length;i<length;i++){if(array[i]===needle){return i;}}}
return-1;};var arrayDiff=function(needles,array){var diff=[];if(typeOf(needles)!=='array'){needles=[needles];}
if(typeOf(array)!=='array'){array=[array];}
for(var i in needles){if(inArray(needles[i],array)===-1){diff.push(needles[i]);}}
return diff.length?diff:false;};var arrayIntersect=function(array1,array2){var result=[];each(array1,function(item){if(inArray(item,array2)!==-1){result.push(item);}});return result.length?result:null;};var toArray=function(obj){var i,arr=[];for(i=0;i<obj.length;i++){arr[i]=obj[i];}
return arr;};var guid=(function(){var counter=0;return function(prefix){var guid=new Date().getTime().toString(32),i;for(i=0;i<5;i++){guid+=Math.floor(Math.random()*65535).toString(32);}
return(prefix||'o_')+guid+(counter++).toString(32);};}());var trim=function(str){if(!str){return str;}
return String.prototype.trim?String.prototype.trim.call(str):str.toString().replace(/^\s*/,'').replace(/\s*$/,'');};var parseSizeStr=function(size){if(typeof(size)!=='string'){return size;}
var muls={t:1099511627776,g:1073741824,m:1048576,k:1024},mul;size=/^([0-9]+)([mgk]?)$/.exec(size.toLowerCase().replace(/[^0-9mkg]/g,''));mul=size[2];size=+size[1];if(muls.hasOwnProperty(mul)){size*=muls[mul];}
return size;};return{guid:guid,typeOf:typeOf,extend:extend,each:each,isEmptyObj:isEmptyObj,inSeries:inSeries,inParallel:inParallel,inArray:inArray,arrayDiff:arrayDiff,arrayIntersect:arrayIntersect,toArray:toArray,trim:trim,parseSizeStr:parseSizeStr};});define("moxie/core/I18n",["moxie/core/utils/Basic"],function(Basic){var i18n={};return{addI18n:function(pack){return Basic.extend(i18n,pack);},translate:function(str){return i18n[str]||str;},_:function(str){return this.translate(str);},sprintf:function(str){var args=[].slice.call(arguments,1);return str.replace(/%[a-z]/g,function(){var value=args.shift();return Basic.typeOf(value)!=='undefined'?value:'';});}};});define("moxie/core/utils/Mime",["moxie/core/utils/Basic","moxie/core/I18n"],function(Basic,I18n){var mimeData=""+"application/msword,doc dot,"+"application/pdf,pdf,"+"application/pgp-signature,pgp,"+"application/postscript,ps ai eps,"+"application/rtf,rtf,"+"application/vnd.ms-excel,xls xlb,"+"application/vnd.ms-powerpoint,ppt pps pot,"+"application/zip,zip,"+"application/x-shockwave-flash,swf swfl,"+"application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,"+"application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,"+"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,"+"application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,"+"application/vnd.openxmlformats-officedocument.presentationml.template,potx,"+"application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,"+"application/x-javascript,js,"+"application/json,json,"+"audio/mpeg,mp3 mpga mpega mp2,"+"audio/x-wav,wav,"+"audio/x-m4a,m4a,"+"audio/ogg,oga ogg,"+"audio/aiff,aiff aif,"+"audio/flac,flac,"+"audio/aac,aac,"+"audio/ac3,ac3,"+"audio/x-ms-wma,wma,"+"image/bmp,bmp,"+"image/gif,gif,"+"image/jpeg,jpg jpeg jpe,"+"image/photoshop,psd,"+"image/png,png,"+"image/svg+xml,svg svgz,"+"image/tiff,tiff tif,"+"text/plain,asc txt text diff log,"+"text/html,htm html xhtml,"+"text/css,css,"+"text/csv,csv,"+"text/rtf,rtf,"+"video/mpeg,mpeg mpg mpe m2v,"+"video/quicktime,qt mov,"+"video/mp4,mp4,"+"video/x-m4v,m4v,"+"video/x-flv,flv,"+"video/x-ms-wmv,wmv,"+"video/avi,avi,"+"video/webm,webm,"+"video/3gpp,3gpp 3gp,"+"video/3gpp2,3g2,"+"video/vnd.rn-realvideo,rv,"+"video/ogg,ogv,"+"video/x-matroska,mkv,"+"application/vnd.oasis.opendocument.formula-template,otf,"+"application/octet-stream,exe";var Mime={mimes:{},extensions:{},addMimeType:function(mimeData){var items=mimeData.split(/,/),i,ii,ext;for(i=0;i<items.length;i+=2){ext=items[i+1].split(/ /);for(ii=0;ii<ext.length;ii++){this.mimes[ext[ii]]=items[i];}
this.extensions[items[i]]=ext;}},extList2mimes:function(filters,addMissingExtensions){var self=this,ext,i,ii,type,mimes=[];for(i=0;i<filters.length;i++){ext=filters[i].extensions.split(/\s*,\s*/);for(ii=0;ii<ext.length;ii++){if(ext[ii]==='*'){return[];}
type=self.mimes[ext[ii]];if(!type){if(addMissingExtensions&&/^\w+$/.test(ext[ii])){mimes.push('.'+ext[ii]);}else{return[];}}else if(Basic.inArray(type,mimes)===-1){mimes.push(type);}}}
return mimes;},mimes2exts:function(mimes){var self=this,exts=[];Basic.each(mimes,function(mime){if(mime==='*'){exts=[];return false;}
var m=mime.match(/^(\w+)\/(\*|\w+)$/);if(m){if(m[2]==='*'){Basic.each(self.extensions,function(arr,mime){if((new RegExp('^'+m[1]+'/')).test(mime)){[].push.apply(exts,self.extensions[mime]);}});}else if(self.extensions[mime]){[].push.apply(exts,self.extensions[mime]);}}});return exts;},mimes2extList:function(mimes){var accept=[],exts=[];if(Basic.typeOf(mimes)==='string'){mimes=Basic.trim(mimes).split(/\s*,\s*/);}
exts=this.mimes2exts(mimes);accept.push({title:I18n.translate('Files'),extensions:exts.length?exts.join(','):'*'});accept.mimes=mimes;return accept;},getFileExtension:function(fileName){var matches=fileName&&fileName.match(/\.([^.]+)$/);if(matches){return matches[1].toLowerCase();}
return'';},getFileMime:function(fileName){return this.mimes[this.getFileExtension(fileName)]||'';}};Mime.addMimeType(mimeData);return Mime;});define("moxie/core/utils/Env",["moxie/core/utils/Basic"],function(Basic){var UAParser=(function(undefined){var EMPTY='',UNKNOWN='?',FUNC_TYPE='function',UNDEF_TYPE='undefined',OBJ_TYPE='object',MAJOR='major',MODEL='model',NAME='name',TYPE='type',VENDOR='vendor',VERSION='version',ARCHITECTURE='architecture',CONSOLE='console',MOBILE='mobile',TABLET='tablet';var util={has:function(str1,str2){return str2.toLowerCase().indexOf(str1.toLowerCase())!==-1;},lowerize:function(str){return str.toLowerCase();}};var mapper={rgx:function(){for(var result,i=0,j,k,p,q,matches,match,args=arguments;i<args.length;i+=2){var regex=args[i],props=args[i+1];if(typeof(result)===UNDEF_TYPE){result={};for(p in props){q=props[p];if(typeof(q)===OBJ_TYPE){result[q[0]]=undefined;}else{result[q]=undefined;}}}
for(j=k=0;j<regex.length;j++){matches=regex[j].exec(this.getUA());if(!!matches){for(p=0;p<props.length;p++){match=matches[++k];q=props[p];if(typeof(q)===OBJ_TYPE&&q.length>0){if(q.length==2){if(typeof(q[1])==FUNC_TYPE){result[q[0]]=q[1].call(this,match);}else{result[q[0]]=q[1];}}else if(q.length==3){if(typeof(q[1])===FUNC_TYPE&&!(q[1].exec&&q[1].test)){result[q[0]]=match?q[1].call(this,match,q[2]):undefined;}else{result[q[0]]=match?match.replace(q[1],q[2]):undefined;}}else if(q.length==4){result[q[0]]=match?q[3].call(this,match.replace(q[1],q[2])):undefined;}}else{result[q]=match?match:undefined;}}
break;}}
if(!!matches)break;}
return result;},str:function(str,map){for(var i in map){if(typeof(map[i])===OBJ_TYPE&&map[i].length>0){for(var j=0;j<map[i].length;j++){if(util.has(map[i][j],str)){return(i===UNKNOWN)?undefined:i;}}}else if(util.has(map[i],str)){return(i===UNKNOWN)?undefined:i;}}
return str;}};var maps={browser:{oldsafari:{major:{'1':['/8','/1','/3'],'2':'/4','?':'/'},version:{'1.0':'/8','1.2':'/1','1.3':'/3','2.0':'/412','2.0.2':'/416','2.0.3':'/417','2.0.4':'/419','?':'/'}}},device:{sprint:{model:{'Evo Shift 4G':'7373KT'},vendor:{'HTC':'APA','Sprint':'Sprint'}}},os:{windows:{version:{'ME':'4.90','NT 3.11':'NT3.51','NT 4.0':'NT4.0','2000':'NT 5.0','XP':['NT 5.1','NT 5.2'],'Vista':'NT 6.0','7':'NT 6.1','8':'NT 6.2','8.1':'NT 6.3','RT':'ARM'}}}};var regexes={browser:[[/(opera\smini)\/((\d+)?[\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/((\d+)?[\w\.-]+)/i,/(opera).+version\/((\d+)?[\w\.]+)/i,/(opera)[\/\s]+((\d+)?[\w\.]+)/i],[NAME,VERSION,MAJOR],[/\s(opr)\/((\d+)?[\w\.]+)/i],[[NAME,'Opera'],VERSION,MAJOR],[/(kindle)\/((\d+)?[\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?((\d+)?[\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?((\d+)?[\w\.]*)/i,/(?:ms|\()(ie)\s((\d+)?[\w\.]+)/i,/(rekonq)((?:\/)[\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron)\/((\d+)?[\w\.-]+)/i],[NAME,VERSION,MAJOR],[/(trident).+rv[:\s]((\d+)?[\w\.]+).+like\sgecko/i],[[NAME,'IE'],VERSION,MAJOR],[/(yabrowser)\/((\d+)?[\w\.]+)/i],[[NAME,'Yandex'],VERSION,MAJOR],[/(comodo_dragon)\/((\d+)?[\w\.]+)/i],[[NAME,/_/g,' '],VERSION,MAJOR],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?((\d+)?[\w\.]+)/i],[NAME,VERSION,MAJOR],[/(dolfin)\/((\d+)?[\w\.]+)/i],[[NAME,'Dolphin'],VERSION,MAJOR],[/((?:android.+)crmo|crios)\/((\d+)?[\w\.]+)/i],[[NAME,'Chrome'],VERSION,MAJOR],[/((?:android.+))version\/((\d+)?[\w\.]+)\smobile\ssafari/i],[[NAME,'Android Browser'],VERSION,MAJOR],[/version\/((\d+)?[\w\.]+).+?mobile\/\w+\s(safari)/i],[VERSION,MAJOR,[NAME,'Mobile Safari']],[/version\/((\d+)?[\w\.]+).+?(mobile\s?safari|safari)/i],[VERSION,MAJOR,NAME],[/webkit.+?(mobile\s?safari|safari)((\/[\w\.]+))/i],[NAME,[MAJOR,mapper.str,maps.browser.oldsafari.major],[VERSION,mapper.str,maps.browser.oldsafari.version]],[/(konqueror)\/((\d+)?[\w\.]+)/i,/(webkit|khtml)\/((\d+)?[\w\.]+)/i],[NAME,VERSION,MAJOR],[/(navigator|netscape)\/((\d+)?[\w\.-]+)/i],[[NAME,'Netscape'],VERSION,MAJOR],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?((\d+)?[\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/((\d+)?[\w\.-]+)/i,/(mozilla)\/((\d+)?[\w\.]+).+rv\:.+gecko\/\d+/i,/(uc\s?browser|polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|qqbrowser)[\/\s]?((\d+)?[\w\.]+)/i,/(links)\s\(((\d+)?[\w\.]+)/i,/(gobrowser)\/?((\d+)?[\w\.]+)*/i,/(ice\s?browser)\/v?((\d+)?[\w\._]+)/i,/(mosaic)[\/\s]((\d+)?[\w\.]+)/i],[NAME,VERSION,MAJOR]],engine:[[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[NAME,VERSION],[/rv\:([\w\.]+).*(gecko)/i],[VERSION,NAME]],os:[[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[NAME,[VERSION,mapper.str,maps.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[NAME,'Windows'],[VERSION,mapper.str,maps.os.windows.version]],[/\((bb)(10);/i],[[NAME,'BlackBerry'],VERSION],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)\/([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego)[\/\s-]?([\w\.]+)*/i],[NAME,VERSION],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[NAME,'Symbian'],VERSION],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[NAME,'Firefox OS'],VERSION],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[NAME,VERSION],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[NAME,'Chromium OS'],VERSION],[/(sunos)\s?([\w\.]+\d)*/i],[[NAME,'Solaris'],VERSION],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[NAME,VERSION],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[NAME,'iOS'],[VERSION,/_/g,'.']],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i],[NAME,[VERSION,/_/g,'.']],[/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(macintosh|mac(?=_powerpc)|plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos)/i,/(unix)\s?([\w\.]+)*/i],[NAME,VERSION]]};var UAParser=function(uastring){var ua=uastring||((window&&window.navigator&&window.navigator.userAgent)?window.navigator.userAgent:EMPTY);this.getBrowser=function(){return mapper.rgx.apply(this,regexes.browser);};this.getEngine=function(){return mapper.rgx.apply(this,regexes.engine);};this.getOS=function(){return mapper.rgx.apply(this,regexes.os);};this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS()};};this.getUA=function(){return ua;};this.setUA=function(uastring){ua=uastring;return this;};this.setUA(ua);};return new UAParser().getResult();})();function version_compare(v1,v2,operator){var i=0,x=0,compare=0,vm={'dev':-6,'alpha':-5,'a':-5,'beta':-4,'b':-4,'RC':-3,'rc':-3,'#':-2,'p':1,'pl':1},prepVersion=function(v){v=(''+v).replace(/[_\-+]/g,'.');v=v.replace(/([^.\d]+)/g,'.$1.').replace(/\.{2,}/g,'.');return(!v.length?[-8]:v.split('.'));},numVersion=function(v){return!v?0:(isNaN(v)?vm[v]||-7:parseInt(v,10));};v1=prepVersion(v1);v2=prepVersion(v2);x=Math.max(v1.length,v2.length);for(i=0;i<x;i++){if(v1[i]==v2[i]){continue;}
v1[i]=numVersion(v1[i]);v2[i]=numVersion(v2[i]);if(v1[i]<v2[i]){compare=-1;break;}else if(v1[i]>v2[i]){compare=1;break;}}
if(!operator){return compare;}
switch(operator){case'>':case'gt':return(compare>0);case'>=':case'ge':return(compare>=0);case'<=':case'le':return(compare<=0);case'==':case'=':case'eq':return(compare===0);case'<>':case'!=':case'ne':return(compare!==0);case'':case'<':case'lt':return(compare<0);default:return null;}}
var can=(function(){var caps={define_property:(function(){return false;}()),create_canvas:(function(){var el=document.createElement('canvas');return!!(el.getContext&&el.getContext('2d'));}()),return_response_type:function(responseType){try{if(Basic.inArray(responseType,['','text','document'])!==-1){return true;}else if(window.XMLHttpRequest){var xhr=new XMLHttpRequest();xhr.open('get','/');if('responseType'in xhr){xhr.responseType=responseType;if(xhr.responseType!==responseType){return false;}
return true;}}}catch(ex){}
return false;},use_data_uri:(function(){var du=new Image();du.onload=function(){caps.use_data_uri=(du.width===1&&du.height===1);};setTimeout(function(){du.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw==";},1);return false;}()),use_data_uri_over32kb:function(){return caps.use_data_uri&&(Env.browser!=='IE'||Env.version>=9);},use_data_uri_of:function(bytes){return(caps.use_data_uri&&bytes<33000||caps.use_data_uri_over32kb());},use_fileinput:function(){var el=document.createElement('input');el.setAttribute('type','file');return!el.disabled;}};return function(cap){var args=[].slice.call(arguments);args.shift();return Basic.typeOf(caps[cap])==='function'?caps[cap].apply(this,args):!!caps[cap];};}());var Env={can:can,browser:UAParser.browser.name,version:parseFloat(UAParser.browser.major),os:UAParser.os.name,osVersion:UAParser.os.version,verComp:version_compare,swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};Env.OS=Env.os;return Env;});define('moxie/core/utils/Dom',['moxie/core/utils/Env'],function(Env){var get=function(id){if(typeof id!=='string'){return id;}
return document.getElementById(id);};var hasClass=function(obj,name){if(!obj.className){return false;}
var regExp=new RegExp("(^|\\s+)"+name+"(\\s+|$)");return regExp.test(obj.className);};var addClass=function(obj,name){if(!hasClass(obj,name)){obj.className=!obj.className?name:obj.className.replace(/\s+$/,'')+' '+name;}};var removeClass=function(obj,name){if(obj.className){var regExp=new RegExp("(^|\\s+)"+name+"(\\s+|$)");obj.className=obj.className.replace(regExp,function($0,$1,$2){return $1===' '&&$2===' '?' ':'';});}};var getStyle=function(obj,name){if(obj.currentStyle){return obj.currentStyle[name];}else if(window.getComputedStyle){return window.getComputedStyle(obj,null)[name];}};var getPos=function(node,root){var x=0,y=0,parent,doc=document,nodeRect,rootRect;node=node;root=root||doc.body;function getIEPos(node){var bodyElm,rect,x=0,y=0;if(node){rect=node.getBoundingClientRect();bodyElm=doc.compatMode==="CSS1Compat"?doc.documentElement:doc.body;x=rect.left+bodyElm.scrollLeft;y=rect.top+bodyElm.scrollTop;}
return{x:x,y:y};}
if(node&&node.getBoundingClientRect&&Env.browser==='IE'&&(!doc.documentMode||doc.documentMode<8)){nodeRect=getIEPos(node);rootRect=getIEPos(root);return{x:nodeRect.x-rootRect.x,y:nodeRect.y-rootRect.y};}
parent=node;while(parent&&parent!=root&&parent.nodeType){x+=parent.offsetLeft||0;y+=parent.offsetTop||0;parent=parent.offsetParent;}
parent=node.parentNode;while(parent&&parent!=root&&parent.nodeType){x-=parent.scrollLeft||0;y-=parent.scrollTop||0;parent=parent.parentNode;}
return{x:x,y:y};};var getSize=function(node){return{w:node.offsetWidth||node.clientWidth,h:node.offsetHeight||node.clientHeight};};return{get:get,hasClass:hasClass,addClass:addClass,removeClass:removeClass,getStyle:getStyle,getPos:getPos,getSize:getSize};});define('moxie/core/Exceptions',['moxie/core/utils/Basic'],function(Basic){function _findKey(obj,value){var key;for(key in obj){if(obj[key]===value){return key;}}
return null;}
return{RuntimeError:(function(){var namecodes={NOT_INIT_ERR:1,NOT_SUPPORTED_ERR:9,JS_ERR:4};function RuntimeError(code){this.code=code;this.name=_findKey(namecodes,code);this.message=this.name+": RuntimeError "+this.code;}
Basic.extend(RuntimeError,namecodes);RuntimeError.prototype=Error.prototype;return RuntimeError;}()),OperationNotAllowedException:(function(){function OperationNotAllowedException(code){this.code=code;this.name='OperationNotAllowedException';}
Basic.extend(OperationNotAllowedException,{NOT_ALLOWED_ERR:1});OperationNotAllowedException.prototype=Error.prototype;return OperationNotAllowedException;}()),ImageError:(function(){var namecodes={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2};function ImageError(code){this.code=code;this.name=_findKey(namecodes,code);this.message=this.name+": ImageError "+this.code;}
Basic.extend(ImageError,namecodes);ImageError.prototype=Error.prototype;return ImageError;}()),FileException:(function(){var namecodes={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};function FileException(code){this.code=code;this.name=_findKey(namecodes,code);this.message=this.name+": FileException "+this.code;}
Basic.extend(FileException,namecodes);FileException.prototype=Error.prototype;return FileException;}()),DOMException:(function(){var namecodes={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};function DOMException(code){this.code=code;this.name=_findKey(namecodes,code);this.message=this.name+": DOMException "+this.code;}
Basic.extend(DOMException,namecodes);DOMException.prototype=Error.prototype;return DOMException;}()),EventException:(function(){function EventException(code){this.code=code;this.name='EventException';}
Basic.extend(EventException,{UNSPECIFIED_EVENT_TYPE_ERR:0});EventException.prototype=Error.prototype;return EventException;}())};});define('moxie/core/EventTarget',['moxie/core/Exceptions','moxie/core/utils/Basic'],function(x,Basic){function EventTarget(){var eventpool={};Basic.extend(this,{uid:null,init:function(){if(!this.uid){this.uid=Basic.guid('uid_');}},addEventListener:function(type,fn,priority,scope){var self=this,list;type=Basic.trim(type);if(/\s/.test(type)){Basic.each(type.split(/\s+/),function(type){self.addEventListener(type,fn,priority,scope);});return;}
type=type.toLowerCase();priority=parseInt(priority,10)||0;list=eventpool[this.uid]&&eventpool[this.uid][type]||[];list.push({fn:fn,priority:priority,scope:scope||this});if(!eventpool[this.uid]){eventpool[this.uid]={};}
eventpool[this.uid][type]=list;},hasEventListener:function(type){return type?!!(eventpool[this.uid]&&eventpool[this.uid][type]):!!eventpool[this.uid];},removeEventListener:function(type,fn){type=type.toLowerCase();var list=eventpool[this.uid]&&eventpool[this.uid][type],i;if(list){if(fn){for(i=list.length-1;i>=0;i--){if(list[i].fn===fn){list.splice(i,1);break;}}}else{list=[];}
if(!list.length){delete eventpool[this.uid][type];if(Basic.isEmptyObj(eventpool[this.uid])){delete eventpool[this.uid];}}}},removeAllEventListeners:function(){if(eventpool[this.uid]){delete eventpool[this.uid];}},dispatchEvent:function(type){var uid,list,args,tmpEvt,evt={},result=true,undef;if(Basic.typeOf(type)!=='string'){tmpEvt=type;if(Basic.typeOf(tmpEvt.type)==='string'){type=tmpEvt.type;if(tmpEvt.total!==undef&&tmpEvt.loaded!==undef){evt.total=tmpEvt.total;evt.loaded=tmpEvt.loaded;}
evt.async=tmpEvt.async||false;}else{throw new x.EventException(x.EventException.UNSPECIFIED_EVENT_TYPE_ERR);}}
if(type.indexOf('::')!==-1){(function(arr){uid=arr[0];type=arr[1];}(type.split('::')));}else{uid=this.uid;}
type=type.toLowerCase();list=eventpool[uid]&&eventpool[uid][type];if(list){list.sort(function(a,b){return b.priority-a.priority;});args=[].slice.call(arguments);args.shift();evt.type=type;args.unshift(evt);var queue=[];Basic.each(list,function(handler){args[0].target=handler.scope;if(evt.async){queue.push(function(cb){setTimeout(function(){cb(handler.fn.apply(handler.scope,args)===false);},1);});}else{queue.push(function(cb){cb(handler.fn.apply(handler.scope,args)===false);});}});if(queue.length){Basic.inSeries(queue,function(err){result=!err;});}}
return result;},bind:function(){this.addEventListener.apply(this,arguments);},unbind:function(){this.removeEventListener.apply(this,arguments);},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments);},trigger:function(){return this.dispatchEvent.apply(this,arguments);},convertEventPropsToHandlers:function(handlers){var h;if(Basic.typeOf(handlers)!=='array'){handlers=[handlers];}
for(var i=0;i<handlers.length;i++){h='on'+handlers[i];if(Basic.typeOf(this[h])==='function'){this.addEventListener(handlers[i],this[h]);}else if(Basic.typeOf(this[h])==='undefined'){this[h]=null;}}}});}
EventTarget.instance=new EventTarget();return EventTarget;});define('moxie/core/utils/Encode',[],function(){var utf8_encode=function(str){return unescape(encodeURIComponent(str));};var utf8_decode=function(str_data){return decodeURIComponent(escape(str_data));};var atob=function(data,utf8){if(typeof(window.atob)==='function'){return utf8?utf8_decode(window.atob(data)):window.atob(data);}
var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,dec="",tmp_arr=[];if(!data){return data;}
data+='';do{h1=b64.indexOf(data.charAt(i++));h2=b64.indexOf(data.charAt(i++));h3=b64.indexOf(data.charAt(i++));h4=b64.indexOf(data.charAt(i++));bits=h1<<18|h2<<12|h3<<6|h4;o1=bits>>16&0xff;o2=bits>>8&0xff;o3=bits&0xff;if(h3==64){tmp_arr[ac++]=String.fromCharCode(o1);}else if(h4==64){tmp_arr[ac++]=String.fromCharCode(o1,o2);}else{tmp_arr[ac++]=String.fromCharCode(o1,o2,o3);}}while(i<data.length);dec=tmp_arr.join('');return utf8?utf8_decode(dec):dec;};var btoa=function(data,utf8){if(utf8){utf8_encode(data);}
if(typeof(window.btoa)==='function'){return window.btoa(data);}
var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,enc="",tmp_arr=[];if(!data){return data;}
do{o1=data.charCodeAt(i++);o2=data.charCodeAt(i++);o3=data.charCodeAt(i++);bits=o1<<16|o2<<8|o3;h1=bits>>18&0x3f;h2=bits>>12&0x3f;h3=bits>>6&0x3f;h4=bits&0x3f;tmp_arr[ac++]=b64.charAt(h1)+b64.charAt(h2)+b64.charAt(h3)+b64.charAt(h4);}while(i<data.length);enc=tmp_arr.join('');var r=data.length%3;return(r?enc.slice(0,r-3):enc)+'==='.slice(r||3);};return{utf8_encode:utf8_encode,utf8_decode:utf8_decode,atob:atob,btoa:btoa};});define('moxie/runtime/Runtime',["moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/EventTarget"],function(Basic,Dom,EventTarget){var runtimeConstructors={},runtimes={};function Runtime(options,type,caps,modeCaps,preferredMode){var self=this,_shim,_uid=Basic.guid(type+'_'),defaultMode=preferredMode||'browser';options=options||{};runtimes[_uid]=this;caps=Basic.extend({access_binary:false,access_image_binary:false,display_media:false,do_cors:false,drag_and_drop:false,filter_by_extension:true,resize_image:false,report_upload_progress:false,return_response_headers:false,return_response_type:false,return_status_code:true,send_custom_headers:false,select_file:false,select_folder:false,select_multiple:true,send_binary_string:false,send_browser_cookies:true,send_multipart:true,slice_blob:false,stream_upload:false,summon_file_dialog:false,upload_filesize:true,use_http_method:true},caps);if(options.preferred_caps){defaultMode=Runtime.getMode(modeCaps,options.preferred_caps,defaultMode);}
_shim=(function(){var objpool={};return{exec:function(uid,comp,fn,args){if(_shim[comp]){if(!objpool[uid]){objpool[uid]={context:this,instance:new _shim[comp]()};}
if(objpool[uid].instance[fn]){return objpool[uid].instance[fn].apply(this,args);}}},removeInstance:function(uid){delete objpool[uid];},removeAllInstances:function(){var self=this;Basic.each(objpool,function(obj,uid){if(Basic.typeOf(obj.instance.destroy)==='function'){obj.instance.destroy.call(obj.context);}
self.removeInstance(uid);});}};}());Basic.extend(this,{initialized:false,uid:_uid,type:type,mode:Runtime.getMode(modeCaps,(options.required_caps),defaultMode),shimid:_uid+'_container',clients:0,options:options,can:function(cap,value){var refCaps=arguments[2]||caps;if(Basic.typeOf(cap)==='string'&&Basic.typeOf(value)==='undefined'){cap=Runtime.parseCaps(cap);}
if(Basic.typeOf(cap)==='object'){for(var key in cap){if(!this.can(key,cap[key],refCaps)){return false;}}
return true;}
if(Basic.typeOf(refCaps[cap])==='function'){return refCaps[cap].call(this,value);}else{return(value===refCaps[cap]);}},getShimContainer:function(){var container,shimContainer=Dom.get(this.shimid);if(!shimContainer){container=this.options.container?Dom.get(this.options.container):document.body;shimContainer=document.createElement('div');shimContainer.id=this.shimid;shimContainer.className='moxie-shim moxie-shim-'+this.type;Basic.extend(shimContainer.style,{position:'absolute',top:'0px',left:'0px',width:'1px',height:'1px',overflow:'hidden'});container.appendChild(shimContainer);container=null;}
return shimContainer;},getShim:function(){return _shim;},shimExec:function(component,action){var args=[].slice.call(arguments,2);return self.getShim().exec.call(this,this.uid,component,action,args);},exec:function(component,action){var args=[].slice.call(arguments,2);if(self[component]&&self[component][action]){return self[component][action].apply(this,args);}
return self.shimExec.apply(this,arguments);},destroy:function(){if(!self){return;}
var shimContainer=Dom.get(this.shimid);if(shimContainer){shimContainer.parentNode.removeChild(shimContainer);}
if(_shim){_shim.removeAllInstances();}
this.unbindAll();delete runtimes[this.uid];this.uid=null;_uid=self=_shim=shimContainer=null;}});if(this.mode&&options.required_caps&&!this.can(options.required_caps)){this.mode=false;}}
Runtime.order='html5,flash,silverlight,html4';Runtime.getRuntime=function(uid){return runtimes[uid]?runtimes[uid]:false;};Runtime.addConstructor=function(type,constructor){constructor.prototype=EventTarget.instance;runtimeConstructors[type]=constructor;};Runtime.getConstructor=function(type){return runtimeConstructors[type]||null;};Runtime.getInfo=function(uid){var runtime=Runtime.getRuntime(uid);if(runtime){return{uid:runtime.uid,type:runtime.type,mode:runtime.mode,can:function(){return runtime.can.apply(runtime,arguments);}};}
return null;};Runtime.parseCaps=function(capStr){var capObj={};if(Basic.typeOf(capStr)!=='string'){return capStr||{};}
Basic.each(capStr.split(','),function(key){capObj[key]=true;});return capObj;};Runtime.can=function(type,caps){var runtime,constructor=Runtime.getConstructor(type),mode;if(constructor){runtime=new constructor({required_caps:caps});mode=runtime.mode;runtime.destroy();return!!mode;}
return false;};Runtime.thatCan=function(caps,runtimeOrder){var types=(runtimeOrder||Runtime.order).split(/\s*,\s*/);for(var i in types){if(Runtime.can(types[i],caps)){return types[i];}}
return null;};Runtime.getMode=function(modeCaps,requiredCaps,defaultMode){var mode=null;if(Basic.typeOf(defaultMode)==='undefined'){defaultMode='browser';}
if(requiredCaps&&!Basic.isEmptyObj(modeCaps)){Basic.each(requiredCaps,function(value,cap){if(modeCaps.hasOwnProperty(cap)){var capMode=modeCaps[cap](value);if(typeof(capMode)==='string'){capMode=[capMode];}
if(!mode){mode=capMode;}else if(!(mode=Basic.arrayIntersect(mode,capMode))){return(mode=false);}}});if(mode){return Basic.inArray(defaultMode,mode)!==-1?defaultMode:mode[0];}else if(mode===false){return false;}}
return defaultMode;};Runtime.capTrue=function(){return true;};Runtime.capFalse=function(){return false;};Runtime.capTest=function(expr){return function(){return!!expr;};};return Runtime;});define('moxie/runtime/RuntimeClient',['moxie/core/Exceptions','moxie/core/utils/Basic','moxie/runtime/Runtime'],function(x,Basic,Runtime){return function RuntimeClient(){var runtime;Basic.extend(this,{connectRuntime:function(options){var comp=this,ruid;function initialize(items){var type,constructor;if(!items.length){comp.trigger('RuntimeError',new x.RuntimeError(x.RuntimeError.NOT_INIT_ERR));runtime=null;return;}
type=items.shift();constructor=Runtime.getConstructor(type);if(!constructor){initialize(items);return;}
runtime=new constructor(options);runtime.bind('Init',function(){runtime.initialized=true;setTimeout(function(){runtime.clients++;comp.trigger('RuntimeInit',runtime);},1);});runtime.bind('Error',function(){runtime.destroy();initialize(items);});if(!runtime.mode){runtime.trigger('Error');return;}
runtime.init();}
if(Basic.typeOf(options)==='string'){ruid=options;}else if(Basic.typeOf(options.ruid)==='string'){ruid=options.ruid;}
if(ruid){runtime=Runtime.getRuntime(ruid);if(runtime){runtime.clients++;return runtime;}else{throw new x.RuntimeError(x.RuntimeError.NOT_INIT_ERR);}}
initialize((options.runtime_order||Runtime.order).split(/\s*,\s*/));},getRuntime:function(){if(runtime&&runtime.uid){return runtime;}
runtime=null;return null;},disconnectRuntime:function(){if(runtime&&--runtime.clients<=0){runtime.destroy();runtime=null;}}});};});define('moxie/file/Blob',['moxie/core/utils/Basic','moxie/core/utils/Encode','moxie/runtime/RuntimeClient'],function(Basic,Encode,RuntimeClient){var blobpool={};function Blob(ruid,blob){function _sliceDetached(start,end,type){var blob,data=blobpool[this.uid];if(Basic.typeOf(data)!=='string'||!data.length){return null;}
blob=new Blob(null,{type:type,size:end-start});blob.detach(data.substr(start,blob.size));return blob;}
RuntimeClient.call(this);if(ruid){this.connectRuntime(ruid);}
if(!blob){blob={};}else if(Basic.typeOf(blob)==='string'){blob={data:blob};}
Basic.extend(this,{uid:blob.uid||Basic.guid('uid_'),ruid:ruid,size:blob.size||0,type:blob.type||'',slice:function(start,end,type){if(this.isDetached()){return _sliceDetached.apply(this,arguments);}
return this.getRuntime().exec.call(this,'Blob','slice',this.getSource(),start,end,type);},getSource:function(){if(!blobpool[this.uid]){return null;}
return blobpool[this.uid];},detach:function(data){if(this.ruid){this.getRuntime().exec.call(this,'Blob','destroy');this.disconnectRuntime();this.ruid=null;}
data=data||'';var matches=data.match(/^data:([^;]*);base64,/);if(matches){this.type=matches[1];data=Encode.atob(data.substring(data.indexOf('base64,')+7));}
this.size=data.length;blobpool[this.uid]=data;},isDetached:function(){return!this.ruid&&Basic.typeOf(blobpool[this.uid])==='string';},destroy:function(){this.detach();delete blobpool[this.uid];}});if(blob.data){this.detach(blob.data);}else{blobpool[this.uid]=blob;}}
return Blob;});define('moxie/file/File',['moxie/core/utils/Basic','moxie/core/utils/Mime','moxie/file/Blob'],function(Basic,Mime,Blob){function File(ruid,file){var name,type;if(!file){file={};}
if(file.type&&file.type!==''){type=file.type;}else{type=Mime.getFileMime(file.name);}
if(file.name){name=file.name.replace(/\\/g,'/');name=name.substr(name.lastIndexOf('/')+1);}else{var prefix=type.split('/')[0];name=Basic.guid((prefix!==''?prefix:'file')+'_');if(Mime.extensions[type]){name+='.'+Mime.extensions[type][0];}}
Blob.apply(this,arguments);Basic.extend(this,{type:type||'',name:name||Basic.guid('file_'),lastModifiedDate:file.lastModifiedDate||(new Date()).toLocaleString()});}
File.prototype=Blob.prototype;return File;});define('moxie/file/FileInput',['moxie/core/utils/Basic','moxie/core/utils/Mime','moxie/core/utils/Dom','moxie/core/Exceptions','moxie/core/EventTarget','moxie/core/I18n','moxie/file/File','moxie/runtime/Runtime','moxie/runtime/RuntimeClient'],function(Basic,Mime,Dom,x,EventTarget,I18n,File,Runtime,RuntimeClient){var dispatches=['ready','change','cancel','mouseenter','mouseleave','mousedown','mouseup'];function FileInput(options){var self=this,container,browseButton,defaults;if(Basic.inArray(Basic.typeOf(options),['string','node'])!==-1){options={browse_button:options};}
browseButton=Dom.get(options.browse_button);if(!browseButton){throw new x.DOMException(x.DOMException.NOT_FOUND_ERR);}
defaults={accept:[{title:I18n.translate('All Files'),extensions:'*'}],name:'file',multiple:false,required_caps:false,container:browseButton.parentNode||document.body};options=Basic.extend({},defaults,options);if(typeof(options.required_caps)==='string'){options.required_caps=Runtime.parseCaps(options.required_caps);}
if(typeof(options.accept)==='string'){options.accept=Mime.mimes2extList(options.accept);}
container=Dom.get(options.container);if(!container){container=document.body;}
if(Dom.getStyle(container,'position')==='static'){container.style.position='relative';}
container=browseButton=null;RuntimeClient.call(self);Basic.extend(self,{uid:Basic.guid('uid_'),ruid:null,shimid:null,files:null,init:function(){self.convertEventPropsToHandlers(dispatches);self.bind('RuntimeInit',function(e,runtime){self.ruid=runtime.uid;self.shimid=runtime.shimid;self.bind("Ready",function(){self.trigger("Refresh");},999);self.bind("Change",function(){var files=runtime.exec.call(self,'FileInput','getFiles');self.files=[];Basic.each(files,function(file){if(file.size===0){return true;}
self.files.push(new File(self.ruid,file));});},999);self.bind('Refresh',function(){var pos,size,browseButton,shimContainer;browseButton=Dom.get(options.browse_button);shimContainer=Dom.get(runtime.shimid);if(browseButton){pos=Dom.getPos(browseButton,Dom.get(options.container));size=Dom.getSize(browseButton);if(shimContainer){Basic.extend(shimContainer.style,{top:pos.y+'px',left:pos.x+'px',width:size.w+'px',height:size.h+'px'});}}
shimContainer=browseButton=null;});runtime.exec.call(self,'FileInput','init',options);});self.connectRuntime(Basic.extend({},options,{required_caps:{select_file:true}}));},disable:function(state){var runtime=this.getRuntime();if(runtime){runtime.exec.call(this,'FileInput','disable',Basic.typeOf(state)==='undefined'?true:state);}},refresh:function(){self.trigger("Refresh");},destroy:function(){var runtime=this.getRuntime();if(runtime){runtime.exec.call(this,'FileInput','destroy');this.disconnectRuntime();}
if(Basic.typeOf(this.files)==='array'){Basic.each(this.files,function(file){file.destroy();});}
this.files=null;}});}
FileInput.prototype=EventTarget.instance;return FileInput;});define('moxie/file/FileDrop',['moxie/core/I18n','moxie/core/utils/Dom','moxie/core/Exceptions','moxie/core/utils/Basic','moxie/file/File','moxie/runtime/RuntimeClient','moxie/core/EventTarget','moxie/core/utils/Mime'],function(I18n,Dom,x,Basic,File,RuntimeClient,EventTarget,Mime){var dispatches=['ready','dragenter','dragleave','drop','error'];function FileDrop(options){var self=this,defaults;if(typeof(options)==='string'){options={drop_zone:options};}
defaults={accept:[{title:I18n.translate('All Files'),extensions:'*'}],required_caps:{drag_and_drop:true}};options=typeof(options)==='object'?Basic.extend({},defaults,options):defaults;options.container=Dom.get(options.drop_zone)||document.body;if(Dom.getStyle(options.container,'position')==='static'){options.container.style.position='relative';}
if(typeof(options.accept)==='string'){options.accept=Mime.mimes2extList(options.accept);}
RuntimeClient.call(self);Basic.extend(self,{uid:Basic.guid('uid_'),ruid:null,files:null,init:function(){self.convertEventPropsToHandlers(dispatches);self.bind('RuntimeInit',function(e,runtime){self.ruid=runtime.uid;self.bind("Drop",function(){var files=runtime.exec.call(self,'FileDrop','getFiles');self.files=[];Basic.each(files,function(file){self.files.push(new File(self.ruid,file));});},999);runtime.exec.call(self,'FileDrop','init',options);self.dispatchEvent('ready');});self.connectRuntime(options);},destroy:function(){var runtime=this.getRuntime();if(runtime){runtime.exec.call(this,'FileDrop','destroy');this.disconnectRuntime();}
this.files=null;}});}
FileDrop.prototype=EventTarget.instance;return FileDrop;});define('moxie/runtime/RuntimeTarget',['moxie/core/utils/Basic','moxie/runtime/RuntimeClient',"moxie/core/EventTarget"],function(Basic,RuntimeClient,EventTarget){function RuntimeTarget(){this.uid=Basic.guid('uid_');RuntimeClient.call(this);this.destroy=function(){this.disconnectRuntime();this.unbindAll();};}
RuntimeTarget.prototype=EventTarget.instance;return RuntimeTarget;});define('moxie/file/FileReader',['moxie/core/utils/Basic','moxie/core/utils/Encode','moxie/core/Exceptions','moxie/core/EventTarget','moxie/file/Blob','moxie/file/File','moxie/runtime/RuntimeTarget'],function(Basic,Encode,x,EventTarget,Blob,File,RuntimeTarget){var dispatches=['loadstart','progress','load','abort','error','loadend'];function FileReader(){var self=this,_fr;Basic.extend(this,{uid:Basic.guid('uid_'),readyState:FileReader.EMPTY,result:null,error:null,readAsBinaryString:function(blob){_read.call(this,'readAsBinaryString',blob);},readAsDataURL:function(blob){_read.call(this,'readAsDataURL',blob);},readAsText:function(blob){_read.call(this,'readAsText',blob);},abort:function(){this.result=null;if(Basic.inArray(this.readyState,[FileReader.EMPTY,FileReader.DONE])!==-1){return;}else if(this.readyState===FileReader.LOADING){this.readyState=FileReader.DONE;}
if(_fr){_fr.getRuntime().exec.call(this,'FileReader','abort');}
this.trigger('abort');this.trigger('loadend');},destroy:function(){this.abort();if(_fr){_fr.getRuntime().exec.call(this,'FileReader','destroy');_fr.disconnectRuntime();}
self=_fr=null;}});function _read(op,blob){_fr=new RuntimeTarget();function error(err){self.readyState=FileReader.DONE;self.error=err;self.trigger('error');loadEnd();}
function loadEnd(){_fr.destroy();_fr=null;self.trigger('loadend');}
function exec(runtime){_fr.bind('Error',function(e,err){error(err);});_fr.bind('Progress',function(e){self.result=runtime.exec.call(_fr,'FileReader','getResult');self.trigger(e);});_fr.bind('Load',function(e){self.readyState=FileReader.DONE;self.result=runtime.exec.call(_fr,'FileReader','getResult');self.trigger(e);loadEnd();});runtime.exec.call(_fr,'FileReader','read',op,blob);}
this.convertEventPropsToHandlers(dispatches);if(this.readyState===FileReader.LOADING){return error(new x.DOMException(x.DOMException.INVALID_STATE_ERR));}
this.readyState=FileReader.LOADING;this.trigger('loadstart');if(blob instanceof Blob){if(blob.isDetached()){var src=blob.getSource();switch(op){case'readAsText':case'readAsBinaryString':this.result=src;break;case'readAsDataURL':this.result='data:'+blob.type+';base64,'+Encode.btoa(src);break;}
this.readyState=FileReader.DONE;this.trigger('load');loadEnd();}else{exec(_fr.connectRuntime(blob.ruid));}}else{error(new x.DOMException(x.DOMException.NOT_FOUND_ERR));}}}
FileReader.EMPTY=0;FileReader.LOADING=1;FileReader.DONE=2;FileReader.prototype=EventTarget.instance;return FileReader;});define('moxie/core/utils/Url',[],function(){var parseUrl=function(url,currentUrl){var key=['source','scheme','authority','userInfo','user','pass','host','port','relative','path','directory','file','query','fragment'],i=key.length,ports={http:80,https:443},uri={},regex=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,m=regex.exec(url||'');while(i--){if(m[i]){uri[key[i]]=m[i];}}
if(!uri.scheme){if(!currentUrl||typeof(currentUrl)==='string'){currentUrl=parseUrl(currentUrl||document.location.href);}
uri.scheme=currentUrl.scheme;uri.host=currentUrl.host;uri.port=currentUrl.port;var path='';if(/^[^\/]/.test(uri.path)){path=currentUrl.path;if(!/(\/|\/[^\.]+)$/.test(path)){path=path.replace(/\/[^\/]+$/,'/');}else{path+='/';}}
uri.path=path+(uri.path||'');}
if(!uri.port){uri.port=ports[uri.scheme]||80;}
uri.port=parseInt(uri.port,10);if(!uri.path){uri.path="/";}
delete uri.source;return uri;};var resolveUrl=function(url){var ports={http:80,https:443},urlp=parseUrl(url);return urlp.scheme+'://'+urlp.host+(urlp.port!==ports[urlp.scheme]?':'+urlp.port:'')+urlp.path+(urlp.query?urlp.query:'');};var hasSameOrigin=function(url){function origin(url){return[url.scheme,url.host,url.port].join('/');}
if(typeof url==='string'){url=parseUrl(url);}
return origin(parseUrl())===origin(url);};return{parseUrl:parseUrl,resolveUrl:resolveUrl,hasSameOrigin:hasSameOrigin};});define('moxie/file/FileReaderSync',['moxie/core/utils/Basic','moxie/runtime/RuntimeClient','moxie/core/utils/Encode'],function(Basic,RuntimeClient,Encode){return function(){RuntimeClient.call(this);Basic.extend(this,{uid:Basic.guid('uid_'),readAsBinaryString:function(blob){return _read.call(this,'readAsBinaryString',blob);},readAsDataURL:function(blob){return _read.call(this,'readAsDataURL',blob);},readAsText:function(blob){return _read.call(this,'readAsText',blob);}});function _read(op,blob){if(blob.isDetached()){var src=blob.getSource();switch(op){case'readAsBinaryString':return src;case'readAsDataURL':return'data:'+blob.type+';base64,'+Encode.btoa(src);case'readAsText':var txt='';for(var i=0,length=src.length;i<length;i++){txt+=String.fromCharCode(src[i]);}
return txt;}}else{var result=this.connectRuntime(blob.ruid).exec.call(this,'FileReaderSync','read',op,blob);this.disconnectRuntime();return result;}}};});define("moxie/xhr/FormData",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/file/Blob"],function(x,Basic,Blob){function FormData(){var _blob,_fields=[];Basic.extend(this,{append:function(name,value){var self=this,valueType=Basic.typeOf(value);if(value instanceof Blob){_blob={name:name,value:value};}else if('array'===valueType){name+='[]';Basic.each(value,function(value){self.append(name,value);});}else if('object'===valueType){Basic.each(value,function(value,key){self.append(name+'['+key+']',value);});}else if('null'===valueType||'undefined'===valueType||'number'===valueType&&isNaN(value)){self.append(name,"false");}else{_fields.push({name:name,value:value.toString()});}},hasBlob:function(){return!!this.getBlob();},getBlob:function(){return _blob&&_blob.value||null;},getBlobName:function(){return _blob&&_blob.name||null;},each:function(cb){Basic.each(_fields,function(field){cb(field.value,field.name);});if(_blob){cb(_blob.value,_blob.name);}},destroy:function(){_blob=null;_fields=[];}});}
return FormData;});define("moxie/xhr/XMLHttpRequest",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/utils/Encode","moxie/core/utils/Url","moxie/runtime/Runtime","moxie/runtime/RuntimeTarget","moxie/file/Blob","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/core/utils/Env","moxie/core/utils/Mime"],function(Basic,x,EventTarget,Encode,Url,Runtime,RuntimeTarget,Blob,FileReaderSync,FormData,Env,Mime){var httpCode={100:'Continue',101:'Switching Protocols',102:'Processing',200:'OK',201:'Created',202:'Accepted',203:'Non-Authoritative Information',204:'No Content',205:'Reset Content',206:'Partial Content',207:'Multi-Status',226:'IM Used',300:'Multiple Choices',301:'Moved Permanently',302:'Found',303:'See Other',304:'Not Modified',305:'Use Proxy',306:'Reserved',307:'Temporary Redirect',400:'Bad Request',401:'Unauthorized',402:'Payment Required',403:'Forbidden',404:'Not Found',405:'Method Not Allowed',406:'Not Acceptable',407:'Proxy Authentication Required',408:'Request Timeout',409:'Conflict',410:'Gone',411:'Length Required',412:'Precondition Failed',413:'Request Entity Too Large',414:'Request-URI Too Long',415:'Unsupported Media Type',416:'Requested Range Not Satisfiable',417:'Expectation Failed',422:'Unprocessable Entity',423:'Locked',424:'Failed Dependency',426:'Upgrade Required',500:'Internal Server Error',501:'Not Implemented',502:'Bad Gateway',503:'Service Unavailable',504:'Gateway Timeout',505:'HTTP Version Not Supported',506:'Variant Also Negotiates',507:'Insufficient Storage',510:'Not Extended'};function XMLHttpRequestUpload(){this.uid=Basic.guid('uid_');}
XMLHttpRequestUpload.prototype=EventTarget.instance;var dispatches=['loadstart','progress','abort','error','load','timeout','loadend'];var NATIVE=1,RUNTIME=2;function XMLHttpRequest(){var self=this,props={timeout:0,readyState:XMLHttpRequest.UNSENT,withCredentials:false,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},_async=true,_url,_method,_headers={},_user,_password,_encoding=null,_mimeType=null,_sync_flag=false,_send_flag=false,_upload_events_flag=false,_upload_complete_flag=false,_error_flag=false,_same_origin_flag=false,_start_time,_timeoutset_time,_finalMime=null,_finalCharset=null,_options={},_xhr,_responseHeaders='',_responseHeadersBag;Basic.extend(this,props,{uid:Basic.guid('uid_'),upload:new XMLHttpRequestUpload(),open:function(method,url,async,user,password){var urlp;if(!method||!url){throw new x.DOMException(x.DOMException.SYNTAX_ERR);}
if(/[\u0100-\uffff]/.test(method)||Encode.utf8_encode(method)!==method){throw new x.DOMException(x.DOMException.SYNTAX_ERR);}
if(!!~Basic.inArray(method.toUpperCase(),['CONNECT','DELETE','GET','HEAD','OPTIONS','POST','PUT','TRACE','TRACK'])){_method=method.toUpperCase();}
if(!!~Basic.inArray(_method,['CONNECT','TRACE','TRACK'])){throw new x.DOMException(x.DOMException.SECURITY_ERR);}
url=Encode.utf8_encode(url);urlp=Url.parseUrl(url);_same_origin_flag=Url.hasSameOrigin(urlp);_url=Url.resolveUrl(url);if((user||password)&&!_same_origin_flag){throw new x.DOMException(x.DOMException.INVALID_ACCESS_ERR);}
_user=user||urlp.user;_password=password||urlp.pass;_async=async||true;if(_async===false&&(_p('timeout')||_p('withCredentials')||_p('responseType')!=="")){throw new x.DOMException(x.DOMException.INVALID_ACCESS_ERR);}
_sync_flag=!_async;_send_flag=false;_headers={};_reset.call(this);_p('readyState',XMLHttpRequest.OPENED);this.convertEventPropsToHandlers(['readystatechange']);this.dispatchEvent('readystatechange');},setRequestHeader:function(header,value){var uaHeaders=["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"];if(_p('readyState')!==XMLHttpRequest.OPENED||_send_flag){throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);}
if(/[\u0100-\uffff]/.test(header)||Encode.utf8_encode(header)!==header){throw new x.DOMException(x.DOMException.SYNTAX_ERR);}
header=Basic.trim(header).toLowerCase();if(!!~Basic.inArray(header,uaHeaders)||/^(proxy\-|sec\-)/.test(header)){return false;}
if(!_headers[header]){_headers[header]=value;}else{_headers[header]+=', '+value;}
return true;},getAllResponseHeaders:function(){return _responseHeaders||'';},getResponseHeader:function(header){header=header.toLowerCase();if(_error_flag||!!~Basic.inArray(header,['set-cookie','set-cookie2'])){return null;}
if(_responseHeaders&&_responseHeaders!==''){if(!_responseHeadersBag){_responseHeadersBag={};Basic.each(_responseHeaders.split(/\r\n/),function(line){var pair=line.split(/:\s+/);if(pair.length===2){pair[0]=Basic.trim(pair[0]);_responseHeadersBag[pair[0].toLowerCase()]={header:pair[0],value:Basic.trim(pair[1])};}});}
if(_responseHeadersBag.hasOwnProperty(header)){return _responseHeadersBag[header].header+': '+_responseHeadersBag[header].value;}}
return null;},overrideMimeType:function(mime){var matches,charset;if(!!~Basic.inArray(_p('readyState'),[XMLHttpRequest.LOADING,XMLHttpRequest.DONE])){throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);}
mime=Basic.trim(mime.toLowerCase());if(/;/.test(mime)&&(matches=mime.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))){mime=matches[1];if(matches[2]){charset=matches[2];}}
if(!Mime.mimes[mime]){throw new x.DOMException(x.DOMException.SYNTAX_ERR);}
_finalMime=mime;_finalCharset=charset;},send:function(data,options){if(Basic.typeOf(options)==='string'){_options={ruid:options};}else if(!options){_options={};}else{_options=options;}
this.convertEventPropsToHandlers(dispatches);this.upload.convertEventPropsToHandlers(dispatches);if(this.readyState!==XMLHttpRequest.OPENED||_send_flag){throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);}
if(data instanceof Blob){_options.ruid=data.ruid;_mimeType=data.type||'application/octet-stream';}
else if(data instanceof FormData){if(data.hasBlob()){var blob=data.getBlob();_options.ruid=blob.ruid;_mimeType=blob.type||'application/octet-stream';}}
else if(typeof data==='string'){_encoding='UTF-8';_mimeType='text/plain;charset=UTF-8';data=Encode.utf8_encode(data);}
if(!this.withCredentials){this.withCredentials=(_options.required_caps&&_options.required_caps.send_browser_cookies)&&!_same_origin_flag;}
_upload_events_flag=(!_sync_flag&&this.upload.hasEventListener());_error_flag=false;_upload_complete_flag=!data;if(!_sync_flag){_send_flag=true;}
_doXHR.call(this,data);},abort:function(){_error_flag=true;_sync_flag=false;if(!~Basic.inArray(_p('readyState'),[XMLHttpRequest.UNSENT,XMLHttpRequest.OPENED,XMLHttpRequest.DONE])){_p('readyState',XMLHttpRequest.DONE);_send_flag=false;if(_xhr){_xhr.getRuntime().exec.call(_xhr,'XMLHttpRequest','abort',_upload_complete_flag);}else{throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);}
_upload_complete_flag=true;}else{_p('readyState',XMLHttpRequest.UNSENT);}},destroy:function(){if(_xhr){if(Basic.typeOf(_xhr.destroy)==='function'){_xhr.destroy();}
_xhr=null;}
this.unbindAll();if(this.upload){this.upload.unbindAll();this.upload=null;}}});function _p(prop,value){if(!props.hasOwnProperty(prop)){return;}
if(arguments.length===1){return Env.can('define_property')?props[prop]:self[prop];}else{if(Env.can('define_property')){props[prop]=value;}else{self[prop]=value;}}}
function _doXHR(data){var self=this;_start_time=new Date().getTime();_xhr=new RuntimeTarget();function loadEnd(){if(_xhr){_xhr.destroy();_xhr=null;}
self.dispatchEvent('loadend');self=null;}
function exec(runtime){_xhr.bind('LoadStart',function(e){_p('readyState',XMLHttpRequest.LOADING);self.dispatchEvent('readystatechange');self.dispatchEvent(e);if(_upload_events_flag){self.upload.dispatchEvent(e);}});_xhr.bind('Progress',function(e){if(_p('readyState')!==XMLHttpRequest.LOADING){_p('readyState',XMLHttpRequest.LOADING);self.dispatchEvent('readystatechange');}
self.dispatchEvent(e);});_xhr.bind('UploadProgress',function(e){if(_upload_events_flag){self.upload.dispatchEvent({type:'progress',lengthComputable:false,total:e.total,loaded:e.loaded});}});_xhr.bind('Load',function(e){_p('readyState',XMLHttpRequest.DONE);_p('status',Number(runtime.exec.call(_xhr,'XMLHttpRequest','getStatus')||0));_p('statusText',httpCode[_p('status')]||"");_p('response',runtime.exec.call(_xhr,'XMLHttpRequest','getResponse',_p('responseType')));if(!!~Basic.inArray(_p('responseType'),['text',''])){_p('responseText',_p('response'));}else if(_p('responseType')==='document'){_p('responseXML',_p('response'));}
_responseHeaders=runtime.exec.call(_xhr,'XMLHttpRequest','getAllResponseHeaders');self.dispatchEvent('readystatechange');if(_p('status')>0){if(_upload_events_flag){self.upload.dispatchEvent(e);}
self.dispatchEvent(e);}else{_error_flag=true;self.dispatchEvent('error');}
loadEnd();});_xhr.bind('Abort',function(e){self.dispatchEvent(e);loadEnd();});_xhr.bind('Error',function(e){_error_flag=true;_p('readyState',XMLHttpRequest.DONE);self.dispatchEvent('readystatechange');_upload_complete_flag=true;self.dispatchEvent(e);loadEnd();});runtime.exec.call(_xhr,'XMLHttpRequest','send',{url:_url,method:_method,async:_async,user:_user,password:_password,headers:_headers,mimeType:_mimeType,encoding:_encoding,responseType:self.responseType,withCredentials:self.withCredentials,options:_options},data);}
if(typeof(_options.required_caps)==='string'){_options.required_caps=Runtime.parseCaps(_options.required_caps);}
_options.required_caps=Basic.extend({},_options.required_caps,{return_response_type:self.responseType});if(data instanceof FormData){_options.required_caps.send_multipart=true;}
if(!_same_origin_flag){_options.required_caps.do_cors=true;}
if(_options.ruid){exec(_xhr.connectRuntime(_options));}else{_xhr.bind('RuntimeInit',function(e,runtime){exec(runtime);});_xhr.bind('RuntimeError',function(e,err){self.dispatchEvent('RuntimeError',err);});_xhr.connectRuntime(_options);}}
function _reset(){_p('responseText',"");_p('responseXML',null);_p('response',null);_p('status',0);_p('statusText',"");_start_time=_timeoutset_time=null;}}
XMLHttpRequest.UNSENT=0;XMLHttpRequest.OPENED=1;XMLHttpRequest.HEADERS_RECEIVED=2;XMLHttpRequest.LOADING=3;XMLHttpRequest.DONE=4;XMLHttpRequest.prototype=EventTarget.instance;return XMLHttpRequest;});define("moxie/runtime/Transporter",["moxie/core/utils/Basic","moxie/core/utils/Encode","moxie/runtime/RuntimeClient","moxie/core/EventTarget"],function(Basic,Encode,RuntimeClient,EventTarget){function Transporter(){var mod,_runtime,_data,_size,_pos,_chunk_size;RuntimeClient.call(this);Basic.extend(this,{uid:Basic.guid('uid_'),state:Transporter.IDLE,result:null,transport:function(data,type,options){var self=this;options=Basic.extend({chunk_size:204798},options);if((mod=options.chunk_size%3)){options.chunk_size+=3-mod;}
_chunk_size=options.chunk_size;_reset.call(this);_data=data;_size=data.length;if(Basic.typeOf(options)==='string'||options.ruid){_run.call(self,type,this.connectRuntime(options));}else{var cb=function(e,runtime){self.unbind("RuntimeInit",cb);_run.call(self,type,runtime);};this.bind("RuntimeInit",cb);this.connectRuntime(options);}},abort:function(){var self=this;self.state=Transporter.IDLE;if(_runtime){_runtime.exec.call(self,'Transporter','clear');self.trigger("TransportingAborted");}
_reset.call(self);},destroy:function(){this.unbindAll();_runtime=null;this.disconnectRuntime();_reset.call(this);}});function _reset(){_size=_pos=0;_data=this.result=null;}
function _run(type,runtime){var self=this;_runtime=runtime;self.bind("TransportingProgress",function(e){_pos=e.loaded;if(_pos<_size&&Basic.inArray(self.state,[Transporter.IDLE,Transporter.DONE])===-1){_transport.call(self);}},999);self.bind("TransportingComplete",function(){_pos=_size;self.state=Transporter.DONE;_data=null;self.result=_runtime.exec.call(self,'Transporter','getAsBlob',type||'');},999);self.state=Transporter.BUSY;self.trigger("TransportingStarted");_transport.call(self);}
function _transport(){var self=this,chunk,bytesLeft=_size-_pos;if(_chunk_size>bytesLeft){_chunk_size=bytesLeft;}
chunk=Encode.btoa(_data.substr(_pos,_chunk_size));_runtime.exec.call(self,'Transporter','receive',chunk,_size);}}
Transporter.IDLE=0;Transporter.BUSY=1;Transporter.DONE=2;Transporter.prototype=EventTarget.instance;return Transporter;});define("moxie/image/Image",["moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/file/FileReaderSync","moxie/xhr/XMLHttpRequest","moxie/runtime/Runtime","moxie/runtime/RuntimeClient","moxie/runtime/Transporter","moxie/core/utils/Env","moxie/core/EventTarget","moxie/file/Blob","moxie/file/File","moxie/core/utils/Encode"],function(Basic,Dom,x,FileReaderSync,XMLHttpRequest,Runtime,RuntimeClient,Transporter,Env,EventTarget,Blob,File,Encode){var dispatches=['progress','load','error','resize','embedded'];function Image(){RuntimeClient.call(this);Basic.extend(this,{uid:Basic.guid('uid_'),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments);},load:function(){this.bind('Load Resize',function(){_updateInfo.call(this);},999);this.convertEventPropsToHandlers(dispatches);_load.apply(this,arguments);},downsize:function(opts){var defaults={width:this.width,height:this.height,crop:false,preserveHeaders:true};if(typeof(opts)==='object'){opts=Basic.extend(defaults,opts);}else{opts=Basic.extend(defaults,{width:arguments[0],height:arguments[1],crop:arguments[2],preserveHeaders:arguments[3]});}
try{if(!this.size){throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);}
if(this.width>Image.MAX_RESIZE_WIDTH||this.height>Image.MAX_RESIZE_HEIGHT){throw new x.ImageError(x.ImageError.MAX_RESOLUTION_ERR);}
this.getRuntime().exec.call(this,'Image','downsize',opts.width,opts.height,opts.crop,opts.preserveHeaders);}catch(ex){this.trigger('error',ex.code);}},crop:function(width,height,preserveHeaders){this.downsize(width,height,true,preserveHeaders);},getAsCanvas:function(){if(!Env.can('create_canvas')){throw new x.RuntimeError(x.RuntimeError.NOT_SUPPORTED_ERR);}
var runtime=this.connectRuntime(this.ruid);return runtime.exec.call(this,'Image','getAsCanvas');},getAsBlob:function(type,quality){if(!this.size){throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);}
if(!type){type='image/jpeg';}
if(type==='image/jpeg'&&!quality){quality=90;}
return this.getRuntime().exec.call(this,'Image','getAsBlob',type,quality);},getAsDataURL:function(type,quality){if(!this.size){throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);}
return this.getRuntime().exec.call(this,'Image','getAsDataURL',type,quality);},getAsBinaryString:function(type,quality){var dataUrl=this.getAsDataURL(type,quality);return Encode.atob(dataUrl.substring(dataUrl.indexOf('base64,')+7));},embed:function(el){var self=this,imgCopy,type,quality,crop,options=arguments[1]||{},width=this.width,height=this.height,runtime;function onResize(){if(Env.can('create_canvas')){var canvas=imgCopy.getAsCanvas();if(canvas){el.appendChild(canvas);canvas=null;imgCopy.destroy();self.trigger('embedded');return;}}
var dataUrl=imgCopy.getAsDataURL(type,quality);if(!dataUrl){throw new x.ImageError(x.ImageError.WRONG_FORMAT);}
if(Env.can('use_data_uri_of',dataUrl.length)){el.innerHTML='<img src="'+dataUrl+'" width="'+imgCopy.width+'" height="'+imgCopy.height+'" />';imgCopy.destroy();self.trigger('embedded');}else{var tr=new Transporter();tr.bind("TransportingComplete",function(){runtime=self.connectRuntime(this.result.ruid);self.bind("Embedded",function(){Basic.extend(runtime.getShimContainer().style,{top:'0px',left:'0px',width:imgCopy.width+'px',height:imgCopy.height+'px'});runtime=null;},999);runtime.exec.call(self,"ImageView","display",this.result.uid,width,height);imgCopy.destroy();});tr.transport(Encode.atob(dataUrl.substring(dataUrl.indexOf('base64,')+7)),type,Basic.extend({},options,{required_caps:{display_media:true},runtime_order:'flash,silverlight',container:el}));}}
try{if(!(el=Dom.get(el))){throw new x.DOMException(x.DOMException.INVALID_NODE_TYPE_ERR);}
if(!this.size){throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);}
if(this.width>Image.MAX_RESIZE_WIDTH||this.height>Image.MAX_RESIZE_HEIGHT){throw new x.ImageError(x.ImageError.MAX_RESOLUTION_ERR);}
type=options.type||this.type||'image/jpeg';quality=options.quality||90;crop=Basic.typeOf(options.crop)!=='undefined'?options.crop:false;if(options.width){width=options.width;height=options.height||width;}else{var dimensions=Dom.getSize(el);if(dimensions.w&&dimensions.h){width=dimensions.w;height=dimensions.h;}}
imgCopy=new Image();imgCopy.bind("Resize",function(){onResize.call(self);});imgCopy.bind("Load",function(){imgCopy.downsize(width,height,crop,false);});imgCopy.clone(this,false);return imgCopy;}catch(ex){this.trigger('error',ex.code);}},destroy:function(){if(this.ruid){this.getRuntime().exec.call(this,'Image','destroy');this.disconnectRuntime();}
this.unbindAll();}});function _updateInfo(info){if(!info){info=this.getRuntime().exec.call(this,'Image','getInfo');}
this.size=info.size;this.width=info.width;this.height=info.height;this.type=info.type;this.meta=info.meta;if(this.name===''){this.name=info.name;}}
function _load(src){var srcType=Basic.typeOf(src);try{if(src instanceof Image){if(!src.size){throw new x.DOMException(x.DOMException.INVALID_STATE_ERR);}
_loadFromImage.apply(this,arguments);}
else if(src instanceof Blob){if(!~Basic.inArray(src.type,['image/jpeg','image/png'])){throw new x.ImageError(x.ImageError.WRONG_FORMAT);}
_loadFromBlob.apply(this,arguments);}
else if(Basic.inArray(srcType,['blob','file'])!==-1){_load.call(this,new File(null,src),arguments[1]);}
else if(srcType==='string'){if(/^data:[^;]*;base64,/.test(src)){_load.call(this,new Blob(null,{data:src}),arguments[1]);}
else{_loadFromUrl.apply(this,arguments);}}
else if(srcType==='node'&&src.nodeName.toLowerCase()==='img'){_load.call(this,src.src,arguments[1]);}
else{throw new x.DOMException(x.DOMException.TYPE_MISMATCH_ERR);}}catch(ex){this.trigger('error',ex.code);}}
function _loadFromImage(img,exact){var runtime=this.connectRuntime(img.ruid);this.ruid=runtime.uid;runtime.exec.call(this,'Image','loadFromImage',img,(Basic.typeOf(exact)==='undefined'?true:exact));}
function _loadFromBlob(blob,options){var self=this;self.name=blob.name||'';function exec(runtime){self.ruid=runtime.uid;runtime.exec.call(self,'Image','loadFromBlob',blob);}
if(blob.isDetached()){this.bind('RuntimeInit',function(e,runtime){exec(runtime);});if(options&&typeof(options.required_caps)==='string'){options.required_caps=Runtime.parseCaps(options.required_caps);}
this.connectRuntime(Basic.extend({required_caps:{access_image_binary:true,resize_image:true}},options));}else{exec(this.connectRuntime(blob.ruid));}}
function _loadFromUrl(url,options){var self=this,xhr;xhr=new XMLHttpRequest();xhr.open('get',url);xhr.responseType='blob';xhr.onprogress=function(e){self.trigger(e);};xhr.onload=function(){_loadFromBlob.call(self,xhr.response,true);};xhr.onerror=function(e){self.trigger(e);};xhr.onloadend=function(){xhr.destroy();};xhr.bind('RuntimeError',function(e,err){self.trigger('RuntimeError',err);});xhr.send(null,options);}}
Image.MAX_RESIZE_WIDTH=6500;Image.MAX_RESIZE_HEIGHT=6500;Image.prototype=EventTarget.instance;return Image;});define("moxie/runtime/html5/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(Basic,x,Runtime,Env){var type="html5",extensions={};function Html5Runtime(options){var I=this,Test=Runtime.capTest,True=Runtime.capTrue;var caps=Basic.extend({access_binary:Test(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return I.can('access_binary')&&!!extensions.Image;},display_media:Test(Env.can('create_canvas')||Env.can('use_data_uri_over32kb')),do_cors:Test(window.XMLHttpRequest&&'withCredentials'in new XMLHttpRequest()),drag_and_drop:Test(function(){var div=document.createElement('div');return(('draggable'in div)||('ondragstart'in div&&'ondrop'in div))&&(Env.browser!=='IE'||Env.version>9);}()),filter_by_extension:Test(function(){return(Env.browser==='Chrome'&&Env.version>=28)||(Env.browser==='IE'&&Env.version>=10);}()),return_response_headers:True,return_response_type:function(responseType){if(responseType==='json'&&!!window.JSON){return true;}
return Env.can('return_response_type',responseType);},return_status_code:True,report_upload_progress:Test(window.XMLHttpRequest&&new XMLHttpRequest().upload),resize_image:function(){return I.can('access_binary')&&Env.can('create_canvas');},select_file:function(){return Env.can('use_fileinput')&&window.File;},select_folder:function(){return I.can('select_file')&&Env.browser==='Chrome'&&Env.version>=21;},select_multiple:function(){return I.can('select_file')&&!(Env.browser==='Safari'&&Env.os==='Windows')&&!(Env.os==='iOS'&&Env.verComp(Env.osVersion,"7.0.4",'<'));},send_binary_string:Test(window.XMLHttpRequest&&(new XMLHttpRequest().sendAsBinary||(window.Uint8Array&&window.ArrayBuffer))),send_custom_headers:Test(window.XMLHttpRequest),send_multipart:function(){return!!(window.XMLHttpRequest&&new XMLHttpRequest().upload&&window.FormData)||I.can('send_binary_string');},slice_blob:Test(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return I.can('slice_blob')&&I.can('send_multipart');},summon_file_dialog:Test(function(){return(Env.browser==='Firefox'&&Env.version>=4)||(Env.browser==='Opera'&&Env.version>=12)||(Env.browser==='IE'&&Env.version>=10)||!!~Basic.inArray(Env.browser,['Chrome','Safari']);}()),upload_filesize:True},arguments[2]);Runtime.call(this,options,(arguments[1]||type),caps);Basic.extend(this,{init:function(){this.trigger("Init");},destroy:(function(destroy){return function(){destroy.call(I);destroy=I=null;};}(this.destroy))});Basic.extend(this.getShim(),extensions);}
Runtime.addConstructor(type,Html5Runtime);return extensions;});define("moxie/runtime/html5/file/Blob",["moxie/runtime/html5/Runtime","moxie/file/Blob"],function(extensions,Blob){function HTML5Blob(){function w3cBlobSlice(blob,start,end){var blobSlice;if(window.File.prototype.slice){try{blob.slice();return blob.slice(start,end);}catch(e){return blob.slice(start,end-start);}}else if((blobSlice=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)){return blobSlice.call(blob,start,end);}else{return null;}}
this.slice=function(){return new Blob(this.getRuntime().uid,w3cBlobSlice.apply(this,arguments));};}
return(extensions.Blob=HTML5Blob);});define('moxie/core/utils/Events',['moxie/core/utils/Basic'],function(Basic){var eventhash={},uid='moxie_'+Basic.guid();function preventDefault(){this.returnValue=false;}
function stopPropagation(){this.cancelBubble=true;}
var addEvent=function(obj,name,callback,key){var func,events;name=name.toLowerCase();if(obj.addEventListener){func=callback;obj.addEventListener(name,func,false);}else if(obj.attachEvent){func=function(){var evt=window.event;if(!evt.target){evt.target=evt.srcElement;}
evt.preventDefault=preventDefault;evt.stopPropagation=stopPropagation;callback(evt);};obj.attachEvent('on'+name,func);}
if(!obj[uid]){obj[uid]=Basic.guid();}
if(!eventhash.hasOwnProperty(obj[uid])){eventhash[obj[uid]]={};}
events=eventhash[obj[uid]];if(!events.hasOwnProperty(name)){events[name]=[];}
events[name].push({func:func,orig:callback,key:key});};var removeEvent=function(obj,name,callback){var type,undef;name=name.toLowerCase();if(obj[uid]&&eventhash[obj[uid]]&&eventhash[obj[uid]][name]){type=eventhash[obj[uid]][name];}else{return;}
for(var i=type.length-1;i>=0;i--){if(type[i].orig===callback||type[i].key===callback){if(obj.removeEventListener){obj.removeEventListener(name,type[i].func,false);}else if(obj.detachEvent){obj.detachEvent('on'+name,type[i].func);}
type[i].orig=null;type[i].func=null;type.splice(i,1);if(callback!==undef){break;}}}
if(!type.length){delete eventhash[obj[uid]][name];}
if(Basic.isEmptyObj(eventhash[obj[uid]])){delete eventhash[obj[uid]];try{delete obj[uid];}catch(e){obj[uid]=undef;}}};var removeAllEvents=function(obj,key){if(!obj||!obj[uid]){return;}
Basic.each(eventhash[obj[uid]],function(events,name){removeEvent(obj,name,key);});};return{addEvent:addEvent,removeEvent:removeEvent,removeAllEvents:removeAllEvents};});define("moxie/runtime/html5/file/FileInput",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime","moxie/core/utils/Env"],function(extensions,Basic,Dom,Events,Mime,Env){function FileInput(){var _files=[],_options;Basic.extend(this,{init:function(options){var comp=this,I=comp.getRuntime(),input,shimContainer,mimes,browseButton,zIndex,top;_options=options;_files=[];mimes=_options.accept.mimes||Mime.extList2mimes(_options.accept,I.can('filter_by_extension'));shimContainer=I.getShimContainer();shimContainer.innerHTML='<input id="'+I.uid+'" type="file" style="font-size:999px;opacity:0;"'+
(_options.multiple&&I.can('select_multiple')?'multiple':'')+
(_options.directory&&I.can('select_folder')?'webkitdirectory directory':'')+
(mimes?' accept="'+mimes.join(',')+'"':'')+' />';input=Dom.get(I.uid);Basic.extend(input.style,{position:'absolute',top:0,left:0,width:'100%',height:'100%'});browseButton=Dom.get(_options.browse_button);if(I.can('summon_file_dialog')){if(Dom.getStyle(browseButton,'position')==='static'){browseButton.style.position='relative';}
zIndex=parseInt(Dom.getStyle(browseButton,'z-index'),10)||1;browseButton.style.zIndex=zIndex;shimContainer.style.zIndex=zIndex-1;Events.addEvent(browseButton,'click',function(e){var input=Dom.get(I.uid);if(input&&!input.disabled){input.click();}
e.preventDefault();},comp.uid);}
top=I.can('summon_file_dialog')?browseButton:shimContainer;Events.addEvent(top,'mouseover',function(){comp.trigger('mouseenter');},comp.uid);Events.addEvent(top,'mouseout',function(){comp.trigger('mouseleave');},comp.uid);Events.addEvent(top,'mousedown',function(){comp.trigger('mousedown');},comp.uid);Events.addEvent(Dom.get(_options.container),'mouseup',function(){comp.trigger('mouseup');},comp.uid);input.onchange=function onChange(){_files=[];if(_options.directory){Basic.each(this.files,function(file){if(file.name!=="."){_files.push(file);}});}else{_files=[].slice.call(this.files);}
if(Env.browser!=='IE'&&Env.browser!=='IEMobile'){this.value='';}else{var clone=this.cloneNode(true);this.parentNode.replaceChild(clone,this);clone.onchange=onChange;}
comp.trigger('change');};comp.trigger({type:'ready',async:true});shimContainer=null;},getFiles:function(){return _files;},disable:function(state){var I=this.getRuntime(),input;if((input=Dom.get(I.uid))){input.disabled=!!state;}},destroy:function(){var I=this.getRuntime(),shim=I.getShim(),shimContainer=I.getShimContainer();Events.removeAllEvents(shimContainer,this.uid);Events.removeAllEvents(_options&&Dom.get(_options.container),this.uid);Events.removeAllEvents(_options&&Dom.get(_options.browse_button),this.uid);if(shimContainer){shimContainer.innerHTML='';}
shim.removeInstance(this.uid);_files=_options=shimContainer=shim=null;}});}
return(extensions.FileInput=FileInput);});define("moxie/runtime/html5/file/FileDrop",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime"],function(extensions,Basic,Dom,Events,Mime){function FileDrop(){var _files=[],_allowedExts=[],_options;Basic.extend(this,{init:function(options){var comp=this,dropZone;_options=options;_allowedExts=_extractExts(_options.accept);dropZone=_options.container;Events.addEvent(dropZone,'dragover',function(e){if(!_hasFiles(e)){return;}
e.preventDefault();e.dataTransfer.dropEffect='copy';},comp.uid);Events.addEvent(dropZone,'drop',function(e){if(!_hasFiles(e)){return;}
e.preventDefault();_files=[];if(e.dataTransfer.items&&e.dataTransfer.items[0].webkitGetAsEntry){_readItems(e.dataTransfer.items,function(){comp.trigger("drop");});}else{Basic.each(e.dataTransfer.files,function(file){if(_isAcceptable(file)){_files.push(file);}});comp.trigger("drop");}},comp.uid);Events.addEvent(dropZone,'dragenter',function(e){comp.trigger("dragenter");},comp.uid);Events.addEvent(dropZone,'dragleave',function(e){comp.trigger("dragleave");},comp.uid);},getFiles:function(){return _files;},destroy:function(){Events.removeAllEvents(_options&&Dom.get(_options.container),this.uid);_files=_allowedExts=_options=null;}});function _hasFiles(e){if(!e.dataTransfer||!e.dataTransfer.types){return false;}
var types=Basic.toArray(e.dataTransfer.types||[]);return Basic.inArray("Files",types)!==-1||Basic.inArray("public.file-url",types)!==-1||Basic.inArray("application/x-moz-file",types)!==-1;}
function _extractExts(accept){var exts=[];for(var i=0;i<accept.length;i++){[].push.apply(exts,accept[i].extensions.split(/\s*,\s*/));}
return Basic.inArray('*',exts)===-1?exts:[];}
function _isAcceptable(file){if(!_allowedExts.length){return true;}
var ext=Mime.getFileExtension(file.name);return!ext||Basic.inArray(ext,_allowedExts)!==-1;}
function _readItems(items,cb){var entries=[];Basic.each(items,function(item){var entry=item.webkitGetAsEntry();if(entry){if(entry.isFile){var file=item.getAsFile();if(_isAcceptable(file)){_files.push(file);}}else{entries.push(entry);}}});if(entries.length){_readEntries(entries,cb);}else{cb();}}
function _readEntries(entries,cb){var queue=[];Basic.each(entries,function(entry){queue.push(function(cbcb){_readEntry(entry,cbcb);});});Basic.inSeries(queue,function(){cb();});}
function _readEntry(entry,cb){if(entry.isFile){entry.file(function(file){if(_isAcceptable(file)){_files.push(file);}
cb();},function(){cb();});}else if(entry.isDirectory){_readDirEntry(entry,cb);}else{cb();}}
function _readDirEntry(dirEntry,cb){var entries=[],dirReader=dirEntry.createReader();function getEntries(cbcb){dirReader.readEntries(function(moreEntries){if(moreEntries.length){[].push.apply(entries,moreEntries);getEntries(cbcb);}else{cbcb();}},cbcb);}
getEntries(function(){_readEntries(entries,cb);});}}
return(extensions.FileDrop=FileDrop);});define("moxie/runtime/html5/file/FileReader",["moxie/runtime/html5/Runtime","moxie/core/utils/Encode","moxie/core/utils/Basic"],function(extensions,Encode,Basic){function FileReader(){var _fr,_convertToBinary=false;Basic.extend(this,{read:function(op,blob){var target=this;_fr=new window.FileReader();_fr.addEventListener('progress',function(e){target.trigger(e);});_fr.addEventListener('load',function(e){target.trigger(e);});_fr.addEventListener('error',function(e){target.trigger(e,_fr.error);});_fr.addEventListener('loadend',function(){_fr=null;});if(Basic.typeOf(_fr[op])==='function'){_convertToBinary=false;_fr[op](blob.getSource());}else if(op==='readAsBinaryString'){_convertToBinary=true;_fr.readAsDataURL(blob.getSource());}},getResult:function(){return _fr&&_fr.result?(_convertToBinary?_toBinary(_fr.result):_fr.result):null;},abort:function(){if(_fr){_fr.abort();}},destroy:function(){_fr=null;}});function _toBinary(str){return Encode.atob(str.substring(str.indexOf('base64,')+7));}}
return(extensions.FileReader=FileReader);});define("moxie/runtime/html5/xhr/XMLHttpRequest",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/utils/Mime","moxie/core/utils/Url","moxie/file/File","moxie/file/Blob","moxie/xhr/FormData","moxie/core/Exceptions","moxie/core/utils/Env"],function(extensions,Basic,Mime,Url,File,Blob,FormData,x,Env){function XMLHttpRequest(){var self=this,_xhr,_filename;Basic.extend(this,{send:function(meta,data){var target=this,isGecko2_5_6=(Env.browser==='Mozilla'&&Env.version>=4&&Env.version<7),isAndroidBrowser=Env.browser==='Android Browser',mustSendAsBinary=false;_filename=meta.url.replace(/^.+?\/([\w\-\.]+)$/,'$1').toLowerCase();_xhr=_getNativeXHR();_xhr.open(meta.method,meta.url,meta.async,meta.user,meta.password);if(data instanceof Blob){if(data.isDetached()){mustSendAsBinary=true;}
data=data.getSource();}else if(data instanceof FormData){if(data.hasBlob()){if(data.getBlob().isDetached()){data=_prepareMultipart.call(target,data);mustSendAsBinary=true;}else if((isGecko2_5_6||isAndroidBrowser)&&Basic.typeOf(data.getBlob().getSource())==='blob'&&window.FileReader){_preloadAndSend.call(target,meta,data);return;}}
if(data instanceof FormData){var fd=new window.FormData();data.each(function(value,name){if(value instanceof Blob){fd.append(name,value.getSource());}else{fd.append(name,value);}});data=fd;}}
if(_xhr.upload){if(meta.withCredentials){_xhr.withCredentials=true;}
_xhr.addEventListener('load',function(e){target.trigger(e);});_xhr.addEventListener('error',function(e){target.trigger(e);});_xhr.addEventListener('progress',function(e){target.trigger(e);});_xhr.upload.addEventListener('progress',function(e){target.trigger({type:'UploadProgress',loaded:e.loaded,total:e.total});});}else{_xhr.onreadystatechange=function onReadyStateChange(){switch(_xhr.readyState){case 1:break;case 2:break;case 3:var total,loaded;try{if(Url.hasSameOrigin(meta.url)){total=_xhr.getResponseHeader('Content-Length')||0;}
if(_xhr.responseText){loaded=_xhr.responseText.length;}}catch(ex){total=loaded=0;}
target.trigger({type:'progress',lengthComputable:!!total,total:parseInt(total,10),loaded:loaded});break;case 4:_xhr.onreadystatechange=function(){};if(_xhr.status===0){target.trigger('error');}else{target.trigger('load');}
break;}};}
if(!Basic.isEmptyObj(meta.headers)){Basic.each(meta.headers,function(value,header){_xhr.setRequestHeader(header,value);});}
if(""!==meta.responseType&&'responseType'in _xhr){if('json'===meta.responseType&&!Env.can('return_response_type','json')){_xhr.responseType='text';}else{_xhr.responseType=meta.responseType;}}
if(!mustSendAsBinary){_xhr.send(data);}else{if(_xhr.sendAsBinary){_xhr.sendAsBinary(data);}else{(function(){var ui8a=new Uint8Array(data.length);for(var i=0;i<data.length;i++){ui8a[i]=(data.charCodeAt(i)&0xff);}
_xhr.send(ui8a.buffer);}());}}
target.trigger('loadstart');},getStatus:function(){try{if(_xhr){return _xhr.status;}}catch(ex){}
return 0;},getResponse:function(responseType){var I=this.getRuntime();try{switch(responseType){case'blob':var file=new File(I.uid,_xhr.response);var disposition=_xhr.getResponseHeader('Content-Disposition');if(disposition){var match=disposition.match(/filename=([\'\"'])([^\1]+)\1/);if(match){_filename=match[2];}}
file.name=_filename;if(!file.type){file.type=Mime.getFileMime(_filename);}
return file;case'json':if(!Env.can('return_response_type','json')){return _xhr.status===200&&!!window.JSON?JSON.parse(_xhr.responseText):null;}
return _xhr.response;case'document':return _getDocument(_xhr);default:return _xhr.responseText!==''?_xhr.responseText:null;}}catch(ex){return null;}},getAllResponseHeaders:function(){try{return _xhr.getAllResponseHeaders();}catch(ex){}
return'';},abort:function(){if(_xhr){_xhr.abort();}},destroy:function(){self=_filename=null;}});function _preloadAndSend(meta,data){var target=this,blob,fr;blob=data.getBlob().getSource();fr=new window.FileReader();fr.onload=function(){data.append(data.getBlobName(),new Blob(null,{type:blob.type,data:fr.result}));self.send.call(target,meta,data);};fr.readAsBinaryString(blob);}
function _getNativeXHR(){if(window.XMLHttpRequest&&!(Env.browser==='IE'&&Env.version<8)){return new window.XMLHttpRequest();}else{return(function(){var progIDs=['Msxml2.XMLHTTP.6.0','Microsoft.XMLHTTP'];for(var i=0;i<progIDs.length;i++){try{return new ActiveXObject(progIDs[i]);}catch(ex){}}})();}}
function _getDocument(xhr){var rXML=xhr.responseXML;var rText=xhr.responseText;if(Env.browser==='IE'&&rText&&rXML&&!rXML.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(xhr.getResponseHeader("Content-Type"))){rXML=new window.ActiveXObject("Microsoft.XMLDOM");rXML.async=false;rXML.validateOnParse=false;rXML.loadXML(rText);}
if(rXML){if((Env.browser==='IE'&&rXML.parseError!==0)||!rXML.documentElement||rXML.documentElement.tagName==="parsererror"){return null;}}
return rXML;}
function _prepareMultipart(fd){var boundary='----moxieboundary'+new Date().getTime(),dashdash='--',crlf='\r\n',multipart='',I=this.getRuntime();if(!I.can('send_binary_string')){throw new x.RuntimeError(x.RuntimeError.NOT_SUPPORTED_ERR);}
_xhr.setRequestHeader('Content-Type','multipart/form-data; boundary='+boundary);fd.each(function(value,name){if(value instanceof Blob){multipart+=dashdash+boundary+crlf+'Content-Disposition: form-data; name="'+name+'"; filename="'+unescape(encodeURIComponent(value.name||'blob'))+'"'+crlf+'Content-Type: '+(value.type||'application/octet-stream')+crlf+crlf+
value.getSource()+crlf;}else{multipart+=dashdash+boundary+crlf+'Content-Disposition: form-data; name="'+name+'"'+crlf+crlf+
unescape(encodeURIComponent(value))+crlf;}});multipart+=dashdash+boundary+dashdash+crlf;return multipart;}}
return(extensions.XMLHttpRequest=XMLHttpRequest);});define("moxie/runtime/html5/utils/BinaryReader",[],function(){return function(){var II=false,bin;function read(idx,size){var mv=II?0:-8*(size-1),sum=0,i;for(i=0;i<size;i++){sum|=(bin.charCodeAt(idx+i)<<Math.abs(mv+i*8));}
return sum;}
function putstr(segment,idx,length){length=arguments.length===3?length:bin.length-idx-1;bin=bin.substr(0,idx)+segment+bin.substr(length+idx);}
function write(idx,num,size){var str='',mv=II?0:-8*(size-1),i;for(i=0;i<size;i++){str+=String.fromCharCode((num>>Math.abs(mv+i*8))&255);}
putstr(str,idx,size);}
return{II:function(order){if(order===undefined){return II;}else{II=order;}},init:function(binData){II=false;bin=binData;},SEGMENT:function(idx,length,segment){switch(arguments.length){case 1:return bin.substr(idx,bin.length-idx-1);case 2:return bin.substr(idx,length);case 3:putstr(segment,idx,length);break;default:return bin;}},BYTE:function(idx){return read(idx,1);},SHORT:function(idx){return read(idx,2);},LONG:function(idx,num){if(num===undefined){return read(idx,4);}else{write(idx,num,4);}},SLONG:function(idx){var num=read(idx,4);return(num>2147483647?num-4294967296:num);},STRING:function(idx,size){var str='';for(size+=idx;idx<size;idx++){str+=String.fromCharCode(read(idx,1));}
return str;}};};});define("moxie/runtime/html5/image/JPEGHeaders",["moxie/runtime/html5/utils/BinaryReader"],function(BinaryReader){return function JPEGHeaders(data){var headers=[],read,idx,marker,length=0;read=new BinaryReader();read.init(data);if(read.SHORT(0)!==0xFFD8){return;}
idx=2;while(idx<=data.length){marker=read.SHORT(idx);if(marker>=0xFFD0&&marker<=0xFFD7){idx+=2;continue;}
if(marker===0xFFDA||marker===0xFFD9){break;}
length=read.SHORT(idx+2)+2;if(marker>=0xFFE1&&marker<=0xFFEF){headers.push({hex:marker,name:'APP'+(marker&0x000F),start:idx,length:length,segment:read.SEGMENT(idx,length)});}
idx+=length;}
read.init(null);return{headers:headers,restore:function(data){var max,i;read.init(data);idx=read.SHORT(2)==0xFFE0?4+read.SHORT(4):2;for(i=0,max=headers.length;i<max;i++){read.SEGMENT(idx,0,headers[i].segment);idx+=headers[i].length;}
data=read.SEGMENT();read.init(null);return data;},strip:function(data){var headers,jpegHeaders,i;jpegHeaders=new JPEGHeaders(data);headers=jpegHeaders.headers;jpegHeaders.purge();read.init(data);i=headers.length;while(i--){read.SEGMENT(headers[i].start,headers[i].length,'');}
data=read.SEGMENT();read.init(null);return data;},get:function(name){var array=[];for(var i=0,max=headers.length;i<max;i++){if(headers[i].name===name.toUpperCase()){array.push(headers[i].segment);}}
return array;},set:function(name,segment){var array=[],i,ii,max;if(typeof(segment)==='string'){array.push(segment);}else{array=segment;}
for(i=ii=0,max=headers.length;i<max;i++){if(headers[i].name===name.toUpperCase()){headers[i].segment=array[ii];headers[i].length=array[ii].length;ii++;}
if(ii>=array.length){break;}}},purge:function(){headers=[];read.init(null);read=null;}};};});define("moxie/runtime/html5/image/ExifParser",["moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(Basic,BinaryReader){return function ExifParser(){var data,tags,Tiff,offsets={},tagDescs;data=new BinaryReader();tags={tiff:{0x0112:'Orientation',0x010E:'ImageDescription',0x010F:'Make',0x0110:'Model',0x0131:'Software',0x8769:'ExifIFDPointer',0x8825:'GPSInfoIFDPointer'},exif:{0x9000:'ExifVersion',0xA001:'ColorSpace',0xA002:'PixelXDimension',0xA003:'PixelYDimension',0x9003:'DateTimeOriginal',0x829A:'ExposureTime',0x829D:'FNumber',0x8827:'ISOSpeedRatings',0x9201:'ShutterSpeedValue',0x9202:'ApertureValue',0x9207:'MeteringMode',0x9208:'LightSource',0x9209:'Flash',0x920A:'FocalLength',0xA402:'ExposureMode',0xA403:'WhiteBalance',0xA406:'SceneCaptureType',0xA404:'DigitalZoomRatio',0xA408:'Contrast',0xA409:'Saturation',0xA40A:'Sharpness'},gps:{0x0000:'GPSVersionID',0x0001:'GPSLatitudeRef',0x0002:'GPSLatitude',0x0003:'GPSLongitudeRef',0x0004:'GPSLongitude'}};tagDescs={'ColorSpace':{1:'sRGB',0:'Uncalibrated'},'MeteringMode':{0:'Unknown',1:'Average',2:'CenterWeightedAverage',3:'Spot',4:'MultiSpot',5:'Pattern',6:'Partial',255:'Other'},'LightSource':{1:'Daylight',2:'Fliorescent',3:'Tungsten',4:'Flash',9:'Fine weather',10:'Cloudy weather',11:'Shade',12:'Daylight fluorescent (D 5700 - 7100K)',13:'Day white fluorescent (N 4600 -5400K)',14:'Cool white fluorescent (W 3900 - 4500K)',15:'White fluorescent (WW 3200 - 3700K)',17:'Standard light A',18:'Standard light B',19:'Standard light C',20:'D55',21:'D65',22:'D75',23:'D50',24:'ISO studio tungsten',255:'Other'},'Flash':{0x0000:'Flash did not fire.',0x0001:'Flash fired.',0x0005:'Strobe return light not detected.',0x0007:'Strobe return light detected.',0x0009:'Flash fired, compulsory flash mode',0x000D:'Flash fired, compulsory flash mode, return light not detected',0x000F:'Flash fired, compulsory flash mode, return light detected',0x0010:'Flash did not fire, compulsory flash mode',0x0018:'Flash did not fire, auto mode',0x0019:'Flash fired, auto mode',0x001D:'Flash fired, auto mode, return light not detected',0x001F:'Flash fired, auto mode, return light detected',0x0020:'No flash function',0x0041:'Flash fired, red-eye reduction mode',0x0045:'Flash fired, red-eye reduction mode, return light not detected',0x0047:'Flash fired, red-eye reduction mode, return light detected',0x0049:'Flash fired, compulsory flash mode, red-eye reduction mode',0x004D:'Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected',0x004F:'Flash fired, compulsory flash mode, red-eye reduction mode, return light detected',0x0059:'Flash fired, auto mode, red-eye reduction mode',0x005D:'Flash fired, auto mode, return light not detected, red-eye reduction mode',0x005F:'Flash fired, auto mode, return light detected, red-eye reduction mode'},'ExposureMode':{0:'Auto exposure',1:'Manual exposure',2:'Auto bracket'},'WhiteBalance':{0:'Auto white balance',1:'Manual white balance'},'SceneCaptureType':{0:'Standard',1:'Landscape',2:'Portrait',3:'Night scene'},'Contrast':{0:'Normal',1:'Soft',2:'Hard'},'Saturation':{0:'Normal',1:'Low saturation',2:'High saturation'},'Sharpness':{0:'Normal',1:'Soft',2:'Hard'},'GPSLatitudeRef':{N:'North latitude',S:'South latitude'},'GPSLongitudeRef':{E:'East longitude',W:'West longitude'}};function extractTags(IFD_offset,tags2extract){var length=data.SHORT(IFD_offset),i,ii,tag,type,count,tagOffset,offset,value,values=[],hash={};for(i=0;i<length;i++){offset=tagOffset=IFD_offset+12*i+2;tag=tags2extract[data.SHORT(offset)];if(tag===undefined){continue;}
type=data.SHORT(offset+=2);count=data.LONG(offset+=2);offset+=4;values=[];switch(type){case 1:case 7:if(count>4){offset=data.LONG(offset)+offsets.tiffHeader;}
for(ii=0;ii<count;ii++){values[ii]=data.BYTE(offset+ii);}
break;case 2:if(count>4){offset=data.LONG(offset)+offsets.tiffHeader;}
hash[tag]=data.STRING(offset,count-1);continue;case 3:if(count>2){offset=data.LONG(offset)+offsets.tiffHeader;}
for(ii=0;ii<count;ii++){values[ii]=data.SHORT(offset+ii*2);}
break;case 4:if(count>1){offset=data.LONG(offset)+offsets.tiffHeader;}
for(ii=0;ii<count;ii++){values[ii]=data.LONG(offset+ii*4);}
break;case 5:offset=data.LONG(offset)+offsets.tiffHeader;for(ii=0;ii<count;ii++){values[ii]=data.LONG(offset+ii*4)/data.LONG(offset+ii*4+4);}
break;case 9:offset=data.LONG(offset)+offsets.tiffHeader;for(ii=0;ii<count;ii++){values[ii]=data.SLONG(offset+ii*4);}
break;case 10:offset=data.LONG(offset)+offsets.tiffHeader;for(ii=0;ii<count;ii++){values[ii]=data.SLONG(offset+ii*4)/data.SLONG(offset+ii*4+4);}
break;default:continue;}
value=(count==1?values[0]:values);if(tagDescs.hasOwnProperty(tag)&&typeof value!='object'){hash[tag]=tagDescs[tag][value];}else{hash[tag]=value;}}
return hash;}
function getIFDOffsets(){var idx=offsets.tiffHeader;data.II(data.SHORT(idx)==0x4949);if(data.SHORT(idx+=2)!==0x002A){return false;}
offsets.IFD0=offsets.tiffHeader+data.LONG(idx+=2);Tiff=extractTags(offsets.IFD0,tags.tiff);if('ExifIFDPointer'in Tiff){offsets.exifIFD=offsets.tiffHeader+Tiff.ExifIFDPointer;delete Tiff.ExifIFDPointer;}
if('GPSInfoIFDPointer'in Tiff){offsets.gpsIFD=offsets.tiffHeader+Tiff.GPSInfoIFDPointer;delete Tiff.GPSInfoIFDPointer;}
return true;}
function setTag(ifd,tag,value){var offset,length,tagOffset,valueOffset=0;if(typeof(tag)==='string'){var tmpTags=tags[ifd.toLowerCase()];for(var hex in tmpTags){if(tmpTags[hex]===tag){tag=hex;break;}}}
offset=offsets[ifd.toLowerCase()+'IFD'];length=data.SHORT(offset);for(var i=0;i<length;i++){tagOffset=offset+12*i+2;if(data.SHORT(tagOffset)==tag){valueOffset=tagOffset+8;break;}}
if(!valueOffset){return false;}
data.LONG(valueOffset,value);return true;}
return{init:function(segment){offsets={tiffHeader:10};if(segment===undefined||!segment.length){return false;}
data.init(segment);if(data.SHORT(0)===0xFFE1&&data.STRING(4,5).toUpperCase()==="EXIF\0"){return getIFDOffsets();}
return false;},TIFF:function(){return Tiff;},EXIF:function(){var Exif;Exif=extractTags(offsets.exifIFD,tags.exif);if(Exif.ExifVersion&&Basic.typeOf(Exif.ExifVersion)==='array'){for(var i=0,exifVersion='';i<Exif.ExifVersion.length;i++){exifVersion+=String.fromCharCode(Exif.ExifVersion[i]);}
Exif.ExifVersion=exifVersion;}
return Exif;},GPS:function(){var GPS;GPS=extractTags(offsets.gpsIFD,tags.gps);if(GPS.GPSVersionID&&Basic.typeOf(GPS.GPSVersionID)==='array'){GPS.GPSVersionID=GPS.GPSVersionID.join('.');}
return GPS;},setExif:function(tag,value){if(tag!=='PixelXDimension'&&tag!=='PixelYDimension'){return false;}
return setTag('exif',tag,value);},getBinary:function(){return data.SEGMENT();},purge:function(){data.init(null);data=Tiff=null;offsets={};}};};});define("moxie/runtime/html5/image/JPEG",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEGHeaders","moxie/runtime/html5/utils/BinaryReader","moxie/runtime/html5/image/ExifParser"],function(Basic,x,JPEGHeaders,BinaryReader,ExifParser){function JPEG(binstr){var _binstr,_br,_hm,_ep,_info,hasExif;function _getDimensions(){var idx=0,marker,length;while(idx<=_binstr.length){marker=_br.SHORT(idx+=2);if(marker>=0xFFC0&&marker<=0xFFC3){idx+=5;return{height:_br.SHORT(idx),width:_br.SHORT(idx+=2)};}
length=_br.SHORT(idx+=2);idx+=length-2;}
return null;}
_binstr=binstr;_br=new BinaryReader();_br.init(_binstr);if(_br.SHORT(0)!==0xFFD8){throw new x.ImageError(x.ImageError.WRONG_FORMAT);}
_hm=new JPEGHeaders(binstr);_ep=new ExifParser();hasExif=!!_ep.init(_hm.get('app1')[0]);_info=_getDimensions.call(this);Basic.extend(this,{type:'image/jpeg',size:_binstr.length,width:_info&&_info.width||0,height:_info&&_info.height||0,setExif:function(tag,value){if(!hasExif){return false;}
if(Basic.typeOf(tag)==='object'){Basic.each(tag,function(value,tag){_ep.setExif(tag,value);});}else{_ep.setExif(tag,value);}
_hm.set('app1',_ep.getBinary());},writeHeaders:function(){if(!arguments.length){return(_binstr=_hm.restore(_binstr));}
return _hm.restore(arguments[0]);},stripHeaders:function(binstr){return _hm.strip(binstr);},purge:function(){_purge.call(this);}});if(hasExif){this.meta={tiff:_ep.TIFF(),exif:_ep.EXIF(),gps:_ep.GPS()};}
function _purge(){if(!_ep||!_hm||!_br){return;}
_ep.purge();_hm.purge();_br.init(null);_binstr=_info=_hm=_ep=_br=null;}}
return JPEG;});define("moxie/runtime/html5/image/PNG",["moxie/core/Exceptions","moxie/core/utils/Basic","moxie/runtime/html5/utils/BinaryReader"],function(x,Basic,BinaryReader){function PNG(binstr){var _binstr,_br,_hm,_ep,_info;_binstr=binstr;_br=new BinaryReader();_br.init(_binstr);(function(){var idx=0,i=0,signature=[0x8950,0x4E47,0x0D0A,0x1A0A];for(i=0;i<signature.length;i++,idx+=2){if(signature[i]!=_br.SHORT(idx)){throw new x.ImageError(x.ImageError.WRONG_FORMAT);}}}());function _getDimensions(){var chunk,idx;chunk=_getChunkAt.call(this,8);if(chunk.type=='IHDR'){idx=chunk.start;return{width:_br.LONG(idx),height:_br.LONG(idx+=4)};}
return null;}
function _purge(){if(!_br){return;}
_br.init(null);_binstr=_info=_hm=_ep=_br=null;}
_info=_getDimensions.call(this);Basic.extend(this,{type:'image/png',size:_binstr.length,width:_info.width,height:_info.height,purge:function(){_purge.call(this);}});_purge.call(this);function _getChunkAt(idx){var length,type,start,CRC;length=_br.LONG(idx);type=_br.STRING(idx+=4,4);start=idx+=4;CRC=_br.LONG(idx+length);return{length:length,type:type,start:start,CRC:CRC};}}
return PNG;});define("moxie/runtime/html5/image/ImageInfo",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/html5/image/JPEG","moxie/runtime/html5/image/PNG"],function(Basic,x,JPEG,PNG){return function(binstr){var _cs=[JPEG,PNG],_img;_img=(function(){for(var i=0;i<_cs.length;i++){try{return new _cs[i](binstr);}catch(ex){}}
throw new x.ImageError(x.ImageError.WRONG_FORMAT);}());Basic.extend(this,{type:'',size:0,width:0,height:0,setExif:function(){},writeHeaders:function(data){return data;},stripHeaders:function(data){return data;},purge:function(){}});Basic.extend(this,_img);this.purge=function(){_img.purge();_img=null;};};});define("moxie/runtime/html5/image/MegaPixel",[],function(){function renderImageToCanvas(img,canvas,options){var iw=img.naturalWidth,ih=img.naturalHeight;var width=options.width,height=options.height;var x=options.x||0,y=options.y||0;var ctx=canvas.getContext('2d');if(detectSubsampling(img)){iw/=2;ih/=2;}
var d=1024;var tmpCanvas=document.createElement('canvas');tmpCanvas.width=tmpCanvas.height=d;var tmpCtx=tmpCanvas.getContext('2d');var vertSquashRatio=detectVerticalSquash(img,iw,ih);var sy=0;while(sy<ih){var sh=sy+d>ih?ih-sy:d;var sx=0;while(sx<iw){var sw=sx+d>iw?iw-sx:d;tmpCtx.clearRect(0,0,d,d);tmpCtx.drawImage(img,-sx,-sy);var dx=(sx*width/iw+x)<<0;var dw=Math.ceil(sw*width/iw);var dy=(sy*height/ih/vertSquashRatio+y)<<0;var dh=Math.ceil(sh*height/ih/vertSquashRatio);ctx.drawImage(tmpCanvas,0,0,sw,sh,dx,dy,dw,dh);sx+=d;}
sy+=d;}
tmpCanvas=tmpCtx=null;}
function detectSubsampling(img){var iw=img.naturalWidth,ih=img.naturalHeight;if(iw*ih>1024*1024){var canvas=document.createElement('canvas');canvas.width=canvas.height=1;var ctx=canvas.getContext('2d');ctx.drawImage(img,-iw+1,0);return ctx.getImageData(0,0,1,1).data[3]===0;}else{return false;}}
function detectVerticalSquash(img,iw,ih){var canvas=document.createElement('canvas');canvas.width=1;canvas.height=ih;var ctx=canvas.getContext('2d');ctx.drawImage(img,0,0);var data=ctx.getImageData(0,0,1,ih).data;var sy=0;var ey=ih;var py=ih;while(py>sy){var alpha=data[(py-1)*4+3];if(alpha===0){ey=py;}else{sy=py;}
py=(ey+sy)>>1;}
canvas=null;var ratio=(py/ih);return(ratio===0)?1:ratio;}
return{isSubsampled:detectSubsampling,renderTo:renderImageToCanvas};});define("moxie/runtime/html5/image/Image",["moxie/runtime/html5/Runtime","moxie/core/utils/Basic","moxie/core/Exceptions","moxie/core/utils/Encode","moxie/file/File","moxie/runtime/html5/image/ImageInfo","moxie/runtime/html5/image/MegaPixel","moxie/core/utils/Mime","moxie/core/utils/Env"],function(extensions,Basic,x,Encode,File,ImageInfo,MegaPixel,Mime,Env){function HTML5Image(){var me=this,_img,_imgInfo,_canvas,_binStr,_blob,_modified=false,_preserveHeaders=true;Basic.extend(this,{loadFromBlob:function(blob){var comp=this,I=comp.getRuntime(),asBinary=arguments.length>1?arguments[1]:true;if(!I.can('access_binary')){throw new x.RuntimeError(x.RuntimeError.NOT_SUPPORTED_ERR);}
_blob=blob;if(blob.isDetached()){_binStr=blob.getSource();_preload.call(this,_binStr);return;}else{_readAsDataUrl.call(this,blob.getSource(),function(dataUrl){if(asBinary){_binStr=_toBinary(dataUrl);}
_preload.call(comp,dataUrl);});}},loadFromImage:function(img,exact){this.meta=img.meta;_blob=new File(null,{name:img.name,size:img.size,type:img.type});_preload.call(this,exact?(_binStr=img.getAsBinaryString()):img.getAsDataURL());},getInfo:function(){var I=this.getRuntime(),info;if(!_imgInfo&&_binStr&&I.can('access_image_binary')){_imgInfo=new ImageInfo(_binStr);}
info={width:_getImg().width||0,height:_getImg().height||0,type:_blob.type||Mime.getFileMime(_blob.name),size:_binStr&&_binStr.length||_blob.size||0,name:_blob.name||'',meta:_imgInfo&&_imgInfo.meta||this.meta||{}};return info;},downsize:function(){_downsize.apply(this,arguments);},getAsCanvas:function(){if(_canvas){_canvas.id=this.uid+'_canvas';}
return _canvas;},getAsBlob:function(type,quality){if(type!==this.type){_downsize.call(this,this.width,this.height,false);}
return new File(null,{name:_blob.name||'',type:type,data:me.getAsBinaryString.call(this,type,quality)});},getAsDataURL:function(type){var quality=arguments[1]||90;if(!_modified){return _img.src;}
if('image/jpeg'!==type){return _canvas.toDataURL('image/png');}else{try{return _canvas.toDataURL('image/jpeg',quality/100);}catch(ex){return _canvas.toDataURL('image/jpeg');}}},getAsBinaryString:function(type,quality){if(!_modified){if(!_binStr){_binStr=_toBinary(me.getAsDataURL(type,quality));}
return _binStr;}
if('image/jpeg'!==type){_binStr=_toBinary(me.getAsDataURL(type,quality));}else{var dataUrl;if(!quality){quality=90;}
try{dataUrl=_canvas.toDataURL('image/jpeg',quality/100);}catch(ex){dataUrl=_canvas.toDataURL('image/jpeg');}
_binStr=_toBinary(dataUrl);if(_imgInfo){_binStr=_imgInfo.stripHeaders(_binStr);if(_preserveHeaders){if(_imgInfo.meta&&_imgInfo.meta.exif){_imgInfo.setExif({PixelXDimension:this.width,PixelYDimension:this.height});}
_binStr=_imgInfo.writeHeaders(_binStr);}
_imgInfo.purge();_imgInfo=null;}}
_modified=false;return _binStr;},destroy:function(){me=null;_purge.call(this);this.getRuntime().getShim().removeInstance(this.uid);}});function _getImg(){if(!_canvas&&!_img){throw new x.ImageError(x.DOMException.INVALID_STATE_ERR);}
return _canvas||_img;}
function _toBinary(str){return Encode.atob(str.substring(str.indexOf('base64,')+7));}
function _toDataUrl(str,type){return'data:'+(type||'')+';base64,'+Encode.btoa(str);}
function _preload(str){var comp=this;_img=new Image();_img.onerror=function(){_purge.call(this);comp.trigger('error',x.ImageError.WRONG_FORMAT);};_img.onload=function(){comp.trigger('load');};_img.src=/^data:[^;]*;base64,/.test(str)?str:_toDataUrl(str,_blob.type);}
function _readAsDataUrl(file,callback){var comp=this,fr;if(window.FileReader){fr=new FileReader();fr.onload=function(){callback(this.result);};fr.onerror=function(){comp.trigger('error',x.ImageError.WRONG_FORMAT);};fr.readAsDataURL(file);}else{return callback(file.getAsDataURL());}}
function _downsize(width,height,crop,preserveHeaders){var self=this,scale,mathFn,x=0,y=0,img,destWidth,destHeight,orientation;_preserveHeaders=preserveHeaders;orientation=(this.meta&&this.meta.tiff&&this.meta.tiff.Orientation)||1;if(Basic.inArray(orientation,[5,6,7,8])!==-1){var tmp=width;width=height;height=tmp;}
img=_getImg();if(!crop){scale=Math.min(width/img.width,height/img.height);}else{width=Math.min(width,img.width);height=Math.min(height,img.height);scale=Math.max(width/img.width,height/img.height);}
if(scale>1&&!crop&&preserveHeaders){this.trigger('Resize');return;}
if(!_canvas){_canvas=document.createElement("canvas");}
destWidth=Math.round(img.width*scale);destHeight=Math.round(img.height*scale);if(crop){_canvas.width=width;_canvas.height=height;if(destWidth>width){x=Math.round((destWidth-width)/2);}
if(destHeight>height){y=Math.round((destHeight-height)/2);}}else{_canvas.width=destWidth;_canvas.height=destHeight;}
if(!_preserveHeaders){_rotateToOrientaion(_canvas.width,_canvas.height,orientation);}
_drawToCanvas.call(this,img,_canvas,-x,-y,destWidth,destHeight);this.width=_canvas.width;this.height=_canvas.height;_modified=true;self.trigger('Resize');}
function _drawToCanvas(img,canvas,x,y,w,h){if(Env.OS==='iOS'){MegaPixel.renderTo(img,canvas,{width:w,height:h,x:x,y:y});}else{var ctx=canvas.getContext('2d');ctx.drawImage(img,x,y,w,h);}}
function _rotateToOrientaion(width,height,orientation){switch(orientation){case 5:case 6:case 7:case 8:_canvas.width=height;_canvas.height=width;break;default:_canvas.width=width;_canvas.height=height;}
var ctx=_canvas.getContext('2d');switch(orientation){case 2:ctx.translate(width,0);ctx.scale(-1,1);break;case 3:ctx.translate(width,height);ctx.rotate(Math.PI);break;case 4:ctx.translate(0,height);ctx.scale(1,-1);break;case 5:ctx.rotate(0.5*Math.PI);ctx.scale(1,-1);break;case 6:ctx.rotate(0.5*Math.PI);ctx.translate(0,-height);break;case 7:ctx.rotate(0.5*Math.PI);ctx.translate(width,-height);ctx.scale(-1,1);break;case 8:ctx.rotate(-0.5*Math.PI);ctx.translate(-width,0);break;}}
function _purge(){if(_imgInfo){_imgInfo.purge();_imgInfo=null;}
_binStr=_img=_canvas=_blob=null;_modified=false;}}
return(extensions.Image=HTML5Image);});define("moxie/runtime/flash/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(Basic,Env,Dom,x,Runtime){var type='flash',extensions={};function getShimVersion(){var version;try{version=navigator.plugins['Shockwave Flash'];version=version.description;}catch(e1){try{version=new ActiveXObject('ShockwaveFlash.ShockwaveFlash').GetVariable('$version');}catch(e2){version='0.0';}}
version=version.match(/\d+/g);return parseFloat(version[0]+'.'+version[1]);}
function FlashRuntime(options){var I=this,initTimer;options=Basic.extend({swf_url:Env.swf_url},options);Runtime.call(this,options,type,{access_binary:function(value){return value&&I.mode==='browser';},access_image_binary:function(value){return value&&I.mode==='browser';},display_media:Runtime.capTrue,do_cors:Runtime.capTrue,drag_and_drop:false,report_upload_progress:function(){return I.mode==='client';},resize_image:Runtime.capTrue,return_response_headers:false,return_response_type:function(responseType){if(responseType==='json'&&!!window.JSON){return true;}
return!Basic.arrayDiff(responseType,['','text','document'])||I.mode==='browser';},return_status_code:function(code){return I.mode==='browser'||!Basic.arrayDiff(code,[200,404]);},select_file:Runtime.capTrue,select_multiple:Runtime.capTrue,send_binary_string:function(value){return value&&I.mode==='browser';},send_browser_cookies:function(value){return value&&I.mode==='browser';},send_custom_headers:function(value){return value&&I.mode==='browser';},send_multipart:Runtime.capTrue,slice_blob:function(value){return value&&I.mode==='browser';},stream_upload:function(value){return value&&I.mode==='browser';},summon_file_dialog:false,upload_filesize:function(size){return Basic.parseSizeStr(size)<=2097152||I.mode==='client';},use_http_method:function(methods){return!Basic.arrayDiff(methods,['GET','POST']);}},{access_binary:function(value){return value?'browser':'client';},access_image_binary:function(value){return value?'browser':'client';},report_upload_progress:function(value){return value?'browser':'client';},return_response_type:function(responseType){return Basic.arrayDiff(responseType,['','text','json','document'])?'browser':['client','browser'];},return_status_code:function(code){return Basic.arrayDiff(code,[200,404])?'browser':['client','browser'];},send_binary_string:function(value){return value?'browser':'client';},send_browser_cookies:function(value){return value?'browser':'client';},send_custom_headers:function(value){return value?'browser':'client';},stream_upload:function(value){return value?'client':'browser';},upload_filesize:function(size){return Basic.parseSizeStr(size)>=2097152?'client':'browser';}},'client');if(getShimVersion()<10){this.mode=false;}
Basic.extend(this,{getShim:function(){return Dom.get(this.uid);},shimExec:function(component,action){var args=[].slice.call(arguments,2);return I.getShim().exec(this.uid,component,action,args);},init:function(){var html,el,container;container=this.getShimContainer();Basic.extend(container.style,{position:'absolute',top:'-8px',left:'-8px',width:'9px',height:'9px',overflow:'hidden'});html='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+options.swf_url+'" ';if(Env.browser==='IE'){html+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" ';}
html+='width="100%" height="100%" style="outline:0">'+'<param name="movie" value="'+options.swf_url+'" />'+'<param name="flashvars" value="uid='+escape(this.uid)+'&target='+Env.global_event_dispatcher+'" />'+'<param name="wmode" value="transparent" />'+'<param name="allowscriptaccess" value="always" />'+'</object>';if(Env.browser==='IE'){el=document.createElement('div');container.appendChild(el);el.outerHTML=html;el=container=null;}else{container.innerHTML=html;}
initTimer=setTimeout(function(){if(I&&!I.initialized){I.trigger("Error",new x.RuntimeError(x.RuntimeError.NOT_INIT_ERR));}},5000);},destroy:(function(destroy){return function(){destroy.call(I);clearTimeout(initTimer);options=initTimer=destroy=I=null;};}(this.destroy))},extensions);}
Runtime.addConstructor(type,FlashRuntime);return extensions;});define("moxie/runtime/flash/file/Blob",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(extensions,Blob){var FlashBlob={slice:function(blob,start,end,type){var self=this.getRuntime();if(start<0){start=Math.max(blob.size+start,0);}else if(start>0){start=Math.min(start,blob.size);}
if(end<0){end=Math.max(blob.size+end,0);}else if(end>0){end=Math.min(end,blob.size);}
blob=self.shimExec.call(this,'Blob','slice',start,end,type||'');if(blob){blob=new Blob(self.uid,blob);}
return blob;}};return(extensions.Blob=FlashBlob);});define("moxie/runtime/flash/file/FileInput",["moxie/runtime/flash/Runtime"],function(extensions){var FileInput={init:function(options){this.getRuntime().shimExec.call(this,'FileInput','init',{name:options.name,accept:options.accept,multiple:options.multiple});this.trigger('ready');}};return(extensions.FileInput=FileInput);});define("moxie/runtime/flash/file/FileReader",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(extensions,Encode){var _result='';function _formatData(data,op){switch(op){case'readAsText':return Encode.atob(data,'utf8');case'readAsBinaryString':return Encode.atob(data);case'readAsDataURL':return data;}
return null;}
var FileReader={read:function(op,blob){var target=this,self=target.getRuntime();if(op==='readAsDataURL'){_result='data:'+(blob.type||'')+';base64,';}
target.bind('Progress',function(e,data){if(data){_result+=_formatData(data,op);}});return self.shimExec.call(this,'FileReader','readAsBase64',blob.uid);},getResult:function(){return _result;},destroy:function(){_result=null;}};return(extensions.FileReader=FileReader);});define("moxie/runtime/flash/file/FileReaderSync",["moxie/runtime/flash/Runtime","moxie/core/utils/Encode"],function(extensions,Encode){function _formatData(data,op){switch(op){case'readAsText':return Encode.atob(data,'utf8');case'readAsBinaryString':return Encode.atob(data);case'readAsDataURL':return data;}
return null;}
var FileReaderSync={read:function(op,blob){var result,self=this.getRuntime();result=self.shimExec.call(this,'FileReaderSync','readAsBase64',blob.uid);if(!result){return null;}
if(op==='readAsDataURL'){result='data:'+(blob.type||'')+';base64,'+result;}
return _formatData(result,op,blob.type);}};return(extensions.FileReaderSync=FileReaderSync);});define("moxie/runtime/flash/xhr/XMLHttpRequest",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/file/Blob","moxie/file/File","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/runtime/Transporter"],function(extensions,Basic,Blob,File,FileReaderSync,FormData,Transporter){var XMLHttpRequest={send:function(meta,data){var target=this,self=target.getRuntime();function send(){meta.transport=self.mode;self.shimExec.call(target,'XMLHttpRequest','send',meta,data);}
function appendBlob(name,blob){self.shimExec.call(target,'XMLHttpRequest','appendBlob',name,blob.uid);data=null;send();}
function attachBlob(blob,cb){var tr=new Transporter();tr.bind("TransportingComplete",function(){cb(this.result);});tr.transport(blob.getSource(),blob.type,{ruid:self.uid});}
if(!Basic.isEmptyObj(meta.headers)){Basic.each(meta.headers,function(value,header){self.shimExec.call(target,'XMLHttpRequest','setRequestHeader',header,value.toString());});}
if(data instanceof FormData){var blobField;data.each(function(value,name){if(value instanceof Blob){blobField=name;}else{self.shimExec.call(target,'XMLHttpRequest','append',name,value);}});if(!data.hasBlob()){data=null;send();}else{var blob=data.getBlob();if(blob.isDetached()){attachBlob(blob,function(attachedBlob){blob.destroy();appendBlob(blobField,attachedBlob);});}else{appendBlob(blobField,blob);}}}else if(data instanceof Blob){if(data.isDetached()){attachBlob(data,function(attachedBlob){data.destroy();data=attachedBlob.uid;send();});}else{data=data.uid;send();}}else{send();}},getResponse:function(responseType){var frs,blob,self=this.getRuntime();blob=self.shimExec.call(this,'XMLHttpRequest','getResponseAsBlob');if(blob){blob=new File(self.uid,blob);if('blob'===responseType){return blob;}
try{frs=new FileReaderSync();if(!!~Basic.inArray(responseType,["","text"])){return frs.readAsText(blob);}else if('json'===responseType&&!!window.JSON){return JSON.parse(frs.readAsText(blob));}}finally{blob.destroy();}}
return null;},abort:function(upload_complete_flag){var self=this.getRuntime();self.shimExec.call(this,'XMLHttpRequest','abort');this.dispatchEvent('readystatechange');this.dispatchEvent('abort');}};return(extensions.XMLHttpRequest=XMLHttpRequest);});define("moxie/runtime/flash/runtime/Transporter",["moxie/runtime/flash/Runtime","moxie/file/Blob"],function(extensions,Blob){var Transporter={getAsBlob:function(type){var self=this.getRuntime(),blob=self.shimExec.call(this,'Transporter','getAsBlob',type);if(blob){return new Blob(self.uid,blob);}
return null;}};return(extensions.Transporter=Transporter);});define("moxie/runtime/flash/image/Image",["moxie/runtime/flash/Runtime","moxie/core/utils/Basic","moxie/runtime/Transporter","moxie/file/Blob","moxie/file/FileReaderSync"],function(extensions,Basic,Transporter,Blob,FileReaderSync){var Image={loadFromBlob:function(blob){var comp=this,self=comp.getRuntime();function exec(srcBlob){self.shimExec.call(comp,'Image','loadFromBlob',srcBlob.uid);comp=self=null;}
if(blob.isDetached()){var tr=new Transporter();tr.bind("TransportingComplete",function(){exec(tr.result.getSource());});tr.transport(blob.getSource(),blob.type,{ruid:self.uid});}else{exec(blob.getSource());}},loadFromImage:function(img){var self=this.getRuntime();return self.shimExec.call(this,'Image','loadFromImage',img.uid);},getAsBlob:function(type,quality){var self=this.getRuntime(),blob=self.shimExec.call(this,'Image','getAsBlob',type,quality);if(blob){return new Blob(self.uid,blob);}
return null;},getAsDataURL:function(){var self=this.getRuntime(),blob=self.Image.getAsBlob.apply(this,arguments),frs;if(!blob){return null;}
frs=new FileReaderSync();return frs.readAsDataURL(blob);}};return(extensions.Image=Image);});define("moxie/runtime/silverlight/Runtime",["moxie/core/utils/Basic","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/runtime/Runtime"],function(Basic,Env,Dom,x,Runtime){var type="silverlight",extensions={};function isInstalled(version){var isVersionSupported=false,control=null,actualVer,actualVerArray,reqVerArray,requiredVersionPart,actualVersionPart,index=0;try{try{control=new ActiveXObject('AgControl.AgControl');if(control.IsVersionSupported(version)){isVersionSupported=true;}
control=null;}catch(e){var plugin=navigator.plugins["Silverlight Plug-In"];if(plugin){actualVer=plugin.description;if(actualVer==="1.0.30226.2"){actualVer="2.0.30226.2";}
actualVerArray=actualVer.split(".");while(actualVerArray.length>3){actualVerArray.pop();}
while(actualVerArray.length<4){actualVerArray.push(0);}
reqVerArray=version.split(".");while(reqVerArray.length>4){reqVerArray.pop();}
do{requiredVersionPart=parseInt(reqVerArray[index],10);actualVersionPart=parseInt(actualVerArray[index],10);index++;}while(index<reqVerArray.length&&requiredVersionPart===actualVersionPart);if(requiredVersionPart<=actualVersionPart&&!isNaN(requiredVersionPart)){isVersionSupported=true;}}}}catch(e2){isVersionSupported=false;}
return isVersionSupported;}
function SilverlightRuntime(options){var I=this,initTimer;options=Basic.extend({xap_url:Env.xap_url},options);Runtime.call(this,options,type,{access_binary:Runtime.capTrue,access_image_binary:Runtime.capTrue,display_media:Runtime.capTrue,do_cors:Runtime.capTrue,drag_and_drop:false,report_upload_progress:Runtime.capTrue,resize_image:Runtime.capTrue,return_response_headers:function(value){return value&&I.mode==='client';},return_response_type:function(responseType){if(responseType!=='json'){return true;}else{return!!window.JSON;}},return_status_code:function(code){return I.mode==='client'||!Basic.arrayDiff(code,[200,404]);},select_file:Runtime.capTrue,select_multiple:Runtime.capTrue,send_binary_string:Runtime.capTrue,send_browser_cookies:function(value){return value&&I.mode==='browser';},send_custom_headers:function(value){return value&&I.mode==='client';},send_multipart:Runtime.capTrue,slice_blob:Runtime.capTrue,stream_upload:true,summon_file_dialog:false,upload_filesize:Runtime.capTrue,use_http_method:function(methods){return I.mode==='client'||!Basic.arrayDiff(methods,['GET','POST']);}},{return_response_headers:function(value){return value?'client':'browser';},return_status_code:function(code){return Basic.arrayDiff(code,[200,404])?'client':['client','browser'];},send_browser_cookies:function(value){return value?'browser':'client';},send_custom_headers:function(value){return value?'client':'browser';},use_http_method:function(methods){return Basic.arrayDiff(methods,['GET','POST'])?'client':['client','browser'];}});if(!isInstalled('2.0.31005.0')||Env.browser==='Opera'){this.mode=false;}
Basic.extend(this,{getShim:function(){return Dom.get(this.uid).content.Moxie;},shimExec:function(component,action){var args=[].slice.call(arguments,2);return I.getShim().exec(this.uid,component,action,args);},init:function(){var container;container=this.getShimContainer();container.innerHTML='<object id="'+this.uid+'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;">'+'<param name="source" value="'+options.xap_url+'"/>'+'<param name="background" value="Transparent"/>'+'<param name="windowless" value="true"/>'+'<param name="enablehtmlaccess" value="true"/>'+'<param name="initParams" value="uid='+this.uid+',target='+Env.global_event_dispatcher+'"/>'+'</object>';initTimer=setTimeout(function(){if(I&&!I.initialized){I.trigger("Error",new x.RuntimeError(x.RuntimeError.NOT_INIT_ERR));}},Env.OS!=='Windows'?10000:5000);},destroy:(function(destroy){return function(){destroy.call(I);clearTimeout(initTimer);options=initTimer=destroy=I=null;};}(this.destroy))},extensions);}
Runtime.addConstructor(type,SilverlightRuntime);return extensions;});define("moxie/runtime/silverlight/file/Blob",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/Blob"],function(extensions,Basic,Blob){return(extensions.Blob=Basic.extend({},Blob));});define("moxie/runtime/silverlight/file/FileInput",["moxie/runtime/silverlight/Runtime"],function(extensions){var FileInput={init:function(options){function toFilters(accept){var filter='';for(var i=0;i<accept.length;i++){filter+=(filter!==''?'|':'')+accept[i].title+" | *."+accept[i].extensions.replace(/,/g,';*.');}
return filter;}
this.getRuntime().shimExec.call(this,'FileInput','init',toFilters(options.accept),options.name,options.multiple);this.trigger('ready');}};return(extensions.FileInput=FileInput);});define("moxie/runtime/silverlight/file/FileDrop",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Dom","moxie/core/utils/Events"],function(extensions,Dom,Events){var FileDrop={init:function(){var comp=this,self=comp.getRuntime(),dropZone;dropZone=self.getShimContainer();Events.addEvent(dropZone,'dragover',function(e){e.preventDefault();e.stopPropagation();e.dataTransfer.dropEffect='copy';},comp.uid);Events.addEvent(dropZone,'dragenter',function(e){e.preventDefault();var flag=Dom.get(self.uid).dragEnter(e);if(flag){e.stopPropagation();}},comp.uid);Events.addEvent(dropZone,'drop',function(e){e.preventDefault();var flag=Dom.get(self.uid).dragDrop(e);if(flag){e.stopPropagation();}},comp.uid);return self.shimExec.call(this,'FileDrop','init');}};return(extensions.FileDrop=FileDrop);});define("moxie/runtime/silverlight/file/FileReader",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReader"],function(extensions,Basic,FileReader){return(extensions.FileReader=Basic.extend({},FileReader));});define("moxie/runtime/silverlight/file/FileReaderSync",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/file/FileReaderSync"],function(extensions,Basic,FileReaderSync){return(extensions.FileReaderSync=Basic.extend({},FileReaderSync));});define("moxie/runtime/silverlight/xhr/XMLHttpRequest",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/xhr/XMLHttpRequest"],function(extensions,Basic,XMLHttpRequest){return(extensions.XMLHttpRequest=Basic.extend({},XMLHttpRequest));});define("moxie/runtime/silverlight/runtime/Transporter",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/runtime/Transporter"],function(extensions,Basic,Transporter){return(extensions.Transporter=Basic.extend({},Transporter));});define("moxie/runtime/silverlight/image/Image",["moxie/runtime/silverlight/Runtime","moxie/core/utils/Basic","moxie/runtime/flash/image/Image"],function(extensions,Basic,Image){return(extensions.Image=Basic.extend({},Image,{getInfo:function(){var self=this.getRuntime(),grps=['tiff','exif','gps'],info={meta:{}},rawInfo=self.shimExec.call(this,'Image','getInfo');if(rawInfo.meta){Basic.each(grps,function(grp){var meta=rawInfo.meta[grp],tag,i,length,value;if(meta&&meta.keys){info.meta[grp]={};for(i=0,length=meta.keys.length;i<length;i++){tag=meta.keys[i];value=meta[tag];if(value){if(/^(\d|[1-9]\d+)$/.test(value)){value=parseInt(value,10);}else if(/^\d*\.\d+$/.test(value)){value=parseFloat(value);}
info.meta[grp][tag]=value;}}}});}
info.width=parseInt(rawInfo.width,10);info.height=parseInt(rawInfo.height,10);info.size=parseInt(rawInfo.size,10);info.type=rawInfo.type;info.name=rawInfo.name;return info;}}));});define("moxie/runtime/html4/Runtime",["moxie/core/utils/Basic","moxie/core/Exceptions","moxie/runtime/Runtime","moxie/core/utils/Env"],function(Basic,x,Runtime,Env){var type='html4',extensions={};function Html4Runtime(options){var I=this,Test=Runtime.capTest,True=Runtime.capTrue;Runtime.call(this,options,type,{access_binary:Test(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:false,display_media:Test(extensions.Image&&(Env.can('create_canvas')||Env.can('use_data_uri_over32kb'))),do_cors:false,drag_and_drop:false,filter_by_extension:Test(function(){return(Env.browser==='Chrome'&&Env.version>=28)||(Env.browser==='IE'&&Env.version>=10);}()),resize_image:function(){return extensions.Image&&I.can('access_binary')&&Env.can('create_canvas');},report_upload_progress:false,return_response_headers:false,return_response_type:function(responseType){if(responseType==='json'&&!!window.JSON){return true;}
return!!~Basic.inArray(responseType,['text','document','']);},return_status_code:function(code){return!Basic.arrayDiff(code,[200,404]);},select_file:function(){return Env.can('use_fileinput');},select_multiple:false,send_binary_string:false,send_custom_headers:false,send_multipart:true,slice_blob:false,stream_upload:function(){return I.can('select_file');},summon_file_dialog:Test(function(){return(Env.browser==='Firefox'&&Env.version>=4)||(Env.browser==='Opera'&&Env.version>=12)||!!~Basic.inArray(Env.browser,['Chrome','Safari']);}()),upload_filesize:True,use_http_method:function(methods){return!Basic.arrayDiff(methods,['GET','POST']);}});Basic.extend(this,{init:function(){this.trigger("Init");},destroy:(function(destroy){return function(){destroy.call(I);destroy=I=null;};}(this.destroy))});Basic.extend(this.getShim(),extensions);}
Runtime.addConstructor(type,Html4Runtime);return extensions;});define("moxie/runtime/html4/file/FileInput",["moxie/runtime/html4/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Events","moxie/core/utils/Mime","moxie/core/utils/Env"],function(extensions,Basic,Dom,Events,Mime,Env){function FileInput(){var _uid,_files=[],_mimes=[],_options;function addInput(){var comp=this,I=comp.getRuntime(),shimContainer,browseButton,currForm,form,input,uid;uid=Basic.guid('uid_');shimContainer=I.getShimContainer();if(_uid){currForm=Dom.get(_uid+'_form');if(currForm){Basic.extend(currForm.style,{top:'100%'});}}
form=document.createElement('form');form.setAttribute('id',uid+'_form');form.setAttribute('method','post');form.setAttribute('enctype','multipart/form-data');form.setAttribute('encoding','multipart/form-data');Basic.extend(form.style,{overflow:'hidden',position:'absolute',top:0,left:0,width:'100%',height:'100%'});input=document.createElement('input');input.setAttribute('id',uid);input.setAttribute('type','file');input.setAttribute('name',_options.name||'Filedata');input.setAttribute('accept',_mimes.join(','));Basic.extend(input.style,{fontSize:'999px',opacity:0});form.appendChild(input);shimContainer.appendChild(form);Basic.extend(input.style,{position:'absolute',top:0,left:0,width:'100%',height:'100%'});if(Env.browser==='IE'&&Env.version<10){Basic.extend(input.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"});}
input.onchange=function(){var file;if(!this.value){return;}
if(this.files){file=this.files[0];}else{file={name:this.value};}
_files=[file];this.onchange=function(){};addInput.call(comp);comp.bind('change',function onChange(){var input=Dom.get(uid),form=Dom.get(uid+'_form'),file;comp.unbind('change',onChange);if(comp.files.length&&input&&form){file=comp.files[0];input.setAttribute('id',file.uid);form.setAttribute('id',file.uid+'_form');form.setAttribute('target',file.uid+'_iframe');}
input=form=null;},998);input=form=null;comp.trigger('change');};if(I.can('summon_file_dialog')){browseButton=Dom.get(_options.browse_button);Events.removeEvent(browseButton,'click',comp.uid);Events.addEvent(browseButton,'click',function(e){if(input&&!input.disabled){input.click();}
e.preventDefault();},comp.uid);}
_uid=uid;shimContainer=currForm=browseButton=null;}
Basic.extend(this,{init:function(options){var comp=this,I=comp.getRuntime(),shimContainer;_options=options;_mimes=options.accept.mimes||Mime.extList2mimes(options.accept,I.can('filter_by_extension'));shimContainer=I.getShimContainer();(function(){var browseButton,zIndex,top;browseButton=Dom.get(options.browse_button);if(I.can('summon_file_dialog')){if(Dom.getStyle(browseButton,'position')==='static'){browseButton.style.position='relative';}
zIndex=parseInt(Dom.getStyle(browseButton,'z-index'),10)||1;browseButton.style.zIndex=zIndex;shimContainer.style.zIndex=zIndex-1;}
top=I.can('summon_file_dialog')?browseButton:shimContainer;Events.addEvent(top,'mouseover',function(){comp.trigger('mouseenter');},comp.uid);Events.addEvent(top,'mouseout',function(){comp.trigger('mouseleave');},comp.uid);Events.addEvent(top,'mousedown',function(){comp.trigger('mousedown');},comp.uid);Events.addEvent(Dom.get(options.container),'mouseup',function(){comp.trigger('mouseup');},comp.uid);browseButton=null;}());addInput.call(this);shimContainer=null;comp.trigger({type:'ready',async:true});},getFiles:function(){return _files;},disable:function(state){var input;if((input=Dom.get(_uid))){input.disabled=!!state;}},destroy:function(){var I=this.getRuntime(),shim=I.getShim(),shimContainer=I.getShimContainer();Events.removeAllEvents(shimContainer,this.uid);Events.removeAllEvents(_options&&Dom.get(_options.container),this.uid);Events.removeAllEvents(_options&&Dom.get(_options.browse_button),this.uid);if(shimContainer){shimContainer.innerHTML='';}
shim.removeInstance(this.uid);_uid=_files=_mimes=_options=shimContainer=shim=null;}});}
return(extensions.FileInput=FileInput);});define("moxie/runtime/html4/file/FileReader",["moxie/runtime/html4/Runtime","moxie/runtime/html5/file/FileReader"],function(extensions,FileReader){return(extensions.FileReader=FileReader);});define("moxie/runtime/html4/xhr/XMLHttpRequest",["moxie/runtime/html4/Runtime","moxie/core/utils/Basic","moxie/core/utils/Dom","moxie/core/utils/Url","moxie/core/Exceptions","moxie/core/utils/Events","moxie/file/Blob","moxie/xhr/FormData"],function(extensions,Basic,Dom,Url,x,Events,Blob,FormData){function XMLHttpRequest(){var _status,_response,_iframe;function cleanup(cb){var target=this,uid,form,inputs,i,hasFile=false;if(!_iframe){return;}
uid=_iframe.id.replace(/_iframe$/,'');form=Dom.get(uid+'_form');if(form){inputs=form.getElementsByTagName('input');i=inputs.length;while(i--){switch(inputs[i].getAttribute('type')){case'hidden':inputs[i].parentNode.removeChild(inputs[i]);break;case'file':hasFile=true;break;}}
inputs=[];if(!hasFile){form.parentNode.removeChild(form);}
form=null;}
setTimeout(function(){Events.removeEvent(_iframe,'load',target.uid);if(_iframe.parentNode){_iframe.parentNode.removeChild(_iframe);}
var shimContainer=target.getRuntime().getShimContainer();if(!shimContainer.children.length){shimContainer.parentNode.removeChild(shimContainer);}
shimContainer=_iframe=null;cb();},1);}
Basic.extend(this,{send:function(meta,data){var target=this,I=target.getRuntime(),uid,form,input,blob;_status=_response=null;function createIframe(){var container=I.getShimContainer()||document.body,temp=document.createElement('div');temp.innerHTML='<iframe id="'+uid+'_iframe" name="'+uid+'_iframe" src="javascript:&quot;&quot;" style="display:none"></iframe>';_iframe=temp.firstChild;container.appendChild(_iframe);Events.addEvent(_iframe,'load',function(){var el;try{el=_iframe.contentWindow.document||_iframe.contentDocument||window.frames[_iframe.id].document;if(/^4(0[0-9]|1[0-7]|2[2346])\s/.test(el.title)){_status=el.title.replace(/^(\d+).*$/,'$1');}else{_status=200;_response=Basic.trim(el.body.innerHTML);target.trigger({type:'progress',loaded:_response.length,total:_response.length});if(blob){target.trigger({type:'uploadprogress',loaded:blob.size||1025,total:blob.size||1025});}}}catch(ex){if(Url.hasSameOrigin(meta.url)){_status=404;}else{cleanup.call(target,function(){target.trigger('error');});return;}}
cleanup.call(target,function(){target.trigger('load');});},target.uid);}
if(data instanceof FormData&&data.hasBlob()){blob=data.getBlob();uid=blob.uid;input=Dom.get(uid);form=Dom.get(uid+'_form');if(!form){throw new x.DOMException(x.DOMException.NOT_FOUND_ERR);}}else{uid=Basic.guid('uid_');form=document.createElement('form');form.setAttribute('id',uid+'_form');form.setAttribute('method',meta.method);form.setAttribute('enctype','multipart/form-data');form.setAttribute('encoding','multipart/form-data');form.setAttribute('target',uid+'_iframe');I.getShimContainer().appendChild(form);}
if(data instanceof FormData){data.each(function(value,name){if(value instanceof Blob){if(input){input.setAttribute('name',name);}}else{var hidden=document.createElement('input');Basic.extend(hidden,{type:'hidden',name:name,value:value});if(input){form.insertBefore(hidden,input);}else{form.appendChild(hidden);}}});}
form.setAttribute("action",meta.url);createIframe();form.submit();target.trigger('loadstart');},getStatus:function(){return _status;},getResponse:function(responseType){if('json'===responseType){if(Basic.typeOf(_response)==='string'&&!!window.JSON){try{return JSON.parse(_response.replace(/^\s*<pre[^>]*>/,'').replace(/<\/pre>\s*$/,''));}catch(ex){return null;}}}else if('document'===responseType){}
return _response;},abort:function(){var target=this;if(_iframe&&_iframe.contentWindow){if(_iframe.contentWindow.stop){_iframe.contentWindow.stop();}else if(_iframe.contentWindow.document.execCommand){_iframe.contentWindow.document.execCommand('Stop');}else{_iframe.src="about:blank";}}
cleanup.call(this,function(){target.dispatchEvent('abort');});}});}
return(extensions.XMLHttpRequest=XMLHttpRequest);});define("moxie/runtime/html4/image/Image",["moxie/runtime/html4/Runtime","moxie/runtime/html5/image/Image"],function(extensions,Image){return(extensions.Image=Image);});expose(["moxie/core/utils/Basic","moxie/core/I18n","moxie/core/utils/Mime","moxie/core/utils/Env","moxie/core/utils/Dom","moxie/core/Exceptions","moxie/core/EventTarget","moxie/core/utils/Encode","moxie/runtime/Runtime","moxie/runtime/RuntimeClient","moxie/file/Blob","moxie/file/File","moxie/file/FileInput","moxie/file/FileDrop","moxie/runtime/RuntimeTarget","moxie/file/FileReader","moxie/core/utils/Url","moxie/file/FileReaderSync","moxie/xhr/FormData","moxie/xhr/XMLHttpRequest","moxie/runtime/Transporter","moxie/image/Image","moxie/core/utils/Events"]);})(this);(function(exports){"use strict";var o={},inArray=exports.moxie.core.utils.Basic.inArray;(function addAlias(ns){var name,itemType;for(name in ns){itemType=typeof(ns[name]);if(itemType==='object'&&!~inArray(name,['Exceptions','Env','Mime'])){addAlias(ns[name]);}else if(itemType==='function'){o[name]=ns[name];}}})(exports.moxie);o.Env=exports.moxie.core.utils.Env;o.Mime=exports.moxie.core.utils.Mime;o.Exceptions=exports.moxie.core.Exceptions;exports.mOxie=o;if(!exports.o){exports.o=o;}
return o;})(this);;;(function(window,o,undef){var delay=window.setTimeout,fileFilters={};function normalizeCaps(settings){var features=settings.required_features,caps={};function resolve(feature,value,strict){var map={chunks:'slice_blob',jpgresize:'send_binary_string',pngresize:'send_binary_string',progress:'report_upload_progress',multi_selection:'select_multiple',dragdrop:'drag_and_drop',drop_element:'drag_and_drop',headers:'send_custom_headers',urlstream_upload:'send_binary_string',canSendBinary:'send_binary',triggerDialog:'summon_file_dialog'};if(map[feature]){caps[map[feature]]=value;}else if(!strict){caps[feature]=value;}}
if(typeof(features)==='string'){plupload.each(features.split(/\s*,\s*/),function(feature){resolve(feature,true);});}else if(typeof(features)==='object'){plupload.each(features,function(value,feature){resolve(feature,value);});}else if(features===true){if(settings.chunk_size>0){caps.slice_blob=true;}
if(settings.resize.enabled||!settings.multipart){caps.send_binary_string=true;}
plupload.each(settings,function(value,feature){resolve(feature,!!value,true);});}
return caps;}
var plupload={VERSION:'2.1.2',STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:o.mimes,ua:o.ua,typeOf:o.typeOf,extend:o.extend,guid:o.guid,get:function get(ids){var els=[],el;if(o.typeOf(ids)!=='array'){ids=[ids];}
var i=ids.length;while(i--){el=o.get(ids[i]);if(el){els.push(el);}}
return els.length?els:null;},each:o.each,getPos:o.getPos,getSize:o.getSize,xmlEncode:function(str){var xmlEncodeChars={'<':'lt','>':'gt','&':'amp','"':'quot','\'':'#39'},xmlEncodeRegExp=/[<>&\"\']/g;return str?(''+str).replace(xmlEncodeRegExp,function(chr){return xmlEncodeChars[chr]?'&'+xmlEncodeChars[chr]+';':chr;}):str;},toArray:o.toArray,inArray:o.inArray,addI18n:o.addI18n,translate:o.translate,isEmptyObj:o.isEmptyObj,hasClass:o.hasClass,addClass:o.addClass,removeClass:o.removeClass,getStyle:o.getStyle,addEvent:o.addEvent,removeEvent:o.removeEvent,removeAllEvents:o.removeAllEvents,cleanName:function(name){var i,lookup;lookup=[/[\300-\306]/g,'A',/[\340-\346]/g,'a',/\307/g,'C',/\347/g,'c',/[\310-\313]/g,'E',/[\350-\353]/g,'e',/[\314-\317]/g,'I',/[\354-\357]/g,'i',/\321/g,'N',/\361/g,'n',/[\322-\330]/g,'O',/[\362-\370]/g,'o',/[\331-\334]/g,'U',/[\371-\374]/g,'u'];for(i=0;i<lookup.length;i+=2){name=name.replace(lookup[i],lookup[i+1]);}
name=name.replace(/\s+/g,'_');name=name.replace(/[^a-z0-9_\-\.]+/gi,'');return name;},buildUrl:function(url,items){var query='';plupload.each(items,function(value,name){query+=(query?'&':'')+encodeURIComponent(name)+'='+encodeURIComponent(value);});if(query){url+=(url.indexOf('?')>0?'&':'?')+query;}
return url;},formatSize:function(size){if(size===undef||/\D/.test(size)){return plupload.translate('N/A');}
function round(num,precision){return Math.round(num*Math.pow(10,precision))/Math.pow(10,precision);}
var boundary=Math.pow(1024,4);if(size>boundary){return round(size/boundary,1)+" "+plupload.translate('tb');}
if(size>(boundary/=1024)){return round(size/boundary,1)+" "+plupload.translate('gb');}
if(size>(boundary/=1024)){return round(size/boundary,1)+" "+plupload.translate('mb');}
if(size>1024){return Math.round(size/1024)+" "+plupload.translate('kb');}
return size+" "+plupload.translate('b');},parseSize:o.parseSizeStr,predictRuntime:function(config,runtimes){var up,runtime;up=new plupload.Uploader(config);runtime=o.Runtime.thatCan(up.getOption().required_features,runtimes||config.runtimes);up.destroy();return runtime;},addFileFilter:function(name,cb){fileFilters[name]=cb;}};plupload.addFileFilter('mime_types',function(filters,file,cb){if(filters.length&&!filters.regexp.test(file.name)){this.trigger('Error',{code:plupload.FILE_EXTENSION_ERROR,message:plupload.translate('File extension error.'),file:file});cb(false);}else{cb(true);}});plupload.addFileFilter('max_file_size',function(maxSize,file,cb){var undef;maxSize=plupload.parseSize(maxSize);if(file.size!==undef&&maxSize&&file.size>maxSize){this.trigger('Error',{code:plupload.FILE_SIZE_ERROR,message:plupload.translate('File size error.'),file:file});cb(false);}else{cb(true);}});plupload.addFileFilter('prevent_duplicates',function(value,file,cb){if(value){var ii=this.files.length;while(ii--){if(file.name===this.files[ii].name&&file.size===this.files[ii].size){this.trigger('Error',{code:plupload.FILE_DUPLICATE_ERROR,message:plupload.translate('Duplicate file error.'),file:file});cb(false);return;}}}
cb(true);});plupload.Uploader=function(options){var uid=plupload.guid(),settings,files=[],preferred_caps={},fileInputs=[],fileDrops=[],startTime,total,disabled=false,xhr;function uploadNext(){var file,count=0,i;if(this.state==plupload.STARTED){for(i=0;i<files.length;i++){if(!file&&files[i].status==plupload.QUEUED){file=files[i];if(this.trigger("BeforeUpload",file)){file.status=plupload.UPLOADING;this.trigger("UploadFile",file);}}else{count++;}}
if(count==files.length){if(this.state!==plupload.STOPPED){this.state=plupload.STOPPED;this.trigger("StateChanged");}
this.trigger("UploadComplete",files);}}}
function calcFile(file){file.percent=file.size>0?Math.ceil(file.loaded/file.size*100):100;calc();}
function calc(){var i,file;total.reset();for(i=0;i<files.length;i++){file=files[i];if(file.size!==undef){total.size+=file.origSize;total.loaded+=file.loaded*file.origSize/file.size;}else{total.size=undef;}
if(file.status==plupload.DONE){total.uploaded++;}else if(file.status==plupload.FAILED){total.failed++;}else{total.queued++;}}
if(total.size===undef){total.percent=files.length>0?Math.ceil(total.uploaded/files.length*100):0;}else{total.bytesPerSec=Math.ceil(total.loaded/((+new Date()-startTime||1)/1000.0));total.percent=total.size>0?Math.ceil(total.loaded/total.size*100):0;}}
function getRUID(){var ctrl=fileInputs[0]||fileDrops[0];if(ctrl){return ctrl.getRuntime().uid;}
return false;}
function runtimeCan(file,cap){if(file.ruid){var info=o.Runtime.getInfo(file.ruid);if(info){return info.can(cap);}}
return false;}
function bindEventListeners(){this.bind('FilesAdded FilesRemoved',function(up){up.trigger('QueueChanged');up.refresh();});this.bind('CancelUpload',onCancelUpload);this.bind('BeforeUpload',onBeforeUpload);this.bind('UploadFile',onUploadFile);this.bind('UploadProgress',onUploadProgress);this.bind('StateChanged',onStateChanged);this.bind('QueueChanged',calc);this.bind('Error',onError);this.bind('FileUploaded',onFileUploaded);this.bind('Destroy',onDestroy);}
function initControls(settings,cb){var self=this,inited=0,queue=[];var options={runtime_order:settings.runtimes,required_caps:settings.required_features,preferred_caps:preferred_caps,swf_url:settings.flash_swf_url,xap_url:settings.silverlight_xap_url};plupload.each(settings.runtimes.split(/\s*,\s*/),function(runtime){if(settings[runtime]){options[runtime]=settings[runtime];}});if(settings.browse_button){plupload.each(settings.browse_button,function(el){queue.push(function(cb){var fileInput=new o.FileInput(plupload.extend({},options,{accept:settings.filters.mime_types,name:settings.file_data_name,multiple:settings.multi_selection,container:settings.container,browse_button:el}));fileInput.onready=function(){var info=o.Runtime.getInfo(this.ruid);o.extend(self.features,{chunks:info.can('slice_blob'),multipart:info.can('send_multipart'),multi_selection:info.can('select_multiple')});inited++;fileInputs.push(this);cb();};fileInput.onchange=function(){self.addFile(this.files);};fileInput.bind('mouseenter mouseleave mousedown mouseup',function(e){if(!disabled){if(settings.browse_button_hover){if('mouseenter'===e.type){o.addClass(el,settings.browse_button_hover);}else if('mouseleave'===e.type){o.removeClass(el,settings.browse_button_hover);}}
if(settings.browse_button_active){if('mousedown'===e.type){o.addClass(el,settings.browse_button_active);}else if('mouseup'===e.type){o.removeClass(el,settings.browse_button_active);}}}});fileInput.bind('mousedown',function(){self.trigger('Browse');});fileInput.bind('error runtimeerror',function(){fileInput=null;cb();});fileInput.init();});});}
if(settings.drop_element){plupload.each(settings.drop_element,function(el){queue.push(function(cb){var fileDrop=new o.FileDrop(plupload.extend({},options,{drop_zone:el}));fileDrop.onready=function(){var info=o.Runtime.getInfo(this.ruid);self.features.dragdrop=info.can('drag_and_drop');inited++;fileDrops.push(this);cb();};fileDrop.ondrop=function(){self.addFile(this.files);};fileDrop.bind('error runtimeerror',function(){fileDrop=null;cb();});fileDrop.init();});});}
o.inSeries(queue,function(){if(typeof(cb)==='function'){cb(inited);}});}
function resizeImage(blob,params,cb){var img=new o.Image();try{img.onload=function(){if(params.width>this.width&&params.height>this.height&&params.quality===undef&&params.preserve_headers&&!params.crop){this.destroy();return cb(blob);}
img.downsize(params.width,params.height,params.crop,params.preserve_headers);};img.onresize=function(){cb(this.getAsBlob(blob.type,params.quality));this.destroy();};img.onerror=function(){cb(blob);};img.load(blob);}catch(ex){cb(blob);}}
function setOption(option,value,init){var self=this,reinitRequired=false;function _setOption(option,value,init){var oldValue=settings[option];switch(option){case'max_file_size':if(option==='max_file_size'){settings.max_file_size=settings.filters.max_file_size=value;}
break;case'chunk_size':if(value=plupload.parseSize(value)){settings[option]=value;settings.send_file_name=true;}
break;case'multipart':settings[option]=value;if(!value){settings.send_file_name=true;}
break;case'unique_names':settings[option]=value;if(value){settings.send_file_name=true;}
break;case'filters':if(plupload.typeOf(value)==='array'){value={mime_types:value};}
if(init){plupload.extend(settings.filters,value);}else{settings.filters=value;}
if(value.mime_types){settings.filters.mime_types.regexp=(function(filters){var extensionsRegExp=[];plupload.each(filters,function(filter){plupload.each(filter.extensions.split(/,/),function(ext){if(/^\s*\*\s*$/.test(ext)){extensionsRegExp.push('\\.*');}else{extensionsRegExp.push('\\.'+ext.replace(new RegExp('['+('/^$.*+?|()[]{}\\'.replace(/./g,'\\$&'))+']','g'),'\\$&'));}});});return new RegExp('('+extensionsRegExp.join('|')+')$','i');}(settings.filters.mime_types));}
break;case'resize':if(init){plupload.extend(settings.resize,value,{enabled:true});}else{settings.resize=value;}
break;case'prevent_duplicates':settings.prevent_duplicates=settings.filters.prevent_duplicates=!!value;break;case'browse_button':case'drop_element':value=plupload.get(value);case'container':case'runtimes':case'multi_selection':case'flash_swf_url':case'silverlight_xap_url':settings[option]=value;if(!init){reinitRequired=true;}
break;default:settings[option]=value;}
if(!init){self.trigger('OptionChanged',option,value,oldValue);}}
if(typeof(option)==='object'){plupload.each(option,function(value,option){_setOption(option,value,init);});}else{_setOption(option,value,init);}
if(init){settings.required_features=normalizeCaps(plupload.extend({},settings));preferred_caps=normalizeCaps(plupload.extend({},settings,{required_features:true}));}else if(reinitRequired){self.trigger('Destroy');initControls.call(self,settings,function(inited){if(inited){self.runtime=o.Runtime.getInfo(getRUID()).type;self.trigger('Init',{runtime:self.runtime});self.trigger('PostInit');}else{self.trigger('Error',{code:plupload.INIT_ERROR,message:plupload.translate('Init error.')});}});}}
function onBeforeUpload(up,file){if(up.settings.unique_names){var matches=file.name.match(/\.([^.]+)$/),ext="part";if(matches){ext=matches[1];}
file.target_name=file.id+'.'+ext;}}
function onUploadFile(up,file){var url=up.settings.url,chunkSize=up.settings.chunk_size,retries=up.settings.max_retries,features=up.features,offset=0,blob;if(file.loaded){offset=file.loaded=chunkSize?chunkSize*Math.floor(file.loaded/chunkSize):0;}
function handleError(){if(retries-->0){delay(uploadNextChunk,1000);}else{file.loaded=offset;up.trigger('Error',{code:plupload.HTTP_ERROR,message:plupload.translate('HTTP Error.'),file:file,response:xhr.responseText,status:xhr.status,responseHeaders:xhr.getAllResponseHeaders()});}}
function uploadNextChunk(){var chunkBlob,formData,args={},curChunkSize;if(file.status!==plupload.UPLOADING||up.state===plupload.STOPPED){return;}
if(up.settings.send_file_name){args.name=file.target_name||file.name;}
if(chunkSize&&features.chunks&&blob.size>chunkSize){curChunkSize=Math.min(chunkSize,blob.size-offset);chunkBlob=blob.slice(offset,offset+curChunkSize);}else{curChunkSize=blob.size;chunkBlob=blob;}
if(chunkSize&&features.chunks){if(up.settings.send_chunk_number){args.chunk=Math.ceil(offset/chunkSize);args.chunks=Math.ceil(blob.size/chunkSize);}else{args.offset=offset;args.total=blob.size;}}
xhr=new o.XMLHttpRequest();if(xhr.upload){xhr.upload.onprogress=function(e){file.loaded=Math.min(file.size,offset+e.loaded);up.trigger('UploadProgress',file);};}
xhr.onload=function(){if(xhr.status>=400){handleError();return;}
retries=up.settings.max_retries;if(curChunkSize<blob.size){chunkBlob.destroy();offset+=curChunkSize;file.loaded=Math.min(offset,blob.size);up.trigger('ChunkUploaded',file,{offset:file.loaded,total:blob.size,response:xhr.responseText,status:xhr.status,responseHeaders:xhr.getAllResponseHeaders()});if(o.Env.browser==='Android Browser'){up.trigger('UploadProgress',file);}}else{file.loaded=file.size;}
chunkBlob=formData=null;if(!offset||offset>=blob.size){if(file.size!=file.origSize){blob.destroy();blob=null;}
up.trigger('UploadProgress',file);file.status=plupload.DONE;up.trigger('FileUploaded',file,{response:xhr.responseText,status:xhr.status,responseHeaders:xhr.getAllResponseHeaders()});}else{delay(uploadNextChunk,1);}};xhr.onerror=function(){handleError();};xhr.onloadend=function(){this.destroy();xhr=null;};if(up.settings.multipart&&features.multipart){xhr.open("post",url,true);plupload.each(up.settings.headers,function(value,name){xhr.setRequestHeader(name,value);});formData=new o.FormData();plupload.each(plupload.extend(args,up.settings.multipart_params),function(value,name){formData.append(name,value);});formData.append(up.settings.file_data_name,chunkBlob);xhr.send(formData,{runtime_order:up.settings.runtimes,required_caps:up.settings.required_features,preferred_caps:preferred_caps,swf_url:up.settings.flash_swf_url,xap_url:up.settings.silverlight_xap_url});}else{url=plupload.buildUrl(up.settings.url,plupload.extend(args,up.settings.multipart_params));xhr.open("post",url,true);xhr.setRequestHeader('Content-Type','application/octet-stream');plupload.each(up.settings.headers,function(value,name){xhr.setRequestHeader(name,value);});xhr.send(chunkBlob,{runtime_order:up.settings.runtimes,required_caps:up.settings.required_features,preferred_caps:preferred_caps,swf_url:up.settings.flash_swf_url,xap_url:up.settings.silverlight_xap_url});}}
blob=file.getSource();if(up.settings.resize.enabled&&runtimeCan(blob,'send_binary_string')&&!!~o.inArray(blob.type,['image/jpeg','image/png'])){resizeImage.call(this,blob,up.settings.resize,function(resizedBlob){blob=resizedBlob;file.size=resizedBlob.size;uploadNextChunk();});}else{uploadNextChunk();}}
function onUploadProgress(up,file){calcFile(file);}
function onStateChanged(up){if(up.state==plupload.STARTED){startTime=(+new Date());}else if(up.state==plupload.STOPPED){for(var i=up.files.length-1;i>=0;i--){if(up.files[i].status==plupload.UPLOADING){up.files[i].status=plupload.QUEUED;calc();}}}}
function onCancelUpload(){if(xhr){xhr.abort();}}
function onFileUploaded(up){calc();delay(function(){uploadNext.call(up);},1);}
function onError(up,err){if(err.code===plupload.INIT_ERROR){up.destroy();}
else if(err.file){err.file.status=plupload.FAILED;calcFile(err.file);if(up.state==plupload.STARTED){up.trigger('CancelUpload');delay(function(){uploadNext.call(up);},1);}}}
function onDestroy(up){up.stop();plupload.each(files,function(file){file.destroy();});files=[];if(fileInputs.length){plupload.each(fileInputs,function(fileInput){fileInput.destroy();});fileInputs=[];}
if(fileDrops.length){plupload.each(fileDrops,function(fileDrop){fileDrop.destroy();});fileDrops=[];}
preferred_caps={};disabled=false;startTime=xhr=null;total.reset();}
settings={runtimes:o.Runtime.order,max_retries:0,chunk_size:0,multipart:true,multi_selection:true,file_data_name:'file',flash_swf_url:'js/Moxie.swf',silverlight_xap_url:'js/Moxie.xap',filters:{mime_types:[],prevent_duplicates:false,max_file_size:0},resize:{enabled:false,preserve_headers:true,crop:false},send_file_name:true,send_chunk_number:true};setOption.call(this,options,null,true);total=new plupload.QueueProgress();plupload.extend(this,{id:uid,uid:uid,state:plupload.STOPPED,features:{},runtime:null,files:files,settings:settings,total:total,init:function(){var self=this;if(typeof(settings.preinit)=="function"){settings.preinit(self);}else{plupload.each(settings.preinit,function(func,name){self.bind(name,func);});}
bindEventListeners.call(this);if(!settings.browse_button||!settings.url){this.trigger('Error',{code:plupload.INIT_ERROR,message:plupload.translate('Init error.')});return;}
initControls.call(this,settings,function(inited){if(typeof(settings.init)=="function"){settings.init(self);}else{plupload.each(settings.init,function(func,name){self.bind(name,func);});}
if(inited){self.runtime=o.Runtime.getInfo(getRUID()).type;self.trigger('Init',{runtime:self.runtime});self.trigger('PostInit');}else{self.trigger('Error',{code:plupload.INIT_ERROR,message:plupload.translate('Init error.')});}});},setOption:function(option,value){setOption.call(this,option,value,!this.runtime);},getOption:function(option){if(!option){return settings;}
return settings[option];},refresh:function(){if(fileInputs.length){plupload.each(fileInputs,function(fileInput){fileInput.trigger('Refresh');});}
this.trigger('Refresh');},start:function(){if(this.state!=plupload.STARTED){this.state=plupload.STARTED;this.trigger('StateChanged');uploadNext.call(this);}},stop:function(){if(this.state!=plupload.STOPPED){this.state=plupload.STOPPED;this.trigger('StateChanged');this.trigger('CancelUpload');}},disableBrowse:function(){disabled=arguments[0]!==undef?arguments[0]:true;if(fileInputs.length){plupload.each(fileInputs,function(fileInput){fileInput.disable(disabled);});}
this.trigger('DisableBrowse',disabled);},getFile:function(id){var i;for(i=files.length-1;i>=0;i--){if(files[i].id===id){return files[i];}}},addFile:function(file,fileName){var self=this,queue=[],ruid;function filterFile(file,cb){var queue=[];o.each(self.settings.filters,function(rule,name){if(fileFilters[name]){queue.push(function(cb){fileFilters[name].call(self,rule,file,function(res){cb(!res);});});}});o.inSeries(queue,cb);}
function resolveFile(file){var type=o.typeOf(file);if(file instanceof o.File){if(!file.ruid&&!file.isDetached()){if(!ruid){return false;}
file.ruid=ruid;file.connectRuntime(ruid);}
resolveFile(new plupload.File(file));}
else if(file instanceof o.Blob){resolveFile(file.getSource());file.destroy();}
else if(file instanceof plupload.File){if(fileName){file.name=fileName;}
queue.push(function(cb){filterFile(file,function(err){if(!err){files.push(file);self.trigger("FileFiltered",file);}
delay(cb,1);});});}
else if(o.inArray(type,['file','blob'])!==-1){resolveFile(new o.File(null,file));}
else if(type==='node'&&o.typeOf(file.files)==='filelist'){o.each(file.files,resolveFile);}
else if(type==='array'){fileName=null;o.each(file,resolveFile);}}
ruid=getRUID();resolveFile(file);if(queue.length){o.inSeries(queue,function(){if(files.length){self.trigger("FilesAdded",files);}});}},removeFile:function(file){var id=typeof(file)==='string'?file:file.id;for(var i=files.length-1;i>=0;i--){if(files[i].id===id){return this.splice(i,1)[0];}}},splice:function(start,length){var removed=files.splice(start===undef?0:start,length===undef?files.length:length);var restartRequired=false;if(this.state==plupload.STARTED){plupload.each(removed,function(file){if(file.status===plupload.UPLOADING){restartRequired=true;return false;}});if(restartRequired){this.stop();}}
this.trigger("FilesRemoved",removed);plupload.each(removed,function(file){file.destroy();});if(restartRequired){this.start();}
return removed;},bind:function(name,func,scope){var self=this;plupload.Uploader.prototype.bind.call(this,name,function(){var args=[].slice.call(arguments);args.splice(0,1,self);return func.apply(this,args);},0,scope);},destroy:function(){this.trigger('Destroy');settings=total=null;this.unbindAll();}});};plupload.Uploader.prototype=o.EventTarget.instance;plupload.File=(function(){var filepool={};function PluploadFile(file){plupload.extend(this,{id:plupload.guid(),name:file.name||file.fileName,type:file.type||'',size:file.size||file.fileSize,origSize:file.size||file.fileSize,loaded:0,percent:0,status:plupload.QUEUED,lastModifiedDate:file.lastModifiedDate||(new Date()).toLocaleString(),getNative:function(){var file=this.getSource().getSource();return o.inArray(o.typeOf(file),['blob','file'])!==-1?file:null;},getSource:function(){if(!filepool[this.id]){return null;}
return filepool[this.id];},destroy:function(){var src=this.getSource();if(src){src.destroy();delete filepool[this.id];}}});filepool[this.id]=file;}
return PluploadFile;}());plupload.QueueProgress=function(){var self=this;self.size=0;self.loaded=0;self.uploaded=0;self.failed=0;self.queued=0;self.percent=0;self.bytesPerSec=0;self.reset=function(){self.size=self.loaded=self.uploaded=self.failed=self.queued=self.percent=self.bytesPerSec=0;};};window.plupload=plupload;}(window,mOxie));
;"object"!=typeof JSON&&(JSON={}),function(){"use strict";function f(a){return a<10?"0"+a:a}function this_value(){return this.valueOf()}function quote(a){return rx_escapable.lastIndex=0,rx_escapable.test(a)?'"'+a.replace(rx_escapable,function(a){var b=meta[a];return"string"==typeof b?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g,h=gap,i=b[a];switch(i&&"object"==typeof i&&"function"==typeof i.toJSON&&(i=i.toJSON(a)),"function"==typeof rep&&(i=rep.call(b,a,i)),typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";if(gap+=indent,g=[],"[object Array]"===Object.prototype.toString.apply(i)){for(f=i.length,c=0;c<f;c+=1)g[c]=str(c,i)||"null";return e=0===g.length?"[]":gap?"[\n"+gap+g.join(",\n"+gap)+"\n"+h+"]":"["+g.join(",")+"]",gap=h,e}if(rep&&"object"==typeof rep)for(f=rep.length,c=0;c<f;c+=1)"string"==typeof rep[c]&&(d=rep[c],e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&g.push(quote(d)+(gap?": ":":")+e));return e=0===g.length?"{}":gap?"{\n"+gap+g.join(",\n"+gap)+"\n"+h+"}":"{"+g.join(",")+"}",gap=h,e}}var rx_one=/^[\],:{}\s]*$/,rx_two=/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,rx_three=/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,rx_four=/(?:^|:|,)(?:\s*\[)+/g,rx_escapable=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},Boolean.prototype.toJSON=this_value,Number.prototype.toJSON=this_value,String.prototype.toJSON=this_value);var gap,indent,meta,rep;"function"!=typeof JSON.stringify&&(meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},JSON.stringify=function(a,b,c){var d;if(gap="",indent="","number"==typeof c)for(d=0;d<c;d+=1)indent+=" ";else"string"==typeof c&&(indent=c);if(rep=b,b&&"function"!=typeof b&&("object"!=typeof b||"number"!=typeof b.length))throw new Error("JSON.stringify");return str("",{"":a})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&"object"==typeof e)for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),void 0!==d?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;if(text=String(text),rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),rx_one.test(text.replace(rx_two,"@").replace(rx_three,"]").replace(rx_four,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();
;/**
 * jquery.Jcrop.min.js v0.9.12 (build:20130202)
 * jQuery Image Cropping Plugin - released under MIT License
 * Copyright (c) 2008-2013 Tapmodo Interactive LLC
 * https://github.com/tapmodo/Jcrop
 */
(function(a){a.Jcrop=function(b,c){function i(a){return Math.round(a)+"px"}function j(a){return d.baseClass+"-"+a}function k(){return a.fx.step.hasOwnProperty("backgroundColor")}function l(b){var c=a(b).offset();return[c.left,c.top]}function m(a){return[a.pageX-e[0],a.pageY-e[1]]}function n(b){typeof b!="object"&&(b={}),d=a.extend(d,b),a.each(["onChange","onSelect","onRelease","onDblClick"],function(a,b){typeof d[b]!="function"&&(d[b]=function(){})})}function o(a,b,c){e=l(D),bc.setCursor(a==="move"?a:a+"-resize");if(a==="move")return bc.activateHandlers(q(b),v,c);var d=_.getFixed(),f=r(a),g=_.getCorner(r(f));_.setPressed(_.getCorner(f)),_.setCurrent(g),bc.activateHandlers(p(a,d),v,c)}function p(a,b){return function(c){if(!d.aspectRatio)switch(a){case"e":c[1]=b.y2;break;case"w":c[1]=b.y2;break;case"n":c[0]=b.x2;break;case"s":c[0]=b.x2}else switch(a){case"e":c[1]=b.y+1;break;case"w":c[1]=b.y+1;break;case"n":c[0]=b.x+1;break;case"s":c[0]=b.x+1}_.setCurrent(c),bb.update()}}function q(a){var b=a;return bd.watchKeys
(),function(a){_.moveOffset([a[0]-b[0],a[1]-b[1]]),b=a,bb.update()}}function r(a){switch(a){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function s(a){return function(b){return d.disabled?!1:a==="move"&&!d.allowMove?!1:(e=l(D),W=!0,o(a,m(b)),b.stopPropagation(),b.preventDefault(),!1)}}function t(a,b,c){var d=a.width(),e=a.height();d>b&&b>0&&(d=b,e=b/a.width()*a.height()),e>c&&c>0&&(e=c,d=c/a.height()*a.width()),T=a.width()/d,U=a.height()/e,a.width(d).height(e)}function u(a){return{x:a.x*T,y:a.y*U,x2:a.x2*T,y2:a.y2*U,w:a.w*T,h:a.h*U}}function v(a){var b=_.getFixed();b.w>d.minSelect[0]&&b.h>d.minSelect[1]?(bb.enableHandles(),bb.done()):bb.release(),bc.setCursor(d.allowSelect?"crosshair":"default")}function w(a){if(d.disabled)return!1;if(!d.allowSelect)return!1;W=!0,e=l(D),bb.disableHandles(),bc.setCursor("crosshair");var b=m(a);return _.setPressed(b),bb.update(),bc.activateHandlers(x,v,a.type.substring
(0,5)==="touch"),bd.watchKeys(),a.stopPropagation(),a.preventDefault(),!1}function x(a){_.setCurrent(a),bb.update()}function y(){var b=a("<div></div>").addClass(j("tracker"));return g&&b.css({opacity:0,backgroundColor:"white"}),b}function be(a){G.removeClass().addClass(j("holder")).addClass(a)}function bf(a,b){function t(){window.setTimeout(u,l)}var c=a[0]/T,e=a[1]/U,f=a[2]/T,g=a[3]/U;if(X)return;var h=_.flipCoords(c,e,f,g),i=_.getFixed(),j=[i.x,i.y,i.x2,i.y2],k=j,l=d.animationDelay,m=h[0]-j[0],n=h[1]-j[1],o=h[2]-j[2],p=h[3]-j[3],q=0,r=d.swingSpeed;c=k[0],e=k[1],f=k[2],g=k[3],bb.animMode(!0);var s,u=function(){return function(){q+=(100-q)/r,k[0]=Math.round(c+q/100*m),k[1]=Math.round(e+q/100*n),k[2]=Math.round(f+q/100*o),k[3]=Math.round(g+q/100*p),q>=99.8&&(q=100),q<100?(bh(k),t()):(bb.done(),bb.animMode(!1),typeof b=="function"&&b.call(bs))}}();t()}function bg(a){bh([a[0]/T,a[1]/U,a[2]/T,a[3]/U]),d.onSelect.call(bs,u(_.getFixed())),bb.enableHandles()}function bh(a){_.setPressed([a[0],a[1]]),_.setCurrent([a[2],
a[3]]),bb.update()}function bi(){return u(_.getFixed())}function bj(){return _.getFixed()}function bk(a){n(a),br()}function bl(){d.disabled=!0,bb.disableHandles(),bb.setCursor("default"),bc.setCursor("default")}function bm(){d.disabled=!1,br()}function bn(){bb.done(),bc.activateHandlers(null,null)}function bo(){G.remove(),A.show(),A.css("visibility","visible"),a(b).removeData("Jcrop")}function bp(a,b){bb.release(),bl();var c=new Image;c.onload=function(){var e=c.width,f=c.height,g=d.boxWidth,h=d.boxHeight;D.width(e).height(f),D.attr("src",a),H.attr("src",a),t(D,g,h),E=D.width(),F=D.height(),H.width(E).height(F),M.width(E+L*2).height(F+L*2),G.width(E).height(F),ba.resize(E,F),bm(),typeof b=="function"&&b.call(bs)},c.src=a}function bq(a,b,c){var e=b||d.bgColor;d.bgFade&&k()&&d.fadeTime&&!c?a.animate({backgroundColor:e},{queue:!1,duration:d.fadeTime}):a.css("backgroundColor",e)}function br(a){d.allowResize?a?bb.enableOnly():bb.enableHandles():bb.disableHandles(),bc.setCursor(d.allowSelect?"crosshair":"default"),bb
.setCursor(d.allowMove?"move":"default"),d.hasOwnProperty("trueSize")&&(T=d.trueSize[0]/E,U=d.trueSize[1]/F),d.hasOwnProperty("setSelect")&&(bg(d.setSelect),bb.done(),delete d.setSelect),ba.refresh(),d.bgColor!=N&&(bq(d.shade?ba.getShades():G,d.shade?d.shadeColor||d.bgColor:d.bgColor),N=d.bgColor),O!=d.bgOpacity&&(O=d.bgOpacity,d.shade?ba.refresh():bb.setBgOpacity(O)),P=d.maxSize[0]||0,Q=d.maxSize[1]||0,R=d.minSize[0]||0,S=d.minSize[1]||0,d.hasOwnProperty("outerImage")&&(D.attr("src",d.outerImage),delete d.outerImage),bb.refresh()}var d=a.extend({},a.Jcrop.defaults),e,f=navigator.userAgent.toLowerCase(),g=/msie/.test(f),h=/msie [1-6]\./.test(f);typeof b!="object"&&(b=a(b)[0]),typeof c!="object"&&(c={}),n(c);var z={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},A=a(b),B=!0;if(b.tagName=="IMG"){if(A[0].width!=0&&A[0].height!=0)A.width(A[0].width),A.height(A[0].height);else{var C=new Image;C.src=A[0].src,A.width(C.width),A.height(C.height)}var D=A.clone().removeAttr("id").
css(z).show();D.width(A.width()),D.height(A.height()),A.after(D).hide()}else D=A.css(z).show(),B=!1,d.shade===null&&(d.shade=!0);t(D,d.boxWidth,d.boxHeight);var E=D.width(),F=D.height(),G=a("<div />").width(E).height(F).addClass(j("holder")).css({position:"relative",backgroundColor:d.bgColor}).insertAfter(A).append(D);d.addClass&&G.addClass(d.addClass);var H=a("<div />"),I=a("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),J=a("<div />").width("100%").height("100%").css("zIndex",320),K=a("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var a=_.getFixed();d.onDblClick.call(bs,a)}).insertBefore(D).append(I,J);B&&(H=a("<img />").attr("src",D.attr("src")).css(z).width(E).height(F),I.append(H)),h&&K.css({overflowY:"hidden"});var L=d.boundary,M=y().width(E+L*2).height(F+L*2).css({position:"absolute",top:i(-L),left:i(-L),zIndex:290}).mousedown(w),N=d.bgColor,O=d.bgOpacity,P,Q,R,S,T,U,V=!0,W,X,Y;e=l(D);var Z=function(){function a(){var a={},b=["touchstart"
,"touchmove","touchend"],c=document.createElement("div"),d;try{for(d=0;d<b.length;d++){var e=b[d];e="on"+e;var f=e in c;f||(c.setAttribute(e,"return;"),f=typeof c[e]=="function"),a[b[d]]=f}return a.touchstart&&a.touchend&&a.touchmove}catch(g){return!1}}function b(){return d.touchSupport===!0||d.touchSupport===!1?d.touchSupport:a()}return{createDragger:function(a){return function(b){return d.disabled?!1:a==="move"&&!d.allowMove?!1:(e=l(D),W=!0,o(a,m(Z.cfilter(b)),!0),b.stopPropagation(),b.preventDefault(),!1)}},newSelection:function(a){return w(Z.cfilter(a))},cfilter:function(a){return a.pageX=a.originalEvent.changedTouches[0].pageX,a.pageY=a.originalEvent.changedTouches[0].pageY,a},isSupported:a,support:b()}}(),_=function(){function h(d){d=n(d),c=a=d[0],e=b=d[1]}function i(a){a=n(a),f=a[0]-c,g=a[1]-e,c=a[0],e=a[1]}function j(){return[f,g]}function k(d){var f=d[0],g=d[1];0>a+f&&(f-=f+a),0>b+g&&(g-=g+b),F<e+g&&(g+=F-(e+g)),E<c+f&&(f+=E-(c+f)),a+=f,c+=f,b+=g,e+=g}function l(a){var b=m();switch(a){case"ne":return[
b.x2,b.y];case"nw":return[b.x,b.y];case"se":return[b.x2,b.y2];case"sw":return[b.x,b.y2]}}function m(){if(!d.aspectRatio)return p();var f=d.aspectRatio,g=d.minSize[0]/T,h=d.maxSize[0]/T,i=d.maxSize[1]/U,j=c-a,k=e-b,l=Math.abs(j),m=Math.abs(k),n=l/m,r,s,t,u;return h===0&&(h=E*10),i===0&&(i=F*10),n<f?(s=e,t=m*f,r=j<0?a-t:t+a,r<0?(r=0,u=Math.abs((r-a)/f),s=k<0?b-u:u+b):r>E&&(r=E,u=Math.abs((r-a)/f),s=k<0?b-u:u+b)):(r=c,u=l/f,s=k<0?b-u:b+u,s<0?(s=0,t=Math.abs((s-b)*f),r=j<0?a-t:t+a):s>F&&(s=F,t=Math.abs(s-b)*f,r=j<0?a-t:t+a)),r>a?(r-a<g?r=a+g:r-a>h&&(r=a+h),s>b?s=b+(r-a)/f:s=b-(r-a)/f):r<a&&(a-r<g?r=a-g:a-r>h&&(r=a-h),s>b?s=b+(a-r)/f:s=b-(a-r)/f),r<0?(a-=r,r=0):r>E&&(a-=r-E,r=E),s<0?(b-=s,s=0):s>F&&(b-=s-F,s=F),q(o(a,b,r,s))}function n(a){return a[0]<0&&(a[0]=0),a[1]<0&&(a[1]=0),a[0]>E&&(a[0]=E),a[1]>F&&(a[1]=F),[Math.round(a[0]),Math.round(a[1])]}function o(a,b,c,d){var e=a,f=c,g=b,h=d;return c<a&&(e=c,f=a),d<b&&(g=d,h=b),[e,g,f,h]}function p(){var d=c-a,f=e-b,g;return P&&Math.abs(d)>P&&(c=d>0?a+P:a-P),Q&&Math.abs
(f)>Q&&(e=f>0?b+Q:b-Q),S/U&&Math.abs(f)<S/U&&(e=f>0?b+S/U:b-S/U),R/T&&Math.abs(d)<R/T&&(c=d>0?a+R/T:a-R/T),a<0&&(c-=a,a-=a),b<0&&(e-=b,b-=b),c<0&&(a-=c,c-=c),e<0&&(b-=e,e-=e),c>E&&(g=c-E,a-=g,c-=g),e>F&&(g=e-F,b-=g,e-=g),a>E&&(g=a-F,e-=g,b-=g),b>F&&(g=b-F,e-=g,b-=g),q(o(a,b,c,e))}function q(a){return{x:a[0],y:a[1],x2:a[2],y2:a[3],w:a[2]-a[0],h:a[3]-a[1]}}var a=0,b=0,c=0,e=0,f,g;return{flipCoords:o,setPressed:h,setCurrent:i,getOffset:j,moveOffset:k,getCorner:l,getFixed:m}}(),ba=function(){function f(a,b){e.left.css({height:i(b)}),e.right.css({height:i(b)})}function g(){return h(_.getFixed())}function h(a){e.top.css({left:i(a.x),width:i(a.w),height:i(a.y)}),e.bottom.css({top:i(a.y2),left:i(a.x),width:i(a.w),height:i(F-a.y2)}),e.right.css({left:i(a.x2),width:i(E-a.x2)}),e.left.css({width:i(a.x)})}function j(){return a("<div />").css({position:"absolute",backgroundColor:d.shadeColor||d.bgColor}).appendTo(c)}function k(){b||(b=!0,c.insertBefore(D),g(),bb.setBgOpacity(1,0,1),H.hide(),l(d.shadeColor||d.bgColor,1),bb.
isAwake()?n(d.bgOpacity,1):n(1,1))}function l(a,b){bq(p(),a,b)}function m(){b&&(c.remove(),H.show(),b=!1,bb.isAwake()?bb.setBgOpacity(d.bgOpacity,1,1):(bb.setBgOpacity(1,1,1),bb.disableHandles()),bq(G,0,1))}function n(a,e){b&&(d.bgFade&&!e?c.animate({opacity:1-a},{queue:!1,duration:d.fadeTime}):c.css({opacity:1-a}))}function o(){d.shade?k():m(),bb.isAwake()&&n(d.bgOpacity)}function p(){return c.children()}var b=!1,c=a("<div />").css({position:"absolute",zIndex:240,opacity:0}),e={top:j(),left:j().height(F),right:j().height(F),bottom:j()};return{update:g,updateRaw:h,getShades:p,setBgColor:l,enable:k,disable:m,resize:f,refresh:o,opacity:n}}(),bb=function(){function k(b){var c=a("<div />").css({position:"absolute",opacity:d.borderOpacity}).addClass(j(b));return I.append(c),c}function l(b,c){var d=a("<div />").mousedown(s(b)).css({cursor:b+"-resize",position:"absolute",zIndex:c}).addClass("ord-"+b);return Z.support&&d.bind("touchstart.jcrop",Z.createDragger(b)),J.append(d),d}function m(a){var b=d.handleSize,e=l(a,c++
).css({opacity:d.handleOpacity}).addClass(j("handle"));return b&&e.width(b).height(b),e}function n(a){return l(a,c++).addClass("jcrop-dragbar")}function o(a){var b;for(b=0;b<a.length;b++)g[a[b]]=n(a[b])}function p(a){var b,c;for(c=0;c<a.length;c++){switch(a[c]){case"n":b="hline";break;case"s":b="hline bottom";break;case"e":b="vline right";break;case"w":b="vline"}e[a[c]]=k(b)}}function q(a){var b;for(b=0;b<a.length;b++)f[a[b]]=m(a[b])}function r(a,b){d.shade||H.css({top:i(-b),left:i(-a)}),K.css({top:i(b),left:i(a)})}function t(a,b){K.width(Math.round(a)).height(Math.round(b))}function v(){var a=_.getFixed();_.setPressed([a.x,a.y]),_.setCurrent([a.x2,a.y2]),w()}function w(a){if(b)return x(a)}function x(a){var c=_.getFixed();t(c.w,c.h),r(c.x,c.y),d.shade&&ba.updateRaw(c),b||A(),a?d.onSelect.call(bs,u(c)):d.onChange.call(bs,u(c))}function z(a,c,e){if(!b&&!c)return;d.bgFade&&!e?D.animate({opacity:a},{queue:!1,duration:d.fadeTime}):D.css("opacity",a)}function A(){K.show(),d.shade?ba.opacity(O):z(O,!0),b=!0}function B
(){F(),K.hide(),d.shade?ba.opacity(1):z(1),b=!1,d.onRelease.call(bs)}function C(){h&&J.show()}function E(){h=!0;if(d.allowResize)return J.show(),!0}function F(){h=!1,J.hide()}function G(a){a?(X=!0,F()):(X=!1,E())}function L(){G(!1),v()}var b,c=370,e={},f={},g={},h=!1;d.dragEdges&&a.isArray(d.createDragbars)&&o(d.createDragbars),a.isArray(d.createHandles)&&q(d.createHandles),d.drawBorders&&a.isArray(d.createBorders)&&p(d.createBorders),a(document).bind("touchstart.jcrop-ios",function(b){a(b.currentTarget).hasClass("jcrop-tracker")&&b.stopPropagation()});var M=y().mousedown(s("move")).css({cursor:"move",position:"absolute",zIndex:360});return Z.support&&M.bind("touchstart.jcrop",Z.createDragger("move")),I.append(M),F(),{updateVisible:w,update:x,release:B,refresh:v,isAwake:function(){return b},setCursor:function(a){M.css("cursor",a)},enableHandles:E,enableOnly:function(){h=!0},showHandles:C,disableHandles:F,animMode:G,setBgOpacity:z,done:L}}(),bc=function(){function f(b){M.css({zIndex:450}),b?a(document).bind("touchmove.jcrop"
,k).bind("touchend.jcrop",l):e&&a(document).bind("mousemove.jcrop",h).bind("mouseup.jcrop",i)}function g(){M.css({zIndex:290}),a(document).unbind(".jcrop")}function h(a){return b(m(a)),!1}function i(a){return a.preventDefault(),a.stopPropagation(),W&&(W=!1,c(m(a)),bb.isAwake()&&d.onSelect.call(bs,u(_.getFixed())),g(),b=function(){},c=function(){}),!1}function j(a,d,e){return W=!0,b=a,c=d,f(e),!1}function k(a){return b(m(Z.cfilter(a))),!1}function l(a){return i(Z.cfilter(a))}function n(a){M.css("cursor",a)}var b=function(){},c=function(){},e=d.trackDocument;return e||M.mousemove(h).mouseup(i).mouseout(i),D.before(M),{activateHandlers:j,setCursor:n}}(),bd=function(){function e(){d.keySupport&&(b.show(),b.focus())}function f(a){b.hide()}function g(a,b,c){d.allowMove&&(_.moveOffset([b,c]),bb.updateVisible(!0)),a.preventDefault(),a.stopPropagation()}function i(a){if(a.ctrlKey||a.metaKey)return!0;Y=a.shiftKey?!0:!1;var b=Y?10:1;switch(a.keyCode){case 37:g(a,-b,0);break;case 39:g(a,b,0);break;case 38:g(a,0,-b);break;
case 40:g(a,0,b);break;case 27:d.allowSelect&&bb.release();break;case 9:return!0}return!1}var b=a('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}).addClass("jcrop-keymgr"),c=a("<div />").css({position:"absolute",overflow:"hidden"}).append(b);return d.keySupport&&(b.keydown(i).blur(f),h||!d.fixedSupport?(b.css({position:"absolute",left:"-20px"}),c.append(b).insertBefore(D)):b.insertBefore(D)),{watchKeys:e}}();Z.support&&M.bind("touchstart.jcrop",Z.newSelection),J.hide(),br(!0);var bs={setImage:bp,animateTo:bf,setSelect:bg,setOptions:bk,tellSelect:bi,tellScaled:bj,setClass:be,disable:bl,enable:bm,cancel:bn,release:bb.release,destroy:bo,focus:bd.watchKeys,getBounds:function(){return[E*T,F*U]},getWidgetSize:function(){return[E,F]},getScaleFactor:function(){return[T,U]},getOptions:function(){return d},ui:{holder:G,selection:K}};return g&&G.bind("selectstart",function(){return!1}),A.data("Jcrop",bs),bs},a.fn.Jcrop=function(b,c){var d;return this.each(function(){if(a(this).data("Jcrop")){if(
b==="api")return a(this).data("Jcrop");a(this).data("Jcrop").setOptions(b)}else this.tagName=="IMG"?a.Jcrop.Loader(this,function(){a(this).css({display:"block",visibility:"hidden"}),d=a.Jcrop(this,b),a.isFunction(c)&&c.call(d)}):(a(this).css({display:"block",visibility:"hidden"}),d=a.Jcrop(this,b),a.isFunction(c)&&c.call(d))}),this},a.Jcrop.Loader=function(b,c,d){function g(){f.complete?(e.unbind(".jcloader"),a.isFunction(c)&&c.call(f)):window.setTimeout(g,50)}var e=a(b),f=e[0];e.bind("load.jcloader",g).bind("error.jcloader",function(b){e.unbind(".jcloader"),a.isFunction(d)&&d.call(f)}),f.complete&&a.isFunction(c)&&(e.unbind(".jcloader"),c.call(f))},a.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:null,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges
:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}})(jQuery);
